<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="Author" content="default_user">
   <meta name="GENERATOR" content="Microsoft FrontPage 4.0">
   <title>Lookup-Efficiency for Transmission Gearbox Model</title>
</head>
<body>

<h1>
New Lookup-Efficiency for Transmission Gearbox Model</h1>
Previously in ADVISOR, an equation was used to calculate the torque lost
through the transmission. Although this technique is a valid way to determine
transmission efficiency, the equation-form suffers because it's coefficients
are often-times non-conceptual. Furthermore, customizing transmission gearbox
efficiency is cumbersome using the equation form.
<p>Therefore, a lookup-table model for transmission gearbox efficiency
is now used. The model now determines transmission gearbox efficiency as
a function of transmission output torque (Nm), output speed (rad/s), and
current gear (e.g., 1st, 2nd, 3rd, etc.). This methodology is used with
both the manual and automatic transmission models.
<center>
<p><b>Note that due to interpolation error in the lookup table, slight
changes in fuel economy between vehicles in ADVISOR 3.1 and 3.2 should
be expected for vehicles that previously used the gearbox loss equation.</b></center>

<p>Within each (non-CVT) TX_* file, three variables are now specified in
place of the gearbox loss-equation coefficients (gb_loss_* from ADVISOR
v3.1 and before). The new variables are tx_map_spd, tx_map_trq, and tx_eff_map.
'tx_map_trq' and 'tx_map_spd' are vectors while 'tx_eff_map' is a 3-dimensional
matrix of efficiency values. The variables 'tx_map_spd' and 'tx_map_trq'
are used to index the rows and columns of tx_eff_map for a given gear (the
current gear determines the "height" at which to access the rows and columns
of tx_map_trq).
<p>In the current implementation, values of tx_eff_map must be between
0 and 1 (inclusive). Values above or below these limits will be cut to
0 and 1 in the algorithm. Efficiency values queried beyond the range limits
defined for gear (1 through height of tx_map_trq), tx_map_trq (max(tx_map_trq)
and min(tx_map_trq)), and tx_map_spd (max(tx_map_spd) and min(tx_map_spd))
will be looked up after being cut-down to the closest value. For example,
if torque is specified up to 400 Nm and a value is requested at 500 Nm,
the value will be looked up as if the torque requested was 400 Nm. Similarly
for gearing, if only one gear is defined in tx_eff_map (i.e., if the height
of tx_eff_map is "1"), that same map will be used for all gears. Note that
negative torques should be defined in the tx_map_trq matrix to avoid using
efficiency values for the lowest positive torque defined to represent all
negative values. If the negative region is unknown, the positive region
efficiencies may be reflected about Torque=0 as a good first estimate.
<p>For user convenience, a function is available to automatically generate
tx_map_spd, tx_map_trq, and tx_eff_map using the previous loss-equation.
This function is called tx_eff_mapper and is in the &lt;ADVISOR main directory>/gui
directory. The function tx_eff_mapper has the following form:
<center>
<p>[tx_eff_map, tx_map_spd, tx_map_trq] = tx_eff_mapper(gb_vars,w,T,gb_ratio)</center>

<p>The arguments to the function are explained below:
<br>&nbsp;
<dl>
<dt>
gb_vars</dt>

<dd>
a structure with the following fields corresponding to the coefficients
to the previous loss-equation:</dd>

<dl>
<dl>gb_vars.gb_loss_input_spd_coeff
<br>gb_vars.gb_loss_output_spd_coeff
<br>gb_vars.gb_loss_input_trq_coeff
<br>gb_vars.gb_loss_output_trq_coeff
<br>gb_vars.gb_loss_output_pwr_coeff
<br>gb_vars.gb_loss_const</dl>
</dl>

<dt>
w</dt>

<dd>
a structure containing the transmission output angular speed values to
use for evaluating efficiency in the field "vals" (i.e., w.vals is an array
of speed values to evaluate [rad/s])</dd>

<dt>
T</dt>

<dd>
a structure containing the transmission output torque values to use for
evaluating efficiency in the field "vals" (i.e., T.vals is an array of
torque values to evaluate [Nm])</dd>

<dt>
gb_ratio</dt>

<dd>
a listing of the gear ratios for the current gear box</dd>
</dl>
Once tx_eff_mapper has been used, a simple contour plot may be made of
transmission gearbox efficiency by using the following:
<p>figure, [c,h] = contour(tx_map_trq, tx_map_spd, tx_eff_map(:,:,1),[0:0.05:1]);
clabel(c,h), colorbar % plots efficiency map for 1st gear
<br>&nbsp;
<h2>
Restoring the Old Equation Methodology for Transmission Efficiency</h2>
For those users who wish to continue using the previous equation form of
gearbox loss determination, a simple block diagram change is required.
For maximum safety, it is recommended that an original version of <b><i>lib_transmission</i></b>
be kept off of the ADVISOR path for restoration purposes (for example,
make a copy of <b><i>lib_transmission.mdl</i></b> and place it in a new
folder &lt;ADVISOR directory>/models/library/backup created by the user).
<p>Open <b><i>lib_transmission</i></b> and <b>unlock library. </b>Delete
the reference to <b><i>loss (Nm)</i></b> appearing in <b><i>lib_transmission/gearbox
&lt;gb></i></b>. Also delete the FROM block for [gear_number] as well as
its corresponding input line. Now go to <b><i>lib_transmission/SubLibraries</i></b>
and copy the block <b><i>loss (Nm) old methodology</i></b>. Paste a reference
to <b><i>loss (Nm) old methodology</i></b> back in <b><i>lib_transmission/gearbox
&lt;gb></i></b> where the block <b><i>loss (Nm)</i></b> used to be and
make sure that all lines are connected. Save the library. It is recommended
that matlab be restarted to force Matlab/Simulink to recognize the new
block diagram changes (instead of using an old version which may be stored
in memory).
<p>Users should note that, although NREL will still be able to give advice
regarding the old equation model, it is no longer the "officially" supported
version.
<p>
<hr WIDTH="100%">
<center><a href="advisor_doc.htm">Return to ADVISOR Documentation Start
Page</a>
<br>
<hr WIDTH="100%"></center>
Last revised [22-October-2001] mpo
</body>
</html>
