Library {
  Name			  "lib_energy_storage"
  Version		  4.00
  Description		  "energy storage"
  LibraryLinkDisplay	  "none"
  CovSaveName		  "covdata"
  CovMetricSettings	  "dw"
  CovNameIncrementing	  off
  CovHtmlReporting	  on
  BlockNameDataTip	  off
  BlockParametersDataTip  off
  BlockDescriptionStringDataTip	off
  ToolBar		  on
  StatusBar		  off
  BrowserShowLibraryLinks off
  BrowserLookUnderMasks	  off
  Created		  "Tue May 30 16:45:37 2000"
  Creator		  "NREL"
  UpdateHistory		  "UpdateHistoryNever"
  ModifiedByFormat	  "%<Auto>"
  LastModifiedBy	  "mzolot"
  ModifiedDateFormat	  "%<Auto>"
  LastModifiedDate	  "Fri Jul 18 11:33:36 2003"
  ModifiedComment	  "mzolot -- Mon Apr 29 15:28:23 2002 -- Version 3.010"
"7\n"
  ModifiedHistory	  "mzolot -- Mon Apr 29 15:28:23 2002 -- Version 3.010"
"7\n\n\nmzolot -- Mon Apr 29 15:28:23 2002 -- Version 3.0107\n\n\nmzolot -- Mo"
"n Apr 29 15:09:57 2002 -- Version 3.0106\n\n\nmzolot -- Mon Apr 29 14:58:03 2"
"002 -- Version 3.0105\n\n\nmzolot -- Mon Apr 29 14:03:19 2002 -- Version 3.01"
"04\n\n\nmzolot -- Mon Apr 29 14:02:44 2002 -- Version 3.0103\n\n\nmzolot -- M"
"on Apr 29 14:02:36 2002 -- Version 3.0102\n\n\nmzolot -- Mon Apr 29 14:01:30 "
"2002 -- Version 3.0101\n\n\nmzolot -- Tue Apr 23 09:34:07 2002 -- Version 3.0"
"100\n\n\nmzolot -- Tue Apr 23 09:26:47 2002 -- Version 3.099\n\n\nmzolot -- T"
"ue Apr 23 09:26:41 2002 -- Version 3.098\n\n\nmzolot -- Fri Apr 19 16:37:41 2"
"002 -- Version 3.097\n\n\nmzolot -- Fri Apr 19 11:13:38 2002 -- Version 3.096"
"\n\n\nmzolot -- Thu Apr 18 17:16:22 2002 -- Version 3.095\n\n\nmokeefe -- Thu"
" Apr 18 08:28:08 2002 -- Version 3.094\nsaving the model:\no \"without the mo"
"del browser open\"\no with only top-level screen visible \no with \"fit to vi"
"ew\" enabled\no with \"status bar\" off and \"toolbar\" off\no with \"prompt "
"to update model history with each save\" on\n\nvjohnson -- Thu Jan 25 10:35:5"
"6 2001 -- Version 3.02\n\n\nssprik -- Wed Nov 01 15:28:33 2000 -- Version 3.0"
"1\nenabled comment dialogue to prompt the person saving the model to add comm"
"ents.\n\n"
  ModelVersionFormat	  "3.0%<AutoIncrement:129>"
  ConfigurationManager	  "none"
  SimParamPage		  "Solver"
  AlgebraicLoopMsg	  "warning"
  MinStepSizeMsg	  "warning"
  UnconnectedInputMsg	  "warning"
  UnconnectedOutputMsg	  "warning"
  UnconnectedLineMsg	  "warning"
  InheritedTsInSrcMsg	  "warning"
  SingleTaskRateTransMsg  "none"
  MultiTaskRateTransMsg	  "error"
  IntegerOverflowMsg	  "warning"
  CheckForMatrixSingularity "none"
  UnnecessaryDatatypeConvMsg "none"
  Int32ToFloatConvMsg	  "warning"
  InvalidFcnCallConnMsg	  "error"
  SignalLabelMismatchMsg  "none"
  LinearizationMsg	  "none"
  VectorMatrixConversionMsg "none"
  SfunCompatibilityCheckMsg "none"
  BlockPriorityViolationMsg "warning"
  ArrayBoundsChecking	  "none"
  ConsistencyChecking	  "none"
  Profile		  off
  SimulationMode	  "normal"
  RTWRetainRTWFile	  off
  RTWMakeCommand	  "make_rtw"
  RTWGenerateCodeOnly	  off
  TLCProfiler		  off
  TLCDebug		  off
  TLCCoverage		  off
  ExtModeMexFile	  "ext_comm"
  ExtModeBatchMode	  off
  ExtModeTrigType	  "manual"
  ExtModeTrigMode	  "normal"
  ExtModeTrigPort	  "1"
  ExtModeTrigElement	  "any"
  ExtModeTrigDuration	  1000
  ExtModeTrigHoldOff	  0
  ExtModeTrigDelay	  0
  ExtModeTrigDirection	  "rising"
  ExtModeTrigLevel	  0
  ExtModeArchiveMode	  "off"
  ExtModeAutoIncOneShot	  off
  ExtModeIncDirWhenArm	  off
  ExtModeAddSuffixToVar	  off
  ExtModeWriteAllDataToWs off
  ExtModeArmWhenConnect	  on
  ExtModeSkipDownloadWhenConnect off
  ExtModeLogAll		  on
  ExtModeAutoUpdateStatusClock on
  BlockDefaults {
    Orientation		    "right"
    ForegroundColor	    "black"
    BackgroundColor	    "white"
    DropShadow		    off
    NamePlacement	    "normal"
    FontName		    "Helvetica"
    FontSize		    10
    FontWeight		    "normal"
    FontAngle		    "normal"
    ShowName		    on
  }
  AnnotationDefaults {
    HorizontalAlignment	    "center"
    VerticalAlignment	    "middle"
    ForegroundColor	    "black"
    BackgroundColor	    "white"
    DropShadow		    off
    FontName		    "Helvetica"
    FontSize		    10
    FontWeight		    "normal"
    FontAngle		    "normal"
  }
  LineDefaults {
    FontName		    "Helvetica"
    FontSize		    9
    FontWeight		    "normal"
    FontAngle		    "normal"
  }
  System {
    Name		    "lib_energy_storage"
    Location		    [640, 191, 913, 536]
    Open		    on
    ModelBrowserVisibility  off
    ModelBrowserWidth	    212
    ScreenColor		    "automatic"
    PaperOrientation	    "landscape"
    PaperPositionMode	    "auto"
    PaperType		    "usletter"
    PaperUnits		    "inches"
    ZoomFactor		    "100"
    ReportName		    "simulink-default.rpt"
    Block {
      BlockType		      SubSystem
      Name		      "Ess Choices"
      Ports		      []
      Position		      [50, 184, 160, 256]
      ShowPortLabels	      on
      TreatAsAtomicUnit	      off
      RTWSystemCode	      "Auto"
      RTWFcnNameOpts	      "Auto"
      RTWFileNameOpts	      "Auto"
      System {
	Name			"Ess Choices"
	Location		[316, 344, 986, 907]
	Open			off
	ModelBrowserVisibility	on
	ModelBrowserWidth	200
	ScreenColor		"automatic"
	PaperOrientation	"landscape"
	PaperPositionMode	"auto"
	PaperType		"usletter"
	PaperUnits		"inches"
	ZoomFactor		"99"
	Block {
	  BlockType		  SubSystem
	  Name			  "Ultracapacitor\n System"
	  Ports			  [1, 1]
	  Position		  [355, 90, 415, 130]
	  ShowPortLabels	  off
	  TreatAsAtomicUnit	  off
	  RTWSystemCode		  "Auto"
	  RTWFcnNameOpts	  "Auto"
	  RTWFileNameOpts	  "Auto"
	  MaskDisplay		  "image(imread('bdi_ess.jpg'))"
	  MaskIconFrame		  on
	  MaskIconOpaque	  on
	  MaskIconRotate	  "none"
	  MaskIconUnits		  "autoscale"
	  System {
	    Name		    "Ultracapacitor\n System"
	    Location		    [207, 263, 900, 661]
	    Open		    off
	    ModelBrowserVisibility  off
	    ModelBrowserWidth	    200
	    ScreenColor		    "automatic"
	    PaperOrientation	    "landscape"
	    PaperPositionMode	    "auto"
	    PaperType		    "usletter"
	    PaperUnits		    "inches"
	    ZoomFactor		    "100"
	    Block {
	      BlockType		      Inport
	      Name		      "power req'd\ninto bus (W)"
	      Position		      [25, 40, 45, 60]
	      NamePlacement	      "alternate"
	      FontName		      "Arial"
	      Port		      "1"
	      LatchInput	      off
	      Interpolate	      on
	    }
	    Block {
	      BlockType		      Reference
	      Name		      "C\n(Farads)"
	      Ports		      [2, 1]
	      Position		      [145, 224, 170, 246]
	      SourceBlock	      "simulink3/Functions\n& Tables/Look-Up\n"
"Table (2-D)"
	      SourceType	      "Lookup Table (2-D)"
	      x			      "ess_tmp"
	      y			      "ess_i"
	      t			      "ess_cap"
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Calc Iout"
	      Ports		      [4, 3]
	      Position		      [190, 45, 235, 100]
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      Port {
		PortNumber		1
		Name			"Iout"
		TestPoint		off
		LinearAnalysisOutput	off
		LinearAnalysisInput	off
		RTWStorageClass		"Auto"
	      }
	      System {
		Name			"Calc Iout"
		Location		[210, 400, 857, 627]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"automatic"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "Preq"
		  Position		  [15, 43, 45, 57]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "Voc"
		  Position		  [15, 73, 45, 87]
		  Port			  "2"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "tmp"
		  Position		  [15, 103, 45, 117]
		  Port			  "3"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "SOC"
		  Position		  [15, 13, 45, 27]
		  Port			  "4"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Fcn
		  Name			  "-1*|u|"
		  Position		  [75, 174, 95, 186]
		  Expr			  "-1*abs(u)"
		}
		Block {
		  BlockType		  Abs
		  Name			  "Abs"
		  Position		  [75, 117, 95, 133]
		  ShowName		  off
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Goto
		  Name			  "Goto <cs>1"
		  Position		  [520, 140, 600, 160]
		  GotoTag		  "ess_max_pwr"
		  TagVisibility		  "global"
		}
		Block {
		  BlockType		  Goto
		  Name			  "Goto <cs>2"
		  Position		  [530, 105, 635, 125]
		  GotoTag		  "ess_max_chg_pwr"
		  TagVisibility		  "global"
		}
		Block {
		  BlockType		  Fcn
		  Name			  "Iout=(Voc-(Voc^2-4RPout)^.5)\n     "
"  -----------------------------\n(2*R)"
		  Position		  [330, 69, 360, 91]
		  NamePlacement		  "alternate"
		  Expr			  "(u[2]-(((u[2]^2-4*u[1]*u[3])>0)*(u["
"2]^2-4*u[1]*u[3]))^.5)/(2*u[3])"
		}
		Block {
		  BlockType		  Memory
		  Name			  "Memory"
		  Position		  [490, 116, 500, 134]
		  ShowName		  off
		  X0			  "0"
		  InheritSampleTime	  off
		  RTWStateStorageClass	  "Auto"
		}
		Block {
		  BlockType		  Memory
		  Name			  "Memory1"
		  Position		  [500, 101, 510, 119]
		  ShowName		  off
		  X0			  "0"
		  InheritSampleTime	  off
		  RTWStateStorageClass	  "Auto"
		}
		Block {
		  BlockType		  Mux
		  Name			  "Mux"
		  Ports			  [3, 1]
		  Position		  [305, 61, 310, 99]
		  ShowName		  off
		  Inputs		  "3"
		  DisplayOption		  "bar"
		}
		Block {
		  BlockType		  Gain
		  Name			  "Parallel"
		  Position		  [200, 162, 225, 188]
		  Gain			  "1/ess_parallel_mod_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Gain
		  Name			  "Parallel1"
		  Position		  [205, 107, 230, 133]
		  ShowName		  off
		  Gain			  "1/ess_parallel_mod_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Product
		  Name			  "Prdct"
		  Ports			  [2, 1]
		  Position		  [115, 58, 135, 82]
		  ShowName		  off
		  Inputs		  "*/"
		  Multiplication	  "Element-wise(.*)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Gain
		  Name			  "R scale fn"
		  Position		  [160, 107, 185, 133]
		  Gain			  "ess_res_scale_fun(ess_res_scale_coe"
"f,ess_module_num,ess_cap_scale)"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Gain
		  Name			  "R2 scale fn"
		  Position		  [160, 163, 185, 187]
		  ShowName		  off
		  Gain			  "ess_res_scale_fun(ess_res_scale_coe"
"f,ess_module_num,ess_cap_scale)"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Reference
		  Name			  "Rchg\n(ohms)"
		  Ports			  [2, 1]
		  Position		  [120, 159, 145, 186]
		  SourceBlock		  "simulink3/Functions\n& Tables/Look-"
"Up\nTable (2-D)"
		  SourceType		  "Lookup Table (2-D)"
		  x			  "ess_tmp"
		  y			  "ess_i"
		  t			  "ess_r"
		}
		Block {
		  BlockType		  Reference
		  Name			  "Rdis\n(ohms)"
		  Ports			  [2, 1]
		  Position		  [120, 104, 145, 131]
		  SourceBlock		  "simulink3/Functions\n& Tables/Look-"
"Up\nTable (2-D)"
		  SourceType		  "Lookup Table (2-D)"
		  x			  "ess_tmp"
		  y			  "ess_i"
		  t			  "ess_r"
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "SOC limit"
		  Ports			  [2, 1]
		  Position		  [125, 14, 165, 36]
		  ShowPortLabels	  off
		  TreatAsAtomicUnit	  off
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  System {
		    Name		    "SOC limit"
		    Location		    [266, 224, 729, 496]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "SOC"
		    Position		    [15, 40, 35, 60]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "Pbty"
		    Position		    [15, 130, 35, 150]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "Constant1"
		    Position		    [45, 55, 80, 75]
		    ShowName		    off
		    Value		    "0.001"
		    VectorParams1D	    on
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "Constant5"
		    Position		    [135, 26, 170, 44]
		    ShowName		    off
		    Value		    ".999"
		    VectorParams1D	    on
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "Constant9"
		    Position		    [65, 118, 75, 132]
		    ShowName		    off
		    Value		    "0"
		    VectorParams1D	    on
		    }
		    Block {
		    BlockType		    Goto
		    Name		    "Goto <sdo>2"
		    Position		    [310, 124, 420, 146]
		    GotoTag		    "ess_soc_low_limited"
		    TagVisibility	    "global"
		    }
		    Block {
		    BlockType		    Goto
		    Name		    "Goto <sdo>4"
		    Position		    [310, 29, 420, 51]
		    GotoTag		    "ess_soc_hi_limited"
		    TagVisibility	    "global"
		    }
		    Block {
		    BlockType		    Logic
		    Name		    "Logical\nOperator"
		    Ports		    [2, 1]
		    Position		    [150, 97, 180, 128]
		    ShowName		    off
		    Operator		    "OR"
		    Inputs		    "2"
		    }
		    Block {
		    BlockType		    Logic
		    Name		    "Logical\nOperator1"
		    Ports		    [2, 1]
		    Position		    [260, 22, 290, 53]
		    ShowName		    off
		    Operator		    "AND"
		    Inputs		    "2"
		    }
		    Block {
		    BlockType		    Logic
		    Name		    "Logical\nOperator2"
		    Ports		    [1, 1]
		    Position		    [225, 119, 255, 151]
		    Operator		    "NOT"
		    Inputs		    "1"
		    }
		    Block {
		    BlockType		    RelationalOperator
		    Name		    "Relational\nOperator"
		    Position		    [100, 42, 130, 73]
		    ShowName		    off
		    Operator		    ">"
		    }
		    Block {
		    BlockType		    RelationalOperator
		    Name		    "Relational\nOperator3"
		    Position		    [95, 102, 125, 133]
		    NamePlacement	    "alternate"
		    ShowName		    off
		    Operator		    "<"
		    }
		    Block {
		    BlockType		    RelationalOperator
		    Name		    "SOC>=.999"
		    Position		    [185, 12, 215, 43]
		    Operator		    ">="
		    }
		    Block {
		    BlockType		    RelationalOperator
		    Name		    "charging\n(Preq is neg)"
		    Position		    [205, 57, 235, 88]
		    Operator		    "<"
		    }
		    Block {
		    BlockType		    Switch
		    Name		    "no power req if\nSOC<0 and trying"
" \nto discharge"
		    Position		    [225, 190, 255, 220]
		    Threshold		    "eps"
		    }
		    Block {
		    BlockType		    Switch
		    Name		    "no power req if\nSOC>.999 and try"
"ing \nto charge"
		    Position		    [330, 180, 360, 210]
		    Threshold		    "eps"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "Pbty, limited"
		    Position		    [415, 185, 435, 205]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "Constant1"
		    SrcPort		    1
		    DstBlock		    "Relational\nOperator"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "Pbty"
		    SrcPort		    1
		    Points		    [0, 0; 15, 0]
		    Branch {
		    Points		    [0, -30]
		    DstBlock		    "Relational\nOperator3"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [130, 0]
		    Branch {
		    Points		    [0, -75]
		    DstBlock		    "charging\n(Preq is neg)"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [0, 55]
		    DstBlock		    "no power req if\nSOC<0 and trying"
" \nto discharge"
		    DstPort		    1
		    }
		    }
		    }
		    Line {
		    SrcBlock		    "Logical\nOperator"
		    SrcPort		    1
		    Points		    [10, 0; 0, 20]
		    Branch {
		    DstBlock		    "Logical\nOperator2"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [0, 70]
		    DstBlock		    "no power req if\nSOC<0 and trying"
" \nto discharge"
		    DstPort		    2
		    }
		    }
		    Line {
		    SrcBlock		    "SOC"
		    SrcPort		    1
		    Points		    [0, 0; 40, 0]
		    Branch {
		    DstBlock		    "Relational\nOperator"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [0, -30]
		    DstBlock		    "SOC>=.999"
		    DstPort		    1
		    }
		    }
		    Line {
		    SrcBlock		    "SOC>=.999"
		    SrcPort		    1
		    DstBlock		    "Logical\nOperator1"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "charging\n(Preq is neg)"
		    SrcPort		    1
		    Points		    [0, -30]
		    DstBlock		    "Logical\nOperator1"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "Constant5"
		    SrcPort		    1
		    DstBlock		    "SOC>=.999"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "no power req if\nSOC<0 and trying"
" \nto discharge"
		    SrcPort		    1
		    DstBlock		    "no power req if\nSOC>.999 and try"
"ing \nto charge"
		    DstPort		    3
		    }
		    Line {
		    SrcBlock		    "no power req if\nSOC>.999 and try"
"ing \nto charge"
		    SrcPort		    1
		    DstBlock		    "Pbty, limited"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Logical\nOperator1"
		    SrcPort		    1
		    Points		    [0, 0]
		    Branch {
		    DstBlock		    "Goto <sdo>4"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [0, 0; 0, 155]
		    DstBlock		    "no power req if\nSOC>.999 and try"
"ing \nto charge"
		    DstPort		    2
		    }
		    }
		    Line {
		    SrcBlock		    "Relational\nOperator3"
		    SrcPort		    1
		    DstBlock		    "Logical\nOperator"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "Constant9"
		    SrcPort		    1
		    Points		    [0, 0]
		    Branch {
		    Points		    [0, 0]
		    Branch {
		    DstBlock		    "Relational\nOperator3"
		    DstPort		    2
		    }
		    Branch {
		    Points		    [0, -45]
		    DstBlock		    "charging\n(Preq is neg)"
		    DstPort		    2
		    }
		    }
		    Branch {
		    Points		    [0, 90; 115, 0]
		    Branch {
		    DstBlock		    "no power req if\nSOC<0 and trying"
" \nto discharge"
		    DstPort		    3
		    }
		    Branch {
		    Points		    [0, 45; 85, 0; 0, -75]
		    DstBlock		    "no power req if\nSOC>.999 and try"
"ing \nto charge"
		    DstPort		    1
		    }
		    }
		    }
		    Line {
		    SrcBlock		    "Relational\nOperator"
		    SrcPort		    1
		    DstBlock		    "Logical\nOperator"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Logical\nOperator2"
		    SrcPort		    1
		    DstBlock		    "Goto <sdo>2"
		    DstPort		    1
		    }
		  }
		}
		Block {
		  BlockType		  Switch
		  Name			  "Switch2"
		  Position		  [255, 180, 285, 210]
		  ShowName		  off
		  Threshold		  "0"
		}
		Block {
		  BlockType		  ToWorkspace
		  Name			  "To Workspace"
		  Position		  [555, 39, 630, 61]
		  VariableName		  "ess_current"
		  MaxDataPoints		  "inf"
		  Decimation		  "1"
		  SampleTime		  "-1"
		  SaveFormat		  "Array"
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "limit power"
		  Ports			  [4, 3]
		  Position		  [380, 88, 470, 132]
		  ShowPortLabels	  on
		  TreatAsAtomicUnit	  off
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  System {
		    Name		    "limit power"
		    Location		    [518, 214, 1085, 632]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "automatic"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "Iout"
		    Position		    [15, 38, 45, 52]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "Voc"
		    Position		    [15, 68, 45, 82]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "Rchg"
		    Position		    [15, 98, 45, 112]
		    Port		    "3"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "Rdchg"
		    Position		    [15, 263, 45, 277]
		    Port		    "4"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Goto
		    Name		    "Goto <sdo>3"
		    Position		    [385, 33, 490, 57]
		    GotoTag		    "ess_maxV_limited"
		    TagVisibility	    "global"
		    }
		    Block {
		    BlockType		    Fcn
		    Name		    "Imax chg=(Voc-Vmax)/R"
		    Position		    [150, 99, 180, 121]
		    Expr		    "(u(1)-u(3))/u(2)"
		    }
		    Block {
		    BlockType		    Fcn
		    Name		    "Imax dchg=(Voc -Vmin)/R"
		    Position		    [140, 264, 170, 286]
		    Expr		    "(u(3)-u(2))/u(1)"
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "Limits"
		    Ports		    [6]
		    Position		    [470, 232, 495, 333]
		    FontName		    "Arial"
		    ShowPortLabels	    off
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    System {
		    Name		    "Limits"
		    Location		    [298, 266, 645, 610]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "current req"
		    Position		    [20, 15, 40, 35]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "current bat\nlimited"
		    Position		    [20, 55, 40, 75]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "V used"
		    Position		    [20, 110, 40, 130]
		    Port		    "3"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "V mc_min_volts"
		    Position		    [20, 150, 40, 170]
		    Port		    "4"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "V battery (.5Voc)"
		    Position		    [20, 190, 40, 210]
		    Port		    "5"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "V ess_min_volts"
		    Position		    [15, 240, 35, 260]
		    Port		    "6"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Goto
		    Name		    "Goto <sdo>"
		    Position		    [230, 179, 320, 201]
		    GotoTag		    "ess_pwr_limited"
		    TagVisibility	    "global"
		    }
		    Block {
		    BlockType		    Goto
		    Name		    "Goto <sdo>1"
		    Position		    [230, 102, 340, 128]
		    GotoTag		    "mc_voltage_limited"
		    TagVisibility	    "global"
		    }
		    Block {
		    BlockType		    Goto
		    Name		    "Goto <sdo>2"
		    Position		    [225, 268, 330, 292]
		    GotoTag		    "ess_minV_limited"
		    TagVisibility	    "global"
		    }
		    Block {
		    BlockType		    RelationalOperator
		    Name		    "Relational\nOperator1"
		    Position		    [75, 42, 105, 73]
		    ShowName		    off
		    Operator		    "=="
		    }
		    Block {
		    BlockType		    RelationalOperator
		    Name		    "Relational\nOperator3"
		    Position		    [95, 112, 125, 143]
		    ShowName		    off
		    Operator		    "=="
		    }
		    Block {
		    BlockType		    RelationalOperator
		    Name		    "Relational\nOperator4"
		    Position		    [95, 177, 125, 208]
		    ShowName		    off
		    Operator		    "=="
		    }
		    Block {
		    BlockType		    RelationalOperator
		    Name		    "Relational\nOperator5"
		    Position		    [95, 227, 125, 258]
		    ShowName		    off
		    Operator		    "<="
		    }
		    Block {
		    BlockType		    Logic
		    Name		    "limited\nby battery"
		    Ports		    [2, 1]
		    Position		    [175, 172, 205, 203]
		    Operator		    "AND"
		    Inputs		    "2"
		    }
		    Block {
		    BlockType		    Logic
		    Name		    "limited\nby battery\nmin V"
		    Ports		    [2, 1]
		    Position		    [175, 262, 205, 293]
		    Operator		    "AND"
		    Inputs		    "2"
		    }
		    Block {
		    BlockType		    Logic
		    Name		    "limited by\nmotor controller"
		    Ports		    [2, 1]
		    Position		    [180, 97, 210, 128]
		    Operator		    "AND"
		    Inputs		    "2"
		    }
		    Line {
		    SrcBlock		    "current bat\nlimited"
		    SrcPort		    1
		    DstBlock		    "Relational\nOperator1"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "V mc_min_volts"
		    SrcPort		    1
		    Points		    [35, 0]
		    DstBlock		    "Relational\nOperator3"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "V used"
		    SrcPort		    1
		    Points		    [0, 0; 25, 0]
		    Branch {
		    DstBlock		    "Relational\nOperator3"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [0, 65]
		    Branch {
		    DstBlock		    "Relational\nOperator4"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [0, 50]
		    DstBlock		    "Relational\nOperator5"
		    DstPort		    1
		    }
		    }
		    }
		    Line {
		    SrcBlock		    "V battery (.5Voc)"
		    SrcPort		    1
		    DstBlock		    "Relational\nOperator4"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "V ess_min_volts"
		    SrcPort		    1
		    DstBlock		    "Relational\nOperator5"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "limited by\nmotor controller"
		    SrcPort		    1
		    DstBlock		    "Goto <sdo>1"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "limited\nby battery"
		    SrcPort		    1
		    DstBlock		    "Goto <sdo>"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "limited\nby battery\nmin V"
		    SrcPort		    1
		    DstBlock		    "Goto <sdo>2"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Relational\nOperator3"
		    SrcPort		    1
		    Points		    [35, 0]
		    DstBlock		    "limited by\nmotor controller"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "Relational\nOperator1"
		    SrcPort		    1
		    Points		    [30, 0; 0, 45]
		    Branch {
		    DstBlock		    "limited by\nmotor controller"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [0, 75]
		    Branch {
		    DstBlock		    "limited\nby battery"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [0, 90]
		    DstBlock		    "limited\nby battery\nmin V"
		    DstPort		    1
		    }
		    }
		    }
		    Line {
		    SrcBlock		    "Relational\nOperator4"
		    SrcPort		    1
		    DstBlock		    "limited\nby battery"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "Relational\nOperator5"
		    SrcPort		    1
		    Points		    [0, 40]
		    DstBlock		    "limited\nby battery\nmin V"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "current req"
		    SrcPort		    1
		    Points		    [15, 0]
		    DstBlock		    "Relational\nOperator1"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    Logic
		    Name		    "Logical\nOperator"
		    Ports		    [1, 1]
		    Position		    [270, 33, 295, 57]
		    ShowName		    off
		    Operator		    "NOT"
		    Inputs		    "2"
		    }
		    Block {
		    BlockType		    RelationalOperator
		    Name		    "Max Chg current\nnot exceeded"
		    Position		    [220, 62, 250, 93]
		    Operator		    ">"
		    }
		    Block {
		    BlockType		    RelationalOperator
		    Name		    "Max Dchg current\nnot exceeded"
		    Position		    [250, 217, 280, 248]
		    Operator		    ">"
		    }
		    Block {
		    BlockType		    Mux
		    Name		    "Mux"
		    Ports		    [3, 1]
		    Position		    [240, 126, 245, 164]
		    ShowName		    off
		    Inputs		    "3"
		    DisplayOption	    "bar"
		    }
		    Block {
		    BlockType		    Mux
		    Name		    "Mux2"
		    Ports		    [3, 1]
		    Position		    [120, 86, 125, 124]
		    ShowName		    off
		    Inputs		    "3"
		    DisplayOption	    "bar"
		    }
		    Block {
		    BlockType		    Mux
		    Name		    "Mux3"
		    Ports		    [3, 1]
		    Position		    [95, 261, 100, 289]
		    ShowName		    off
		    Inputs		    "3"
		    DisplayOption	    "bar"
		    }
		    Block {
		    BlockType		    Product
		    Name		    "Product"
		    Ports		    [2, 1]
		    Position		    [350, 124, 375, 151]
		    ShowName		    off
		    Inputs		    "2"
		    Multiplication	    "Element-wise(.*)"
		    SaturateOnIntegerOverflow on
		    }
		    Block {
		    BlockType		    Product
		    Name		    "Product1"
		    Ports		    [2, 1]
		    Position		    [270, 293, 295, 317]
		    ShowName		    off
		    Inputs		    "2"
		    Multiplication	    "Element-wise(.*)"
		    SaturateOnIntegerOverflow on
		    }
		    Block {
		    BlockType		    Saturate
		    Name		    "Saturation"
		    Position		    [470, 163, 490, 177]
		    ShowName		    off
		    UpperLimit		    "625*ess_parallel_mod_num"
		    LowerLimit		    "-625*ess_parallel_mod_num"
		    LinearizeAsGain	    on
		    }
		    Block {
		    BlockType		    Saturate
		    Name		    "Saturation1"
		    Position		    [190, 268, 210, 282]
		    ShowName		    off
		    UpperLimit		    "inf"
		    LowerLimit		    "0"
		    LinearizeAsGain	    on
		    }
		    Block {
		    BlockType		    Fcn
		    Name		    "Vmin"
		    Position		    [150, 302, 180, 318]
		    Expr		    "u(2)"
		    }
		    Block {
		    BlockType		    Fcn
		    Name		    "Voc-I*R"
		    Position		    [265, 136, 335, 154]
		    Expr		    "u(3)-u(1)*u(2)"
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "ess max voltage*#batts"
		    Position		    [70, 111, 95, 129]
		    ShowName		    off
		    FontName		    "Arial"
		    Value		    "ess_max_volts*ess_module_num"
		    VectorParams1D	    on
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "ess max voltage*#batts1"
		    Position		    [50, 375, 215, 395]
		    ShowName		    off
		    FontName		    "Arial"
		    Value		    "ess_min_volts*ess_module_num"
		    VectorParams1D	    on
		    }
		    Block {
		    BlockType		    Gain
		    Name		    "ess_module_num1"
		    Position		    [65, 330, 105, 360]
		    ShowName		    off
		    FontName		    "Arial"
		    Gain		    "0.5"
		    Multiplication	    "Element-wise(K.*u)"
		    SaturateOnIntegerOverflow on
		    }
		    Block {
		    BlockType		    MinMax
		    Name		    "limit by 0.5 battery \nor min mc "
"voltage \nor ess min"
		    Ports		    [3, 1]
		    Position		    [245, 338, 265, 372]
		    ShowName		    off
		    Function		    "max"
		    Inputs		    "3"
		    }
		    Block {
		    BlockType		    Switch
		    Name		    "limit current based on \nmax volt"
"age during charge"
		    Position		    [325, 65, 355, 95]
		    Threshold		    "0.5"
		    Port {
		    PortNumber		    1
		    Name		    "I_chgmax"
		    TestPoint		    off
		    LinearAnalysisOutput    off
		    LinearAnalysisInput	    off
		    RTWStorageClass	    "Auto"
		    }
		    }
		    Block {
		    BlockType		    Switch
		    Name		    "limit current based on \nmin volt"
"age during dcharge"
		    Position		    [420, 155, 450, 185]
		    ShowName		    off
		    Threshold		    "0.5"
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "mc min voltage"
		    Position		    [50, 356, 120, 374]
		    ShowName		    off
		    FontName		    "Arial"
		    Value		    "mc_min_volts"
		    VectorParams1D	    on
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "Iout_lim"
		    Position		    [510, 163, 540, 177]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "[]"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "mx chg pwr"
		    Position		    [510, 133, 540, 147]
		    Port		    "2"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "[]"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "mx dchg pwr"
		    Position		    [510, 193, 540, 207]
		    Port		    "3"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "[]"
		    }
		    Line {
		    SrcBlock		    "Mux2"
		    SrcPort		    1
		    Points		    [5, 0]
		    DstBlock		    "Imax chg=(Voc-Vmax)/R"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Iout"
		    SrcPort		    1
		    Points		    [5, 0]
		    Branch {
		    Points		    [140, 0; 0, 15]
		    Branch {
		    Points		    [0, 10]
		    DstBlock		    "Max Chg current\nnot exceeded"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [115, 0]
		    DstBlock		    "limit current based on \nmax volt"
"age during charge"
		    DstPort		    1
		    }
		    }
		    Branch {
		    Points		    [0, 180]
		    DstBlock		    "Max Dchg current\nnot exceeded"
		    DstPort		    1
		    }
		    }
		    Line {
		    SrcBlock		    "Imax chg=(Voc-Vmax)/R"
		    SrcPort		    1
		    Points		    [5, 0]
		    Branch {
		    Points		    [0, -25]
		    DstBlock		    "Max Chg current\nnot exceeded"
		    DstPort		    2
		    }
		    Branch {
		    Points		    [0, 10; 35, 0]
		    Branch {
		    DstBlock		    "Mux"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [50, 0]
		    Branch {
		    Points		    [0, -30]
		    DstBlock		    "limit current based on \nmax volt"
"age during charge"
		    DstPort		    3
		    }
		    Branch {
		    Points		    [0, 10]
		    DstBlock		    "Product"
		    DstPort		    1
		    }
		    }
		    }
		    }
		    Line {
		    SrcBlock		    "Rchg"
		    SrcPort		    1
		    Points		    [50, 0]
		    Branch {
		    DstBlock		    "Mux2"
		    DstPort		    2
		    }
		    Branch {
		    Points		    [0, 40]
		    DstBlock		    "Mux"
		    DstPort		    2
		    }
		    }
		    Line {
		    SrcBlock		    "Voc"
		    SrcPort		    1
		    Points		    [0, 20]
		    Branch {
		    DstBlock		    "Mux2"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [0, 60]
		    Branch {
		    DstBlock		    "Mux"
		    DstPort		    3
		    }
		    Branch {
		    Points		    [0, 130]
		    Branch {
		    DstBlock		    "Mux3"
		    DstPort		    3
		    }
		    Branch {
		    DstBlock		    "ess_module_num1"
		    DstPort		    1
		    }
		    }
		    }
		    }
		    Line {
		    SrcBlock		    "Mux"
		    SrcPort		    1
		    DstBlock		    "Voc-I*R"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Voc-I*R"
		    SrcPort		    1
		    DstBlock		    "Product"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "Product"
		    SrcPort		    1
		    DstBlock		    "mx chg pwr"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Max Chg current\nnot exceeded"
		    SrcPort		    1
		    Points		    [0, 0]
		    Branch {
		    DstBlock		    "limit current based on \nmax volt"
"age during charge"
		    DstPort		    2
		    }
		    Branch {
		    DstBlock		    "Logical\nOperator"
		    DstPort		    1
		    }
		    }
		    Line {
		    SrcBlock		    "Logical\nOperator"
		    SrcPort		    1
		    DstBlock		    "Goto <sdo>3"
		    DstPort		    1
		    }
		    Line {
		    Labels		    [2, 0]
		    SrcBlock		    "ess max voltage*#batts"
		    SrcPort		    1
		    Points		    [5, 0]
		    DstBlock		    "Mux2"
		    DstPort		    3
		    }
		    Line {
		    Name		    "I_chgmax"
		    Labels		    [1, 0]
		    SrcBlock		    "limit current based on \nmax volt"
"age during charge"
		    SrcPort		    1
		    Points		    [45, 0]
		    DstBlock		    "limit current based on \nmin volt"
"age during dcharge"
		    DstPort		    3
		    }
		    Line {
		    SrcBlock		    "limit current based on \nmin volt"
"age during dcharge"
		    SrcPort		    1
		    Points		    [0, 0]
		    Branch {
		    DstBlock		    "Saturation"
		    DstPort		    1
		    }
		    Branch {
		    DstBlock		    "Limits"
		    DstPort		    1
		    }
		    }
		    Line {
		    SrcBlock		    "Mux3"
		    SrcPort		    1
		    Points		    [0, 0]
		    Branch {
		    DstBlock		    "Imax dchg=(Voc -Vmin)/R"
		    DstPort		    1
		    }
		    Branch {
		    Labels		    [2, 0]
		    Points		    [0, 35]
		    DstBlock		    "Vmin"
		    DstPort		    1
		    }
		    }
		    Line {
		    SrcBlock		    "Imax dchg=(Voc -Vmin)/R"
		    SrcPort		    1
		    DstBlock		    "Saturation1"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "ess max voltage*#batts1"
		    SrcPort		    1
		    Points		    [10, 0]
		    Branch {
		    DstBlock		    "limit by 0.5 battery \nor min mc "
"voltage \nor ess min"
		    DstPort		    3
		    }
		    Branch {
		    Points		    [145, 0; 0, -65]
		    DstBlock		    "Limits"
		    DstPort		    6
		    }
		    }
		    Line {
		    SrcBlock		    "Rdchg"
		    SrcPort		    1
		    Points		    [30, 0]
		    DstBlock		    "Mux3"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Max Dchg current\nnot exceeded"
		    SrcPort		    1
		    Points		    [0, 15; 115, 0]
		    Branch {
		    Points		    [0, -80]
		    DstBlock		    "limit current based on \nmin volt"
"age during dcharge"
		    DstPort		    2
		    }
		    Branch {
		    Points		    [0, 10]
		    DstBlock		    "Limits"
		    DstPort		    2
		    }
		    }
		    Line {
		    SrcBlock		    "mc min voltage"
		    SrcPort		    1
		    Points		    [100, 0]
		    Branch {
		    Points		    [0, -10]
		    DstBlock		    "limit by 0.5 battery \nor min mc "
"voltage \nor ess min"
		    DstPort		    2
		    }
		    Branch {
		    Points		    [0, 10; 130, 0; 0, -85]
		    DstBlock		    "Limits"
		    DstPort		    4
		    }
		    }
		    Line {
		    SrcBlock		    "ess_module_num1"
		    SrcPort		    1
		    Points		    [110, 0]
		    Branch {
		    DstBlock		    "limit by 0.5 battery \nor min mc "
"voltage \nor ess min"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [0, 35; 145, 0; 0, -75]
		    DstBlock		    "Limits"
		    DstPort		    5
		    }
		    }
		    Line {
		    SrcBlock		    "limit by 0.5 battery \nor min mc "
"voltage \nor ess min"
		    SrcPort		    1
		    Points		    [0, -20]
		    Branch {
		    Points		    [75, 0; 0, -60]
		    DstBlock		    "Limits"
		    DstPort		    3
		    }
		    Branch {
		    Points		    [-190, 0]
		    DstBlock		    "Mux3"
		    DstPort		    2
		    }
		    }
		    Line {
		    SrcBlock		    "Vmin"
		    SrcPort		    1
		    DstBlock		    "Product1"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "Product1"
		    SrcPort		    1
		    Points		    [30, 0; 0, -105]
		    DstBlock		    "mx dchg pwr"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Saturation"
		    SrcPort		    1
		    DstBlock		    "Iout_lim"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Saturation1"
		    SrcPort		    1
		    Points		    [5, 0]
		    Branch {
		    Points		    [0, -35]
		    DstBlock		    "Max Dchg current\nnot exceeded"
		    DstPort		    2
		    }
		    Branch {
		    Labels		    [1, 0]
		    Points		    [0, 15; 25, 0]
		    Branch {
		    Points		    [0, 10]
		    DstBlock		    "Product1"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [75, 0; 0, -130]
		    DstBlock		    "limit current based on \nmin volt"
"age during dcharge"
		    DstPort		    1
		    }
		    }
		    }
		  }
		}
		Block {
		  BlockType		  Gain
		  Name			  "mod #"
		  Position		  [65, 64, 90, 86]
		  Gain			  "ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Outport
		  Name			  "Iout"
		  Position		  [600, 78, 630, 92]
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "[]"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Voc*k"
		  Position		  [605, 158, 635, 172]
		  Port			  "2"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "[]"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Rs"
		  Position		  [605, 188, 635, 202]
		  Port			  "3"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "[]"
		}
		Line {
		  SrcBlock		  "Preq"
		  SrcPort		  1
		  Points		  [40, 0]
		  Branch {
		    Points		    [0, 15]
		    DstBlock		    "Prdct"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, -20]
		    DstBlock		    "SOC limit"
		    DstPort		    2
		  }
		}
		Line {
		  SrcBlock		  "SOC"
		  SrcPort		  1
		  DstBlock		  "SOC limit"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Mux"
		  SrcPort		  1
		  DstBlock		  "Iout=(Voc-(Voc^2-4RPout)^.5)\n     "
"  -----------------------------\n(2*R)"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Rdis\n(ohms)"
		  SrcPort		  1
		  DstBlock		  "R scale fn"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "R scale fn"
		  SrcPort		  1
		  DstBlock		  "Parallel1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Rchg\n(ohms)"
		  SrcPort		  1
		  DstBlock		  "R2 scale fn"
		  DstPort		  1
		}
		Line {
		  Labels		  [0, 0]
		  SrcBlock		  "Prdct"
		  SrcPort		  1
		  Points		  [0, 30; -80, 0; 0, 25]
		  Branch {
		    DstBlock		    "Abs"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, 55]
		    Branch {
		    Points		    [0, 35; 170, 0; 0, -20]
		    DstBlock		    "Switch2"
		    DstPort		    2
		    }
		    Branch {
		    DstBlock		    "-1*|u|"
		    DstPort		    1
		    }
		  }
		}
		Line {
		  SrcBlock		  "Abs"
		  SrcPort		  1
		  DstBlock		  "Rdis\n(ohms)"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "-1*|u|"
		  SrcPort		  1
		  DstBlock		  "Rchg\n(ohms)"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "R2 scale fn"
		  SrcPort		  1
		  DstBlock		  "Parallel"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "SOC limit"
		  SrcPort		  1
		  Points		  [5, 0; 0, 45]
		  DstBlock		  "Mux"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Switch2"
		  SrcPort		  1
		  Points		  [0, 0]
		  Branch {
		    DstBlock		    "Rs"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, 0]
		    DstBlock		    "Mux"
		    DstPort		    3
		  }
		}
		Line {
		  SrcBlock		  "limit power"
		  SrcPort		  1
		  Points		  [60, 0]
		  Branch {
		    Points		    [50, 0]
		    DstBlock		    "Iout"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, -45]
		    DstBlock		    "To Workspace"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "Iout=(Voc-(Voc^2-4RPout)^.5)\n     "
"  -----------------------------\n(2*R)"
		  SrcPort		  1
		  DstBlock		  "limit power"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Voc"
		  SrcPort		  1
		  DstBlock		  "mod #"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "mod #"
		  SrcPort		  1
		  Points		  [0, 0]
		  Branch {
		    Points		    [0, 0; 0, 20; 105, 0]
		    Branch {
		    Points		    [0, -15]
		    DstBlock		    "Mux"
		    DstPort		    2
		    }
		    Branch {
		    Points		    [0, 5; 95, 0; 0, 5]
		    Branch {
		    DstBlock		    "limit power"
		    DstPort		    2
		    }
		    Branch {
		    Points		    [0, 80; 295, 0]
		    DstBlock		    "Voc*k"
		    DstPort		    1
		    }
		    }
		  }
		  Branch {
		    DstBlock		    "Prdct"
		    DstPort		    2
		  }
		}
		Line {
		  SrcBlock		  "tmp"
		  SrcPort		  1
		  Points		  [55, 0]
		  Branch {
		    DstBlock		    "Rdis\n(ohms)"
		    DstPort		    1
		  }
		  Branch {
		    DstBlock		    "Rchg\n(ohms)"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "Memory"
		  SrcPort		  1
		  DstBlock		  "Goto <cs>1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "limit power"
		  SrcPort		  3
		  DstBlock		  "Memory"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "limit power"
		  SrcPort		  2
		  DstBlock		  "Memory1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Memory1"
		  SrcPort		  1
		  DstBlock		  "Goto <cs>2"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Parallel1"
		  SrcPort		  1
		  Points		  [5, 0; 0, 5]
		  Branch {
		    Labels		    [1, 0]
		    DstBlock		    "Switch2"
		    DstPort		    1
		  }
		  Branch {
		    DstBlock		    "limit power"
		    DstPort		    4
		  }
		}
		Line {
		  SrcBlock		  "Parallel"
		  SrcPort		  1
		  Points		  [5, 0]
		  Branch {
		    Points		    [0, 30]
		    DstBlock		    "Switch2"
		    DstPort		    3
		  }
		  Branch {
		    Points		    [0, -60]
		    DstBlock		    "limit power"
		    DstPort		    3
		  }
		}
	      }
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Calculate SOC"
	      Ports		      [3, 1]
	      Position		      [190, 199, 235, 241]
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"Calculate SOC"
		Location		[463, 615, 843, 784]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"automatic"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "Voc"
		  Position		  [15, 15, 45, 30]
		  Orientation		  "down"
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "Iout"
		  Position		  [15, 43, 45, 57]
		  Port			  "2"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "C"
		  Position		  [15, 103, 45, 117]
		  Port			  "3"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Clock
		  Name			  "Clock"
		  Position		  [15, 140, 35, 160]
		  ShowName		  off
		  DisplayTime		  off
		  Decimation		  "10"
		}
		Block {
		  BlockType		  Gain
		  Name			  "Gain"
		  Position		  [40, 65, 60, 90]
		  Orientation		  "up"
		  NamePlacement		  "alternate"
		  ShowName		  off
		  Gain			  "ess_parallel_mod_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Memory
		  Name			  "Memory"
		  Position		  [84, 120, 96, 135]
		  Orientation		  "up"
		  ShowName		  off
		  X0			  "0"
		  InheritSampleTime	  off
		  RTWStateStorageClass	  "Auto"
		}
		Block {
		  BlockType		  Mux
		  Name			  "Mux1"
		  Ports			  [4, 1]
		  Position		  [90, 36, 95, 74]
		  ShowName		  off
		  Inputs		  "4"
		  DisplayOption		  "bar"
		}
		Block {
		  BlockType		  Saturate
		  Name			  "Saturation"
		  Position		  [305, 50, 325, 70]
		  Orientation		  "up"
		  NamePlacement		  "alternate"
		  ShowName		  off
		  UpperLimit		  "1"
		  LowerLimit		  "0"
		  LinearizeAsGain	  on
		}
		Block {
		  BlockType		  Fcn
		  Name			  "Soc = (Voc(n+1)-Vmin)/(Vmax-Vmin)"
		  Position		  [240, 90, 300, 120]
		  Expr			  "(u(1)-0)/(2.5-0)"
		}
		Block {
		  BlockType		  Sum
		  Name			  "Sum"
		  Ports			  [2, 1]
		  Position		  [55, 105, 75, 125]
		  Orientation		  "up"
		  ShowName		  off
		  IconShape		  "round"
		  Inputs		  "|+-"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Fcn
		  Name			  "Voc (n+1) = Voc(n) - I*(dt)/C"
		  Position		  [130, 65, 190, 95]
		  Expr			  "(u(1) - u(2)*u(4)/u(3))"
		}
		Block {
		  BlockType		  Outport
		  Name			  "SOC"
		  Position		  [330, 13, 360, 27]
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "[]"
		}
		Line {
		  SrcBlock		  "Voc"
		  SrcPort		  1
		  Points		  [45, 0]
		  DstBlock		  "Mux1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Mux1"
		  SrcPort		  1
		  Points		  [15, 0]
		  DstBlock		  "Voc (n+1) = Voc(n) - I*(dt)/C"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Iout"
		  SrcPort		  1
		  DstBlock		  "Mux1"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Voc (n+1) = Voc(n) - I*(dt)/C"
		  SrcPort		  1
		  Points		  [30, 0]
		  DstBlock		  "Soc = (Voc(n+1)-Vmin)/(Vmax-Vmin)"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "C"
		  SrcPort		  1
		  DstBlock		  "Gain"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Soc = (Voc(n+1)-Vmin)/(Vmax-Vmin)"
		  SrcPort		  1
		  Points		  [10, 0]
		  DstBlock		  "Saturation"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Memory"
		  SrcPort		  1
		  DstBlock		  "Sum"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Clock"
		  SrcPort		  1
		  Points		  [0, 0; 25, 0]
		  Branch {
		    DstBlock		    "Memory"
		    DstPort		    1
		  }
		  Branch {
		    DstBlock		    "Sum"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "Sum"
		  SrcPort		  1
		  Points		  [0, -30]
		  DstBlock		  "Mux1"
		  DstPort		  4
		}
		Line {
		  SrcBlock		  "Saturation"
		  SrcPort		  1
		  DstBlock		  "SOC"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Gain"
		  SrcPort		  1
		  DstBlock		  "Mux1"
		  DstPort		  3
		}
	      }
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "Fcn"
	      Position		      [300, 324, 330, 346]
	      ShowName		      off
	      Expr		      "u[1]*u[1]*u[2]/ess_parallel_mod_num*(u["
"1]>=0)+u[1]*u[1]*u(4)*u(4)*u[2]/ess_parallel_mod_num*(u[1]<0)-u[1]*u[3]*(1-u("
"4))*(u[1]<0)"
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <cs>"
	      Position		      [590, 265, 640, 285]
	      GotoTag		      "ess_tmp"
	      TagVisibility	      "global"
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <mc>, <gc>, <sdo>"
	      Position		      [590, 70, 670, 90]
	      GotoTag		      "bus_voltage"
	      TagVisibility	      "global"
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <sdo1"
	      Position		      [320, 15, 400, 35]
	      GotoTag		      "ess_current"
	      TagVisibility	      "global"
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <sdo>, <cs>"
	      Position		      [595, 209, 640, 231]
	      GotoTag		      "SOC"
	      TagVisibility	      "global"
	    }
	    Block {
	      BlockType		      Memory
	      Name		      "Memory"
	      Position		      [255, 209, 270, 231]
	      ShowName		      off
	      X0		      "ess_init_soc"
	      InheritSampleTime	      off
	      RTWStateStorageClass    "Auto"
	    }
	    Block {
	      BlockType		      Memory
	      Name		      "Memory1"
	      Position		      [470, 305, 485, 325]
	      ShowName		      off
	      X0		      "ess_mod_init_tmp"
	      InheritSampleTime	      off
	      RTWStateStorageClass    "Auto"
	    }
	    Block {
	      BlockType		      Memory
	      Name		      "Memory3"
	      Position		      [535, 69, 550, 91]
	      ShowName		      off
	      X0		      "(ess_init_soc*(2.5-0)+0)*ess_module_num"
	      InheritSampleTime	      off
	      RTWStateStorageClass    "Auto"
	    }
	    Block {
	      BlockType		      Mux
	      Name		      "Mux"
	      Ports		      [4, 1]
	      Position		      [275, 111, 280, 149]
	      ShowName		      off
	      Inputs		      "4"
	      DisplayOption	      "bar"
	    }
	    Block {
	      BlockType		      Mux
	      Name		      "Mux1"
	      Ports		      [3, 1]
	      Position		      [270, 55, 275, 85]
	      ShowName		      off
	      Inputs		      "3"
	      DisplayOption	      "bar"
	    }
	    Block {
	      BlockType		      Product
	      Name		      "Product"
	      Ports		      [2, 1]
	      Position		      [440, 45, 455, 65]
	      ShowName		      off
	      FontName		      "Arial"
	      Inputs		      "2"
	      Multiplication	      "Element-wise(.*)"
	      SaturateOnIntegerOverflow	on
	      Port {
		PortNumber		1
		Name			"Power"
		TestPoint		off
		LinearAnalysisOutput	off
		LinearAnalysisInput	off
		RTWStorageClass		"Auto"
	      }
	    }
	    Block {
	      BlockType		      Saturate
	      Name		      "Saturate I"
	      Position		      [125, 178, 150, 192]
	      Orientation	      "left"
	      UpperLimit	      "225"
	      LowerLimit	      "-225"
	      LinearizeAsGain	      on
	    }
	    Block {
	      BlockType		      Saturate
	      Name		      "Saturate T"
	      Position		      [455, 268, 480, 282]
	      Orientation	      "left"
	      UpperLimit	      "40"
	      LowerLimit	      "0"
	      LinearizeAsGain	      on
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS1"
	      Position		      [304, 365, 386, 380]
	      Orientation	      "down"
	      NamePlacement	      "alternate"
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_pwr_loss_a"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "0"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS2"
	      Position		      [515, 308, 585, 322]
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_mod_tmp"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "0"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS3"
	      Position		      [515, 328, 585, 342]
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_air_tmp"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "0"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS4"
	      Position		      [515, 349, 590, 361]
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_air_th_pwr"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "0"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS5"
	      Position		      [595, 112, 675, 128]
	      NamePlacement	      "alternate"
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_voltage"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "0"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To Workspace8"
	      Position		      [85, 25, 155, 45]
	      NamePlacement	      "alternate"
	      ShowName		      off
	      VariableName	      "ess_pwr_out_r"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "-1"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To Workspace9"
	      Position		      [505, 19, 580, 41]
	      NamePlacement	      "alternate"
	      ShowName		      off
	      VariableName	      "ess_pwr_out_a"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "-1"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "Voc = soc*(Vmax-Vmin) + Vmin"
	      Position		      [65, 54, 125, 76]
	      Expr		      "u(1)*(2.5-0) + 0"
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "Voc-I*R"
	      Position		      [315, 59, 395, 81]
	      Expr		      "u[2] - u[1]*u[3]"
	      Port {
		PortNumber		1
		Name			"Voltage"
		TestPoint		off
		LinearAnalysisOutput	off
		LinearAnalysisInput	off
		RTWStorageClass		"Auto"
	      }
	    }
	    Block {
	      BlockType		      Reference
	      Name		      "coul eff"
	      Ports		      [2, 1]
	      Position		      [210, 136, 240, 154]
	      SourceBlock	      "simulink3/Functions\n& Tables/Look-Up\n"
"Table (2-D)"
	      SourceType	      "Lookup Table (2-D)"
	      x			      "ess_tmp"
	      y			      "ess_i"
	      t			      "ess_coulombic_eff"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "do ex calcs?"
	      Position		      [375, 280, 435, 295]
	      Orientation	      "down"
	      ShowName		      off
	      Value		      "ess_th_calc"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "ess tmp"
	      Ports		      [1, 3, 1]
	      Position		      [360, 308, 450, 362]
	      ShowName		      off
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      on
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"ess tmp"
		Location		[515, 664, 1056, 934]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "Qess_gen"
		  Position		  [25, 205, 45, 225]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  EnablePort
		  Name			  "Enable"
		  Ports			  []
		  Position		  [390, 217, 420, 243]
		  StatesWhenEnabling	  "reset"
		  ShowOutputPort	  off
		}
		Block {
		  BlockType		  Gain
		  Name			  "#of mods"
		  Position		  [390, 88, 415, 112]
		  Gain			  "ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Gain
		  Name			  "1/#of mods"
		  Position		  [95, 203, 120, 227]
		  Gain			  "1/ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Gain
		  Name			  "1/mcp"
		  Position		  [380, 153, 405, 177]
		  Gain			  "1/(ess_module_mass*ess_mod_cp)"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Block NOTES"
		  Ports			  []
		  Position		  [445, 220, 501, 260]
		  BackgroundColor	  "green"
		  ShowName		  off
		  ShowPortLabels	  on
		  TreatAsAtomicUnit	  off
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  MaskDisplay		  "disp('Block\\nNOTES')"
		  MaskIconFrame		  on
		  MaskIconOpaque	  on
		  MaskIconRotate	  "none"
		  MaskIconUnits		  "autoscale"
		  System {
		    Name		    "Block NOTES"
		    Location		    [505, 510, 924, 573]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Annotation {
		    Position		    [207, 33]
		    Text		    "This block models the thermal beh"
"avior of a battery module with active air cooling.\nThe module is modeled as "
"a single lumped thermal mass.  \nThe fan is on whenever the battery temp is >"
" the set temp."
		    }
		  }
		}
		Block {
		  BlockType		  Memory
		  Name			  "Memory"
		  Position		  [250, 165, 285, 185]
		  Orientation		  "left"
		  FontName		  "Arial"
		  X0			  "cyc_mph(1,2)*.447"
		  InheritSampleTime	  off
		  RTWStateStorageClass	  "Auto"
		}
		Block {
		  BlockType		  Memory
		  Name			  "Memory1"
		  Position		  [100, 30, 135, 50]
		  Orientation		  "left"
		  FontName		  "Arial"
		  X0			  "cyc_mph(1,2)*.447"
		  InheritSampleTime	  off
		  RTWStateStorageClass	  "Auto"
		}
		Block {
		  BlockType		  Mux
		  Name			  "Mux20"
		  Ports			  [3, 1]
		  Position		  [195, 84, 200, 156]
		  NamePlacement		  "alternate"
		  ShowName		  off
		  Inputs		  "3"
		  DisplayOption		  "none"
		}
		Block {
		  BlockType		  Sum
		  Name			  "Qc"
		  Ports			  [2, 1]
		  Position		  [350, 114, 360, 221]
		  ShowName		  off
		  IconShape		  "rectangular"
		  Inputs		  "++"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Fcn
		  Name			  "Qess_case"
		  Position		  [235, 108, 315, 132]
		  NamePlacement		  "alternate"
		  FontName		  "Arial"
		  Expr			  "(u(2) - u(1))/u(3)"
		}
		Block {
		  BlockType		  Saturate
		  Name			  "Saturation3"
		  Position		  [190, 29, 200, 51]
		  Orientation		  "left"
		  ShowName		  off
		  UpperLimit		  "1"
		  LowerLimit		  "0"
		  LinearizeAsGain	  on
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Tair,ave"
		  Ports			  [1, 2, 1]
		  Position		  [30, 107, 140, 158]
		  ShowPortLabels	  on
		  TreatAsAtomicUnit	  on
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  System {
		    Name		    "Tair,ave"
		    Location		    [351, 78, 751, 306]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "Qess_case"
		    Position		    [45, 35, 65, 55]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    EnablePort
		    Name		    "Enable"
		    Ports		    []
		    Position		    [265, 167, 295, 193]
		    StatesWhenEnabling	    "reset"
		    ShowOutputPort	    off
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "Block NOTES"
		    Ports		    []
		    Position		    [325, 165, 381, 205]
		    BackgroundColor	    "green"
		    ShowName		    off
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    MaskDisplay		    "disp('Block\\nNOTES')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "autoscale"
		    System {
		    Name		    "Block NOTES"
		    Location		    [505, 510, 924, 573]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Annotation {
		    Position		    [207, 33]
		    Text		    "This block determins the average "
"temperature of the cooling air over the module."
		    }
		    }
		    }
		    Block {
		    BlockType		    Fcn
		    Name		    "Tamb-(Q/mcp)/2"
		    Position		    [90, 34, 330, 56]
		    Expr		    "amb_tmp - (u(1)/(ess_mod_airflow*"
"air_cp))/2 "
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "do ex calcs?1"
		    Position		    [35, 105, 115, 125]
		    ShowName		    off
		    Value		    "ess_th_res_on"
		    VectorParams1D	    on
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "Tair_ave"
		    Position		    [355, 35, 375, 55]
		    Port		    "1"
		    OutputWhenDisabled	    "reset"
		    InitialOutput	    "amb_tmp"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "Th Res"
		    Position		    [355, 105, 375, 125]
		    Port		    "2"
		    OutputWhenDisabled	    "reset"
		    InitialOutput	    "ess_th_res_off"
		    }
		    Line {
		    SrcBlock		    "Tamb-(Q/mcp)/2"
		    SrcPort		    1
		    DstBlock		    "Tair_ave"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Qess_case"
		    SrcPort		    1
		    DstBlock		    "Tamb-(Q/mcp)/2"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "do ex calcs?1"
		    SrcPort		    1
		    DstBlock		    "Th Res"
		    DstPort		    1
		    }
		  }
		}
		Block {
		  BlockType		  Integrator
		  Name			  "Tess2"
		  Ports			  [1, 1]
		  Position		  [420, 155, 440, 175]
		  ExternalReset		  "none"
		  InitialConditionSource  "internal"
		  InitialCondition	  "ess_mod_init_tmp"
		  LimitOutput		  off
		  UpperSaturationLimit	  "inf"
		  LowerSaturationLimit	  "-inf"
		  ShowSaturationPort	  off
		  ShowStatePort		  off
		  AbsoluteTolerance	  "auto"
		}
		Block {
		  BlockType		  Fcn
		  Name			  "thermostat"
		  Position		  [235, 29, 340, 51]
		  Orientation		  "left"
		  NamePlacement		  "alternate"
		  FontName		  "Arial"
		  Expr			  "u(1) - ess_set_tmp"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Tess"
		  Position		  [470, 155, 490, 175]
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Tair"
		  Position		  [470, 60, 490, 80]
		  NamePlacement		  "alternate"
		  Port			  "2"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "[]"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Qair"
		  Position		  [470, 90, 490, 110]
		  Port			  "3"
		  OutputWhenDisabled	  "reset"
		  InitialOutput		  "0"
		}
		Line {
		  SrcBlock		  "Qc"
		  SrcPort		  1
		  DstBlock		  "1/mcp"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Qess_case"
		  SrcPort		  1
		  Points		  [5, 0]
		  Branch {
		    Points		    [10, 0]
		    DstBlock		    "Qc"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, 55]
		    DstBlock		    "Memory"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, -20]
		    DstBlock		    "#of mods"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "1/mcp"
		  SrcPort		  1
		  DstBlock		  "Tess2"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Tess2"
		  SrcPort		  1
		  Points		  [0, 0]
		  Branch {
		    DstBlock		    "Tess"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, -85; -80, 0]
		    Branch {
		    Points		    [-185, 0]
		    DstBlock		    "Mux20"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [0, -40]
		    DstBlock		    "thermostat"
		    DstPort		    1
		    }
		  }
		}
		Line {
		  SrcBlock		  "Qess_gen"
		  SrcPort		  1
		  DstBlock		  "1/#of mods"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "1/#of mods"
		  SrcPort		  1
		  Points		  [210, 0]
		  DstBlock		  "Qc"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "thermostat"
		  SrcPort		  1
		  DstBlock		  "Saturation3"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Saturation3"
		  SrcPort		  1
		  DstBlock		  "Memory1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Memory1"
		  SrcPort		  1
		  Points		  [-10, 0]
		  DstBlock		  "Tair,ave"
		  DstPort		  enable
		}
		Line {
		  SrcBlock		  "Memory"
		  SrcPort		  1
		  Points		  [-230, 0]
		  DstBlock		  "Tair,ave"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "#of mods"
		  SrcPort		  1
		  DstBlock		  "Qair"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Mux20"
		  SrcPort		  1
		  DstBlock		  "Qess_case"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Tair,ave"
		  SrcPort		  2
		  DstBlock		  "Mux20"
		  DstPort		  3
		}
		Line {
		  SrcBlock		  "Tair,ave"
		  SrcPort		  1
		  Points		  [10, 0]
		  Branch {
		    DstBlock		    "Mux20"
		    DstPort		    2
		  }
		  Branch {
		    Points		    [0, -50]
		    DstBlock		    "Tair"
		    DstPort		    1
		  }
		}
	      }
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "power available\nto bus (W)"
	      Position		      [635, 45, 655, 65]
	      NamePlacement	      "alternate"
	      FontName		      "Arial"
	      Port		      "1"
	      OutputWhenDisabled      "held"
	      InitialOutput	      "0"
	    }
	    Line {
	      Labels		      [0, 0]
	      SrcBlock		      "power req'd\ninto bus (W)"
	      SrcPort		      1
	      Points		      [20, 0]
	      Branch {
		DstBlock		"Calc Iout"
		DstPort			1
	      }
	      Branch {
		DstBlock		"To Workspace8"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Memory"
	      SrcPort		      1
	      Points		      [0, 0; 5, 0]
	      Branch {
		DstBlock		"Goto <sdo>, <cs>"
		DstPort			1
	      }
	      Branch {
		Points			[0, 40; -190, 0; 0, -165]
		Branch {
		  Points		  [-70, 0; 0, -30]
		  DstBlock		  "Voc = soc*(Vmax-Vmin) + Vmin"
		  DstPort		  1
		}
		Branch {
		  DstBlock		  "Calc Iout"
		  DstPort		  4
		}
	      }
	    }
	    Line {
	      Name		      "Power"
	      SrcBlock		      "Product"
	      SrcPort		      1
	      Points		      [25, 0]
	      Branch {
		DstBlock		"power available\nto bus (W)"
		DstPort			1
	      }
	      Branch {
		Points			[0, -25]
		DstBlock		"To Workspace9"
		DstPort			1
	      }
	    }
	    Line {
	      Name		      "Iout"
	      SrcBlock		      "Calc Iout"
	      SrcPort		      1
	      Points		      [0, -15; 15, 0]
	      Branch {
		Points			[0, 20]
		Branch {
		  Points		  [0, 55]
		  DstBlock		  "Mux"
		  DstPort		  1
		}
		Branch {
		  DstBlock		  "Mux1"
		  DstPort		  1
		}
	      }
	      Branch {
		Points			[30, 0]
		Branch {
		  Points		  [0, 10; 15, 0]
		  Branch {
		    DstBlock		    "Product"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, 135; -125, 0]
		    Branch {
		    DstBlock		    "Calculate SOC"
		    DstPort		    2
		    }
		    Branch {
		    DstBlock		    "Saturate I"
		    DstPort		    1
		    }
		  }
		}
		Branch {
		  Labels		  [1, 1]
		  Points		  [0, -15]
		  DstBlock		  "Goto <sdo1"
		  DstPort		  1
		}
	      }
	    }
	    Line {
	      SrcBlock		      "coul eff"
	      SrcPort		      1
	      DstBlock		      "Mux"
	      DstPort		      4
	    }
	    Line {
	      SrcBlock		      "Mux"
	      SrcPort		      1
	      DstBlock		      "Fcn"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Mux1"
	      SrcPort		      1
	      DstBlock		      "Voc-I*R"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Calc Iout"
	      SrcPort		      3
	      Points		      [5, 0; 0, 0]
	      Branch {
		Points			[0, 30]
		DstBlock		"Mux"
		DstPort			2
	      }
	      Branch {
		Points			[0, -15]
		DstBlock		"Mux1"
		DstPort			3
	      }
	    }
	    Line {
	      SrcBlock		      "Fcn"
	      SrcPort		      1
	      Points		      [0, 0; 10, 0]
	      Branch {
		DstBlock		"ess tmp"
		DstPort			1
	      }
	      Branch {
		DstBlock		"To WS1"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "do ex calcs?"
	      SrcPort		      1
	      DstBlock		      "ess tmp"
	      DstPort		      enable
	    }
	    Line {
	      SrcBlock		      "ess tmp"
	      SrcPort		      1
	      DstBlock		      "Memory1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "ess tmp"
	      SrcPort		      2
	      DstBlock		      "To WS3"
	      DstPort		      1
	    }
	    Line {
	      Labels		      [0, 0]
	      SrcBlock		      "Memory1"
	      SrcPort		      1
	      Points		      [5, 0; 0, -40]
	      Branch {
		DstBlock		"Goto <cs>"
		DstPort			1
	      }
	      Branch {
		Points			[0, 40]
		Branch {
		  DstBlock		  "To WS2"
		  DstPort		  1
		}
		Branch {
		  DstBlock		  "Saturate T"
		  DstPort		  1
		}
	      }
	    }
	    Line {
	      SrcBlock		      "ess tmp"
	      SrcPort		      3
	      DstBlock		      "To WS4"
	      DstPort		      1
	    }
	    Line {
	      Name		      "Voltage"
	      SrcBlock		      "Voc-I*R"
	      SrcPort		      1
	      Points		      [5, 0; 0, 0]
	      Branch {
		Points			[0, 0; 10, 0]
		Branch {
		  Points		  [0, -10]
		  DstBlock		  "Product"
		  DstPort		  2
		}
		Branch {
		  Points		  [0, 10]
		  DstBlock		  "Memory3"
		  DstPort		  1
		}
	      }
	      Branch {
		Points			[0, 30; -155, 0; 0, 35]
		DstBlock		"Mux"
		DstPort			3
	      }
	    }
	    Line {
	      SrcBlock		      "Memory3"
	      SrcPort		      1
	      Points		      [10, 0]
	      Branch {
		DstBlock		"Goto <mc>, <gc>, <sdo>"
		DstPort			1
	      }
	      Branch {
		Points			[0, 40]
		DstBlock		"To WS5"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Calculate SOC"
	      SrcPort		      1
	      DstBlock		      "Memory"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "C\n(Farads)"
	      SrcPort		      1
	      DstBlock		      "Calculate SOC"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "Voc = soc*(Vmax-Vmin) + Vmin"
	      SrcPort		      1
	      Points		      [35, 0]
	      Branch {
		DstBlock		"Calc Iout"
		DstPort			2
	      }
	      Branch {
		Points			[0, 140]
		DstBlock		"Calculate SOC"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Saturate I"
	      SrcPort		      1
	      Points		      [-10, 0]
	      Branch {
		Points			[0, 55]
		DstBlock		"C\n(Farads)"
		DstPort			2
	      }
	      Branch {
		Points			[0, -35]
		DstBlock		"coul eff"
		DstPort			2
	      }
	    }
	    Line {
	      SrcBlock		      "Calc Iout"
	      SrcPort		      2
	      Points		      [0, -5]
	      DstBlock		      "Mux1"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Saturate T"
	      SrcPort		      1
	      Points		      [-350, 0; 0, -45; 0, 0]
	      Branch {
		DstBlock		"C\n(Farads)"
		DstPort			1
	      }
	      Branch {
		Points			[0, 0; 0, -90; 70, 0]
		Branch {
		  DstBlock		  "coul eff"
		  DstPort		  1
		}
		Branch {
		  Points		  [0, -60]
		  DstBlock		  "Calc Iout"
		  DstPort		  3
		}
	      }
	    }
	  }
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "energy\nstorage <ess>"
	  Ports			  [1, 1]
	  Position		  [85, 88, 150, 132]
	  BackgroundColor	  "yellow"
	  ShowPortLabels	  off
	  TreatAsAtomicUnit	  off
	  RTWSystemCode		  "Auto"
	  RTWFcnNameOpts	  "Auto"
	  RTWFileNameOpts	  "Auto"
	  MaskDisplay		  "image(imread('bdi_ess.jpg'))"
	  MaskIconFrame		  on
	  MaskIconOpaque	  on
	  MaskIconRotate	  "none"
	  MaskIconUnits		  "autoscale"
	  System {
	    Name		    "energy\nstorage <ess>"
	    Location		    [242, 317, 1015, 779]
	    Open		    off
	    ModelBrowserVisibility  off
	    ModelBrowserWidth	    200
	    ScreenColor		    "white"
	    PaperOrientation	    "landscape"
	    PaperPositionMode	    "auto"
	    PaperType		    "usletter"
	    PaperUnits		    "inches"
	    ZoomFactor		    "100"
	    Block {
	      BlockType		      Inport
	      Name		      "power req'd\ninto bus (W)"
	      Position		      [55, 160, 75, 180]
	      FontName		      "Arial"
	      Port		      "1"
	      LatchInput	      off
	      Interpolate	      on
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Block NOTES"
	      Ports		      []
	      Position		      [560, 365, 616, 405]
	      BackgroundColor	      "green"
	      ShowName		      off
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      MaskDisplay	      "disp('Block\\nNOTES')"
	      MaskIconFrame	      on
	      MaskIconOpaque	      on
	      MaskIconRotate	      "none"
	      MaskIconUnits	      "autoscale"
	      System {
		Name			"Block NOTES"
		Location		[256, 329, 741, 634]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Annotation {
		  Position		  [242, 146]
		  Text			  "This block models the energy storag"
"e system as an SOC-dependent voltage\nin series with an SOC- and current dire"
"ction-dependent internal resistance.\nSOC is computed assuming that A-h capac"
"ity is constant, but limited\nsuch that a minimum voltage is never exceeded ("
"replacing the \nprevious Peukert relationship which underpredicted battery ca"
"pacity).\n\nDischarge power is limited here so as not to bring the bus (batte"
"ry pack) voltage below\nthe minimum controller voltage or the minimum battery"
" voltage and so as to allow \nthe solution of the quadratic eq'n for discharg"
"e current.\n\nCharge current is limited to ensure the voltage does not exceed"
" a maximum\nvoltage\n\nPositive current is discharge current in the conventio"
"n used here.\nPower loss is computed as I*R+losses due to Coulombic (in)effic"
"iency.\n\nThermal modeling of the battery performance is modeled in the\nOCV,"
" Rint, and capacity."
		}
	      }
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Const"
	      Position		      [520, 70, 590, 90]
	      Orientation	      "down"
	      ShowName		      off
	      FontName		      "Arial"
	      Value		      "enable_stop"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Fcn
	      Name		      "Fcn"
	      Position		      [340, 274, 370, 296]
	      ShowName		      off
	      Expr		      "u[1]*u[1]*u[2]*(u[1]>=0)+u[1]*u[1]*u[2]"
"*u(4)*u(4)*(u[1]<0)-u[1]*u[3]*(1-u(4))*(u[1]<0)"
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto"
	      Position		      [415, 85, 495, 105]
	      GotoTag		      "ess_pwr_out_a"
	      TagVisibility	      "global"
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <cs>"
	      Position		      [580, 320, 630, 340]
	      GotoTag		      "ess_tmp"
	      TagVisibility	      "global"
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <cs>1"
	      Position		      [300, 15, 380, 35]
	      GotoTag		      "ess_max_pwr"
	      TagVisibility	      "global"
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <cs>2"
	      Position		      [295, 50, 400, 70]
	      GotoTag		      "ess_max_chg_pwr"
	      TagVisibility	      "global"
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <mc>, <gc>, <sdo>"
	      Position		      [330, 210, 410, 230]
	      GotoTag		      "bus_voltage"
	      TagVisibility	      "global"
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <sdo>, <cs>"
	      Position		      [150, 99, 195, 121]
	      GotoTag		      "SOC"
	      TagVisibility	      "global"
	    }
	    Block {
	      BlockType		      Memory
	      Name		      "Memory"
	      Position		      [515, 255, 530, 275]
	      ShowName		      off
	      X0		      "ess_mod_init_tmp"
	      InheritSampleTime	      off
	      RTWStateStorageClass    "Auto"
	    }
	    Block {
	      BlockType		      Mux
	      Name		      "Mux"
	      Ports		      [4, 1]
	      Position		      [305, 269, 325, 301]
	      Inputs		      "4"
	      DisplayOption	      "none"
	    }
	    Block {
	      BlockType		      Product
	      Name		      "Product"
	      Ports		      [2, 1]
	      Position		      [330, 168, 360, 192]
	      ShowName		      off
	      FontName		      "Arial"
	      Inputs		      "2"
	      Multiplication	      "Element-wise(.*)"
	      SaturateOnIntegerOverflow	on
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "SOC\nalgorithm"
	      Ports		      [2, 1]
	      Position		      [335, 101, 365, 134]
	      FontName		      "Arial"
	      ShowPortLabels	      off
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"SOC\nalgorithm"
		Location		[98, 388, 878, 660]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "(A)"
		  Position		  [15, 35, 35, 55]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "tmp\n(C)"
		  Position		  [20, 125, 40, 145]
		  Port			  "2"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Gain
		  Name			  "(sec->hrs)"
		  Position		  [265, 43, 330, 77]
		  Gain			  "1/3600"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Saturate
		  Name			  "0 <= SOC <= 1"
		  Position		  [650, 121, 680, 139]
		  UpperLimit		  "1"
		  LowerLimit		  "0"
		  LinearizeAsGain	  on
		}
		Block {
		  BlockType		  Sum
		  Name			  "A-h\nremaining"
		  Ports			  [2, 1]
		  Position		  [505, 85, 525, 105]
		  IconShape		  "rectangular"
		  Inputs		  "-+"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Integrator
		  Name			  "Ah used"
		  Ports			  [2, 1]
		  Position		  [425, 50, 445, 70]
		  ExternalReset		  "none"
		  InitialConditionSource  "external"
		  InitialCondition	  "(1-ess_init_soc)*ess_max_ah_cap"
		  LimitOutput		  off
		  UpperSaturationLimit	  "inf"
		  LowerSaturationLimit	  "-inf"
		  ShowSaturationPort	  off
		  ShowStatePort		  off
		  AbsoluteTolerance	  "auto"
		}
		Block {
		  BlockType		  Fcn
		  Name			  "Fcn"
		  Position		  [500, 150, 540, 170]
		  ShowName		  off
		  Expr			  "1/u"
		}
		Block {
		  BlockType		  Fcn
		  Name			  "Fcn1"
		  Position		  [285, 96, 385, 114]
		  ShowName		  off
		  Expr			  "(1-ess_init_soc)*u"
		}
		Block {
		  BlockType		  Product
		  Name			  "SOC"
		  Ports			  [2, 1]
		  Position		  [580, 118, 610, 142]
		  Inputs		  "2"
		  Multiplication	  "Element-wise(.*)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Switch
		  Name			  "Switch"
		  Position		  [205, 35, 235, 85]
		  ShowName		  off
		  Threshold		  "0"
		}
		Block {
		  BlockType		  Product
		  Name			  "adjusted A"
		  Ports			  [2, 1]
		  Position		  [135, 63, 165, 87]
		  Inputs		  "2"
		  Multiplication	  "Element-wise(.*)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Lookup
		  Name			  "coul eff"
		  Position		  [75, 88, 105, 112]
		  InputValues		  "ess_tmp"
		  OutputValues		  "ess_coulombic_eff"
		}
		Block {
		  BlockType		  Lookup
		  Name			  "max cap"
		  Position		  [200, 128, 230, 152]
		  InputValues		  "ess_tmp"
		  OutputValues		  "ess_max_ah_cap*ess_cap_scale"
		}
		Block {
		  BlockType		  Outport
		  Name			  "SOC1"
		  Position		  [725, 120, 745, 140]
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Line {
		  SrcBlock		  "Fcn1"
		  SrcPort		  1
		  Points		  [20, 0]
		  DstBlock		  "Ah used"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "max cap"
		  SrcPort		  1
		  Points		  [30, 0]
		  Branch {
		    Points		    [0, -35]
		    DstBlock		    "Fcn1"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [170, 0; 0, -30; 50, 0]
		    Branch {
		    DstBlock		    "Fcn"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [5, 0]
		    DstBlock		    "A-h\nremaining"
		    DstPort		    2
		    }
		  }
		}
		Line {
		  SrcBlock		  "adjusted A"
		  SrcPort		  1
		  DstBlock		  "Switch"
		  DstPort		  3
		}
		Line {
		  SrcBlock		  "coul eff"
		  SrcPort		  1
		  Points		  [10, 0]
		  DstBlock		  "adjusted A"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "tmp\n(C)"
		  SrcPort		  1
		  Points		  [15, 0]
		  Branch {
		    DstBlock		    "coul eff"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [125, 0]
		    DstBlock		    "max cap"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "0 <= SOC <= 1"
		  SrcPort		  1
		  DstBlock		  "SOC1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "A-h\nremaining"
		  SrcPort		  1
		  Points		  [35, 0]
		  DstBlock		  "SOC"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "SOC"
		  SrcPort		  1
		  DstBlock		  "0 <= SOC <= 1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Fcn"
		  SrcPort		  1
		  Points		  [20, 0]
		  DstBlock		  "SOC"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Ah used"
		  SrcPort		  1
		  Points		  [40, 0]
		  DstBlock		  "A-h\nremaining"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "(sec->hrs)"
		  SrcPort		  1
		  Points		  [75, 0]
		  DstBlock		  "Ah used"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Switch"
		  SrcPort		  1
		  DstBlock		  "(sec->hrs)"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "(A)"
		  SrcPort		  1
		  Points		  [5, 0]
		  Branch {
		    Points		    [0, 25]
		    DstBlock		    "adjusted A"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [130, 0]
		    Branch {
		    DstBlock		    "Switch"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [0, 15]
		    DstBlock		    "Switch"
		    DstPort		    2
		    }
		  }
		}
		Annotation {
		  Position		  [533, 207]
		  Text			  "SOC=(Max Ah capacity-Ah used)/Max A"
"h capacity"
		}
	      }
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS1"
	      Position		      [339, 315, 421, 330]
	      Orientation	      "down"
	      NamePlacement	      "alternate"
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_pwr_loss_a"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "0"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS2"
	      Position		      [560, 258, 630, 272]
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_mod_tmp"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "0"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS3"
	      Position		      [560, 278, 630, 292]
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_air_tmp"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "0"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS4"
	      Position		      [560, 299, 635, 311]
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_air_th_pwr"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "0"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To Workspace8"
	      Position		      [45, 265, 115, 285]
	      Orientation	      "left"
	      VariableName	      "ess_pwr_out_r"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "-1"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To Workspace9"
	      Position		      [415, 124, 490, 146]
	      VariableName	      "ess_pwr_out_a"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "-1"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "compute\ncurrent"
	      Ports		      [3, 2]
	      Position		      [230, 151, 260, 209]
	      ShowPortLabels	      off
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"compute\ncurrent"
		Location		[50, 278, 909, 675]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "Voc"
		  Position		  [155, 80, 175, 100]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "Rint"
		  Position		  [155, 130, 175, 150]
		  Port			  "2"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "limited output\npower (W)"
		  Position		  [155, 30, 175, 50]
		  Port			  "3"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Goto
		  Name			  "Goto <sdo>4"
		  Position		  [725, 208, 830, 232]
		  GotoTag		  "ess_maxV_limited"
		  TagVisibility		  "global"
		}
		Block {
		  BlockType		  Fcn
		  Name			  "Ibty=(Voc-(Voc^2-4RPbty)^.5)\n     "
"  -----------------------------\n(2*R)"
		  Position		  [340, 79, 370, 101]
		  Expr			  "(u[2]-(u[2]^2-4*u[1]*u[3])^.5)/(2*u"
"[3])"
		}
		Block {
		  BlockType		  Logic
		  Name			  "Logical\nOperator1"
		  Ports			  [1, 1]
		  Position		  [680, 208, 710, 232]
		  ShowName		  off
		  Operator		  "NOT"
		  Inputs		  "1"
		}
		Block {
		  BlockType		  Mux
		  Name			  "Mux3"
		  Ports			  [3, 1]
		  Position		  [570, 313, 590, 347]
		  Inputs		  "3"
		  DisplayOption		  "none"
		}
		Block {
		  BlockType		  Mux
		  Name			  "Mux4"
		  Ports			  [3, 1]
		  Position		  [245, 16, 265, 164]
		  Inputs		  "3"
		  DisplayOption		  "none"
		}
		Block {
		  BlockType		  Mux
		  Name			  "Mux5"
		  Ports			  [3, 1]
		  Position		  [250, 186, 270, 274]
		  Inputs		  "3"
		  DisplayOption		  "none"
		}
		Block {
		  BlockType		  ToWorkspace
		  Name			  "To Workspace9"
		  Position		  [685, 14, 760, 36]
		  VariableName		  "ess_current"
		  MaxDataPoints		  "inf"
		  Decimation		  "1"
		  SampleTime		  "-1"
		  SaveFormat		  "Array"
		}
		Block {
		  BlockType		  Fcn
		  Name			  "Voc-I*R"
		  Position		  [625, 319, 705, 341]
		  Expr			  "u[2]-u[1]*u[3]"
		}
		Block {
		  BlockType		  Constant
		  Name			  "ess max voltage*#batts"
		  Position		  [25, 220, 190, 240]
		  FontName		  "Arial"
		  Value			  "ess_max_volts*ess_module_num"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Fcn
		  Name			  "iabs min=(Voc-Vmax)/R"
		  Position		  [340, 164, 370, 186]
		  Expr			  "(u(1)-u(2))/u(3)"
		}
		Block {
		  BlockType		  Switch
		  Name			  "limit current based on \nmax voltag"
"e during charge"
		  Position		  [575, 125, 605, 155]
		  Threshold		  "eps"
		}
		Block {
		  BlockType		  RelationalOperator
		  Name			  "min charge current\nnot exceeded"
		  Position		  [455, 122, 485, 153]
		  Operator		  ">"
		}
		Block {
		  BlockType		  Outport
		  Name			  "I_"
		  Position		  [710, 130, 730, 150]
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Block {
		  BlockType		  Outport
		  Name			  "V_"
		  Position		  [730, 320, 750, 340]
		  Port			  "2"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Line {
		  SrcBlock		  "Logical\nOperator1"
		  SrcPort		  1
		  DstBlock		  "Goto <sdo>4"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "ess max voltage*#batts"
		  SrcPort		  1
		  DstBlock		  "Mux5"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Mux5"
		  SrcPort		  1
		  Points		  [20, 0; 0, -55]
		  DstBlock		  "iabs min=(Voc-Vmax)/R"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Mux4"
		  SrcPort		  1
		  DstBlock		  "Ibty=(Voc-(Voc^2-4RPbty)^.5)\n     "
"  -----------------------------\n(2*R)"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Voc-I*R"
		  SrcPort		  1
		  DstBlock		  "V_"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Mux3"
		  SrcPort		  1
		  DstBlock		  "Voc-I*R"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "min charge current\nnot exceeded"
		  SrcPort		  1
		  Points		  [30, 0]
		  Branch {
		    Points		    [0, 80]
		    DstBlock		    "Logical\nOperator1"
		    DstPort		    1
		  }
		  Branch {
		    DstBlock		    "limit current based on \nmax volt"
"age during charge"
		    DstPort		    2
		  }
		}
		Line {
		  SrcBlock		  "limit current based on \nmax voltag"
"e during charge"
		  SrcPort		  1
		  Points		  [50, 0]
		  Branch {
		    Points		    [0, 160; -105, 0]
		    DstBlock		    "Mux3"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [10, 0]
		    Branch {
		    DstBlock		    "To Workspace9"
		    DstPort		    1
		    }
		    Branch {
		    DstBlock		    "I_"
		    DstPort		    1
		    }
		  }
		}
		Line {
		  SrcBlock		  "iabs min=(Voc-Vmax)/R"
		  SrcPort		  1
		  Points		  [35, 0]
		  Branch {
		    Points		    [0, 15; 105, 0; 0, -40]
		    DstBlock		    "limit current based on \nmax volt"
"age during charge"
		    DstPort		    3
		  }
		  Branch {
		    Points		    [0, -30]
		    DstBlock		    "min charge current\nnot exceeded"
		    DstPort		    2
		  }
		}
		Line {
		  SrcBlock		  "Ibty=(Voc-(Voc^2-4RPbty)^.5)\n     "
"  -----------------------------\n(2*R)"
		  SrcPort		  1
		  Points		  [55, 0]
		  Branch {
		    Points		    [90, 0; 0, 40]
		    DstBlock		    "limit current based on \nmax volt"
"age during charge"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, 40]
		    DstBlock		    "min charge current\nnot exceeded"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "Rint"
		  SrcPort		  1
		  Points		  [20, 0]
		  Branch {
		    Points		    [0, 120]
		    Branch {
		    DstBlock		    "Mux5"
		    DstPort		    3
		    }
		    Branch {
		    Points		    [0, 80]
		    DstBlock		    "Mux3"
		    DstPort		    3
		    }
		  }
		  Branch {
		    DstBlock		    "Mux4"
		    DstPort		    3
		  }
		}
		Line {
		  SrcBlock		  "Voc"
		  SrcPort		  1
		  Points		  [35, 0]
		  Branch {
		    Points		    [0, 110]
		    Branch {
		    DstBlock		    "Mux5"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [0, 130]
		    DstBlock		    "Mux3"
		    DstPort		    2
		    }
		  }
		  Branch {
		    DstBlock		    "Mux4"
		    DstPort		    2
		  }
		}
		Line {
		  SrcBlock		  "limited output\npower (W)"
		  SrcPort		  1
		  DstBlock		  "Mux4"
		  DstPort		  1
		}
	      }
	    }
	    Block {
	      BlockType		      Lookup
	      Name		      "coul eff"
	      Position		      [255, 358, 285, 382]
	      InputValues	      "ess_tmp"
	      OutputValues	      "ess_coulombic_eff"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "do ex calcs?"
	      Position		      [420, 230, 480, 245]
	      Orientation	      "down"
	      ShowName		      off
	      Value		      "ess_th_calc"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "documentation9"
	      Ports		      []
	      Position		      [630, 366, 659, 405]
	      BackgroundColor	      "orange"
	      DropShadow	      on
	      ShowName		      off
	      OpenFcn		      "web(['file:\\\\\\' which('energy_storag"
"e.htm')]);"
	      ShowPortLabels	      off
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      MaskDisplay	      "image(imread('doc_man.jpg'))"
	      MaskIconFrame	      on
	      MaskIconOpaque	      on
	      MaskIconRotate	      "none"
	      MaskIconUnits	      "autoscale"
	      System {
		Name			"documentation9"
		Location		[129, 62, 308, 146]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
	      }
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "ess tmp"
	      Ports		      [1, 3, 1]
	      Position		      [405, 258, 495, 312]
	      ShowName		      off
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      on
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"ess tmp"
		Location		[433, 252, 964, 522]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "Qess_gen"
		  Position		  [25, 205, 45, 225]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  EnablePort
		  Name			  "Enable"
		  Ports			  []
		  Position		  [390, 217, 420, 243]
		  StatesWhenEnabling	  "reset"
		  ShowOutputPort	  off
		}
		Block {
		  BlockType		  Gain
		  Name			  "#of mods"
		  Position		  [390, 88, 415, 112]
		  Gain			  "ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Gain
		  Name			  "1/#of mods"
		  Position		  [95, 203, 120, 227]
		  Gain			  "1/ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Gain
		  Name			  "1/mcp"
		  Position		  [380, 153, 405, 177]
		  Gain			  "1/(ess_module_mass*ess_mod_cp)"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Block NOTES"
		  Ports			  []
		  Position		  [445, 220, 501, 260]
		  BackgroundColor	  "green"
		  ShowName		  off
		  ShowPortLabels	  on
		  TreatAsAtomicUnit	  off
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  MaskDisplay		  "disp('Block\\nNOTES')"
		  MaskIconFrame		  on
		  MaskIconOpaque	  on
		  MaskIconRotate	  "none"
		  MaskIconUnits		  "autoscale"
		  System {
		    Name		    "Block NOTES"
		    Location		    [505, 510, 924, 573]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Annotation {
		    Position		    [207, 33]
		    Text		    "This block models the thermal beh"
"avior of a battery module with active air cooling.\nThe module is modeled as "
"a single lumped thermal mass.  \nThe fan is on whenever the battery temp is >"
" the set temp."
		    }
		  }
		}
		Block {
		  BlockType		  Memory
		  Name			  "Memory"
		  Position		  [250, 165, 285, 185]
		  Orientation		  "left"
		  FontName		  "Arial"
		  X0			  "cyc_mph(1,2)*.447"
		  InheritSampleTime	  off
		  RTWStateStorageClass	  "Auto"
		}
		Block {
		  BlockType		  Memory
		  Name			  "Memory1"
		  Position		  [100, 30, 135, 50]
		  Orientation		  "left"
		  FontName		  "Arial"
		  X0			  "cyc_mph(1,2)*.447"
		  InheritSampleTime	  off
		  RTWStateStorageClass	  "Auto"
		}
		Block {
		  BlockType		  Mux
		  Name			  "Mux20"
		  Ports			  [3, 1]
		  Position		  [195, 84, 200, 156]
		  NamePlacement		  "alternate"
		  ShowName		  off
		  Inputs		  "3"
		  DisplayOption		  "none"
		}
		Block {
		  BlockType		  Sum
		  Name			  "Qc"
		  Ports			  [2, 1]
		  Position		  [350, 114, 360, 221]
		  ShowName		  off
		  IconShape		  "rectangular"
		  Inputs		  "++"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Fcn
		  Name			  "Qess_case"
		  Position		  [235, 108, 315, 132]
		  NamePlacement		  "alternate"
		  FontName		  "Arial"
		  Expr			  "(u(2) - u(1))/u(3)"
		}
		Block {
		  BlockType		  Saturate
		  Name			  "Saturation3"
		  Position		  [190, 29, 200, 51]
		  Orientation		  "left"
		  ShowName		  off
		  UpperLimit		  "1"
		  LowerLimit		  "0"
		  LinearizeAsGain	  on
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Tair,ave"
		  Ports			  [1, 2, 1]
		  Position		  [30, 107, 140, 158]
		  ShowPortLabels	  on
		  TreatAsAtomicUnit	  on
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  System {
		    Name		    "Tair,ave"
		    Location		    [347, 78, 747, 306]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "Qess_case"
		    Position		    [45, 35, 65, 55]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    EnablePort
		    Name		    "Enable"
		    Ports		    []
		    Position		    [265, 167, 295, 193]
		    StatesWhenEnabling	    "reset"
		    ShowOutputPort	    off
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "Block NOTES"
		    Ports		    []
		    Position		    [325, 165, 381, 205]
		    BackgroundColor	    "green"
		    ShowName		    off
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    MaskDisplay		    "disp('Block\\nNOTES')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "autoscale"
		    System {
		    Name		    "Block NOTES"
		    Location		    [505, 510, 924, 573]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Annotation {
		    Position		    [207, 33]
		    Text		    "This block determins the average "
"temperature of the cooling air over the module."
		    }
		    }
		    }
		    Block {
		    BlockType		    Fcn
		    Name		    "Tamb-(Q/mcp)/2"
		    Position		    [90, 34, 330, 56]
		    Expr		    "amb_tmp - (u(1)/(ess_mod_airflow*"
"air_cp))/2 "
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "do ex calcs?1"
		    Position		    [35, 105, 115, 125]
		    ShowName		    off
		    Value		    "ess_th_res_on"
		    VectorParams1D	    on
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "Tair_ave"
		    Position		    [355, 35, 375, 55]
		    Port		    "1"
		    OutputWhenDisabled	    "reset"
		    InitialOutput	    "amb_tmp"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "Th Res"
		    Position		    [355, 105, 375, 125]
		    Port		    "2"
		    OutputWhenDisabled	    "reset"
		    InitialOutput	    "ess_th_res_off"
		    }
		    Line {
		    SrcBlock		    "do ex calcs?1"
		    SrcPort		    1
		    DstBlock		    "Th Res"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Qess_case"
		    SrcPort		    1
		    DstBlock		    "Tamb-(Q/mcp)/2"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Tamb-(Q/mcp)/2"
		    SrcPort		    1
		    DstBlock		    "Tair_ave"
		    DstPort		    1
		    }
		  }
		}
		Block {
		  BlockType		  Integrator
		  Name			  "Tess2"
		  Ports			  [1, 1]
		  Position		  [420, 155, 440, 175]
		  ExternalReset		  "none"
		  InitialConditionSource  "internal"
		  InitialCondition	  "ess_mod_init_tmp"
		  LimitOutput		  off
		  UpperSaturationLimit	  "inf"
		  LowerSaturationLimit	  "-inf"
		  ShowSaturationPort	  off
		  ShowStatePort		  off
		  AbsoluteTolerance	  "auto"
		}
		Block {
		  BlockType		  Fcn
		  Name			  "thermostat"
		  Position		  [235, 29, 340, 51]
		  Orientation		  "left"
		  NamePlacement		  "alternate"
		  FontName		  "Arial"
		  Expr			  "u(1) - ess_set_tmp"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Tess"
		  Position		  [470, 155, 490, 175]
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Tair"
		  Position		  [470, 60, 490, 80]
		  NamePlacement		  "alternate"
		  Port			  "2"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "[]"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Qair"
		  Position		  [470, 90, 490, 110]
		  Port			  "3"
		  OutputWhenDisabled	  "reset"
		  InitialOutput		  "0"
		}
		Line {
		  SrcBlock		  "Tair,ave"
		  SrcPort		  1
		  Points		  [10, 0]
		  Branch {
		    Points		    [0, -50]
		    DstBlock		    "Tair"
		    DstPort		    1
		  }
		  Branch {
		    DstBlock		    "Mux20"
		    DstPort		    2
		  }
		}
		Line {
		  SrcBlock		  "Tair,ave"
		  SrcPort		  2
		  DstBlock		  "Mux20"
		  DstPort		  3
		}
		Line {
		  SrcBlock		  "Mux20"
		  SrcPort		  1
		  DstBlock		  "Qess_case"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "#of mods"
		  SrcPort		  1
		  DstBlock		  "Qair"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Memory"
		  SrcPort		  1
		  Points		  [-230, 0]
		  DstBlock		  "Tair,ave"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Memory1"
		  SrcPort		  1
		  Points		  [-10, 0]
		  DstBlock		  "Tair,ave"
		  DstPort		  enable
		}
		Line {
		  SrcBlock		  "Saturation3"
		  SrcPort		  1
		  DstBlock		  "Memory1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "thermostat"
		  SrcPort		  1
		  DstBlock		  "Saturation3"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "1/#of mods"
		  SrcPort		  1
		  Points		  [210, 0]
		  DstBlock		  "Qc"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Qess_gen"
		  SrcPort		  1
		  DstBlock		  "1/#of mods"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Tess2"
		  SrcPort		  1
		  Points		  [0, 0]
		  Branch {
		    Points		    [0, -85; -80, 0]
		    Branch {
		    Points		    [0, -40]
		    DstBlock		    "thermostat"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [-185, 0]
		    DstBlock		    "Mux20"
		    DstPort		    1
		    }
		  }
		  Branch {
		    DstBlock		    "Tess"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "1/mcp"
		  SrcPort		  1
		  DstBlock		  "Tess2"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Qess_case"
		  SrcPort		  1
		  Points		  [5, 0]
		  Branch {
		    Points		    [0, -20]
		    DstBlock		    "#of mods"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, 55]
		    DstBlock		    "Memory"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [10, 0]
		    DstBlock		    "Qc"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "Qc"
		  SrcPort		  1
		  DstBlock		  "1/mcp"
		  DstPort		  1
		}
	      }
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "limit power"
	      Ports		      [4, 1]
	      Position		      [225, 239, 255, 296]
	      ShowPortLabels	      off
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"limit power"
		Location		[-52, 144, 972, 657]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "SOC"
		  Position		  [15, 45, 35, 65]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "Pbty"
		  Position		  [15, 135, 35, 155]
		  Port			  "2"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "Voc"
		  Position		  [15, 195, 35, 215]
		  Port			  "3"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "Rint"
		  Position		  [390, 270, 410, 290]
		  Orientation		  "left"
		  Port			  "4"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Constant
		  Name			  "Constant1"
		  Position		  [245, 60, 280, 80]
		  ShowName		  off
		  Value			  "eps"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Constant
		  Name			  "Constant2"
		  Position		  [290, 99, 315, 121]
		  ShowName		  off
		  Value			  "0"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Constant
		  Name			  "Constant3"
		  Position		  [705, 284, 730, 306]
		  Value			  "0"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Constant
		  Name			  "Constant4"
		  Position		  [897, 185, 923, 205]
		  Orientation		  "down"
		  NamePlacement		  "alternate"
		  ShowName		  off
		  Value			  "0"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Constant
		  Name			  "Constant5"
		  Position		  [650, 36, 685, 54]
		  ShowName		  off
		  Value			  ".999"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Constant
		  Name			  "Constant6"
		  Position		  [725, 74, 750, 96]
		  ShowName		  off
		  Value			  "0"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Gain
		  Name			  "Gain"
		  Position		  [135, 222, 165, 248]
		  ShowName		  off
		  FontName		  "Arial"
		  Gain			  "0.5"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Limits"
		  Ports			  [8]
		  Position		  [700, 333, 730, 472]
		  FontName		  "Arial"
		  ShowPortLabels	  off
		  TreatAsAtomicUnit	  off
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  System {
		    Name		    "Limits"
		    Location		    [407, 389, 973, 980]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "SOC \nhigh limited"
		    Position		    [40, 15, 60, 35]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "not SOC \nlow limited"
		    Position		    [35, 70, 55, 90]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "power req"
		    Position		    [35, 145, 55, 165]
		    Port		    "3"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "power bat\nlimited"
		    Position		    [35, 220, 55, 240]
		    Port		    "4"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "V used"
		    Position		    [35, 300, 55, 320]
		    Port		    "5"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "V mc_min_volts"
		    Position		    [40, 375, 60, 395]
		    Port		    "6"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "V battery (.5Voc)"
		    Position		    [40, 435, 60, 455]
		    Port		    "7"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "V ess_min_volts"
		    Position		    [40, 510, 60, 530]
		    Port		    "8"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Goto
		    Name		    "Goto <sdo>"
		    Position		    [385, 369, 475, 391]
		    GotoTag		    "ess_pwr_limited"
		    TagVisibility	    "global"
		    }
		    Block {
		    BlockType		    Goto
		    Name		    "Goto <sdo>1"
		    Position		    [385, 292, 495, 318]
		    GotoTag		    "mc_voltage_limited"
		    TagVisibility	    "global"
		    }
		    Block {
		    BlockType		    Goto
		    Name		    "Goto <sdo>2"
		    Position		    [320, 69, 430, 91]
		    GotoTag		    "ess_soc_low_limited"
		    TagVisibility	    "global"
		    }
		    Block {
		    BlockType		    Goto
		    Name		    "Goto <sdo>3"
		    Position		    [385, 458, 490, 482]
		    GotoTag		    "ess_minV_limited"
		    TagVisibility	    "global"
		    }
		    Block {
		    BlockType		    Goto
		    Name		    "Goto <sdo>4"
		    Position		    [330, 19, 440, 41]
		    GotoTag		    "ess_soc_hi_limited"
		    TagVisibility	    "global"
		    }
		    Block {
		    BlockType		    Logic
		    Name		    "Logical\nOperator1"
		    Ports		    [1, 1]
		    Position		    [270, 64, 300, 96]
		    Operator		    "NOT"
		    Inputs		    "1"
		    }
		    Block {
		    BlockType		    RelationalOperator
		    Name		    "Relational\nOperator1"
		    Position		    [125, 172, 155, 203]
		    ShowName		    off
		    Operator		    "=="
		    }
		    Block {
		    BlockType		    RelationalOperator
		    Name		    "Relational\nOperator3"
		    Position		    [185, 317, 215, 348]
		    ShowName		    off
		    Operator		    "=="
		    }
		    Block {
		    BlockType		    RelationalOperator
		    Name		    "Relational\nOperator4"
		    Position		    [190, 402, 220, 433]
		    ShowName		    off
		    Operator		    "=="
		    }
		    Block {
		    BlockType		    RelationalOperator
		    Name		    "Relational\nOperator5"
		    Position		    [185, 497, 215, 528]
		    ShowName		    off
		    Operator		    "=="
		    }
		    Block {
		    BlockType		    Logic
		    Name		    "limited\nby battery"
		    Ports		    [2, 1]
		    Position		    [330, 362, 360, 393]
		    Operator		    "AND"
		    Inputs		    "2"
		    }
		    Block {
		    BlockType		    Logic
		    Name		    "limited\nby battery\nmin V"
		    Ports		    [2, 1]
		    Position		    [330, 452, 360, 483]
		    Operator		    "AND"
		    Inputs		    "2"
		    }
		    Block {
		    BlockType		    Logic
		    Name		    "limited by\nmotor controller"
		    Ports		    [2, 1]
		    Position		    [335, 287, 365, 318]
		    Operator		    "AND"
		    Inputs		    "2"
		    }
		    Line {
		    SrcBlock		    "SOC \nhigh limited"
		    SrcPort		    1
		    Points		    [250, 0]
		    DstBlock		    "Goto <sdo>4"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "not SOC \nlow limited"
		    SrcPort		    1
		    DstBlock		    "Logical\nOperator1"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Logical\nOperator1"
		    SrcPort		    1
		    DstBlock		    "Goto <sdo>2"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "power req"
		    SrcPort		    1
		    Points		    [50, 0]
		    DstBlock		    "Relational\nOperator1"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Relational\nOperator5"
		    SrcPort		    1
		    Points		    [95, 0]
		    DstBlock		    "limited\nby battery\nmin V"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "Relational\nOperator4"
		    SrcPort		    1
		    Points		    [90, 0]
		    DstBlock		    "limited\nby battery"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "Relational\nOperator1"
		    SrcPort		    1
		    Points		    [105, 0; 0, 105]
		    Branch {
		    Points		    [0, 75]
		    Branch {
		    Points		    [0, 90]
		    DstBlock		    "limited\nby battery\nmin V"
		    DstPort		    1
		    }
		    Branch {
		    DstBlock		    "limited\nby battery"
		    DstPort		    1
		    }
		    }
		    Branch {
		    DstBlock		    "limited by\nmotor controller"
		    DstPort		    1
		    }
		    }
		    Line {
		    SrcBlock		    "Relational\nOperator3"
		    SrcPort		    1
		    Points		    [100, 0]
		    DstBlock		    "limited by\nmotor controller"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "limited\nby battery\nmin V"
		    SrcPort		    1
		    DstBlock		    "Goto <sdo>3"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "limited\nby battery"
		    SrcPort		    1
		    DstBlock		    "Goto <sdo>"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "limited by\nmotor controller"
		    SrcPort		    1
		    DstBlock		    "Goto <sdo>1"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "V ess_min_volts"
		    SrcPort		    1
		    DstBlock		    "Relational\nOperator5"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "V battery (.5Voc)"
		    SrcPort		    1
		    Points		    [110, 0]
		    DstBlock		    "Relational\nOperator4"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "V used"
		    SrcPort		    1
		    Points		    [70, 0; 0, 15]
		    Branch {
		    Points		    [0, 85]
		    Branch {
		    Points		    [0, 95]
		    DstBlock		    "Relational\nOperator5"
		    DstPort		    1
		    }
		    Branch {
		    DstBlock		    "Relational\nOperator4"
		    DstPort		    1
		    }
		    }
		    Branch {
		    DstBlock		    "Relational\nOperator3"
		    DstPort		    1
		    }
		    }
		    Line {
		    SrcBlock		    "V mc_min_volts"
		    SrcPort		    1
		    Points		    [105, 0]
		    DstBlock		    "Relational\nOperator3"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "power bat\nlimited"
		    SrcPort		    1
		    Points		    [50, 0]
		    DstBlock		    "Relational\nOperator1"
		    DstPort		    2
		    }
		  }
		}
		Block {
		  BlockType		  Logic
		  Name			  "Logical\nOperator"
		  Ports			  [2, 1]
		  Position		  [465, 57, 495, 88]
		  ShowName		  off
		  Operator		  "OR"
		  Inputs		  "2"
		}
		Block {
		  BlockType		  Logic
		  Name			  "Logical\nOperator1"
		  Ports			  [2, 1]
		  Position		  [830, 32, 860, 63]
		  ShowName		  off
		  Operator		  "AND"
		  Inputs		  "2"
		}
		Block {
		  BlockType		  Mux
		  Name			  "Mux"
		  Ports			  [3, 1]
		  Position		  [390, 198, 410, 232]
		  FontName		  "Arial"
		  Inputs		  "3"
		  DisplayOption		  "none"
		}
		Block {
		  BlockType		  RelationalOperator
		  Name			  "Relational\nOperator"
		  Position		  [330, 47, 360, 78]
		  ShowName		  off
		  Operator		  ">"
		}
		Block {
		  BlockType		  RelationalOperator
		  Name			  "Relational\nOperator3"
		  Position		  [405, 87, 435, 118]
		  NamePlacement		  "alternate"
		  ShowName		  off
		  Operator		  "<"
		}
		Block {
		  BlockType		  RelationalOperator
		  Name			  "SOC>=.999"
		  Position		  [715, 22, 745, 53]
		  Operator		  ">="
		}
		Block {
		  BlockType		  RelationalOperator
		  Name			  "charging\n(Preq is neg)"
		  Position		  [770, 62, 800, 93]
		  Operator		  "<"
		}
		Block {
		  BlockType		  Fcn
		  Name			  "discharge\nmax power allowed\n(-0.1"
" is for safety, to prevent\ntaking the square of a tiny\n-ive # in I=I(P) els"
"ewhere)"
		  Position		  [425, 201, 555, 229]
		  FontName		  "Arial"
		  Expr			  "(u[1]-u[2])*u[2]/u[3]-0.1"
		}
		Block {
		  BlockType		  Constant
		  Name			  "ess minimum voltage"
		  Position		  [25, 335, 115, 355]
		  FontName		  "Arial"
		  Value			  "ess_min_volts"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Gain
		  Name			  "ess_module_num"
		  Position		  [135, 330, 200, 360]
		  FontName		  "Arial"
		  Gain			  "ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  MinMax
		  Name			  "limit by battery max\nor min mc vol"
"tage\nor ess min"
		  Ports			  [3, 1]
		  Position		  [255, 220, 285, 320]
		  Function		  "max"
		  Inputs		  "3"
		}
		Block {
		  BlockType		  Constant
		  Name			  "mc minimum\nvoltage"
		  Position		  [15, 257, 85, 283]
		  FontName		  "Arial"
		  Value			  "mc_min_volts"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  MinMax
		  Name			  "min"
		  Ports			  [2, 1]
		  Position		  [620, 162, 635, 333]
		  Function		  "min"
		  Inputs		  "2"
		}
		Block {
		  BlockType		  Switch
		  Name			  "no power req if\nSOC<0 and trying "
"\nto discharge"
		  Position		  [770, 245, 800, 275]
		  Threshold		  "eps"
		}
		Block {
		  BlockType		  Switch
		  Name			  "no power req if\nSOC>.999 and tryin"
"g \nto charge"
		  Position		  [925, 235, 955, 265]
		  Threshold		  "eps"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Pbty, limited"
		  Position		  [1020, 240, 1040, 260]
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Line {
		  SrcBlock		  "Logical\nOperator1"
		  SrcPort		  1
		  Points		  [15, 0; 0, 185]
		  Branch {
		    Points		    [-195, 0]
		    DstBlock		    "Limits"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, 15]
		    DstBlock		    "no power req if\nSOC>.999 and try"
"ing \nto charge"
		    DstPort		    2
		  }
		}
		Line {
		  SrcBlock		  "no power req if\nSOC>.999 and tryin"
"g \nto charge"
		  SrcPort		  1
		  DstBlock		  "Pbty, limited"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "no power req if\nSOC<0 and trying "
"\nto discharge"
		  SrcPort		  1
		  DstBlock		  "no power req if\nSOC>.999 and tryin"
"g \nto charge"
		  DstPort		  3
		}
		Line {
		  SrcBlock		  "Constant4"
		  SrcPort		  1
		  DstBlock		  "no power req if\nSOC>.999 and tryin"
"g \nto charge"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Constant5"
		  SrcPort		  1
		  DstBlock		  "SOC>=.999"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "charging\n(Preq is neg)"
		  SrcPort		  1
		  Points		  [10, 0]
		  DstBlock		  "Logical\nOperator1"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Constant6"
		  SrcPort		  1
		  DstBlock		  "charging\n(Preq is neg)"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "SOC>=.999"
		  SrcPort		  1
		  DstBlock		  "Logical\nOperator1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "SOC"
		  SrcPort		  1
		  Points		  [190, 0]
		  Branch {
		    Points		    [0, -25]
		    DstBlock		    "SOC>=.999"
		    DstPort		    1
		  }
		  Branch {
		    DstBlock		    "Relational\nOperator"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "ess_module_num"
		  SrcPort		  1
		  Points		  [5, 0]
		  Branch {
		    Points		    [0, 110]
		    DstBlock		    "Limits"
		    DstPort		    8
		  }
		  Branch {
		    Points		    [0, -40]
		    DstBlock		    "limit by battery max\nor min mc v"
"oltage\nor ess min"
		    DstPort		    3
		  }
		}
		Line {
		  SrcBlock		  "ess minimum voltage"
		  SrcPort		  1
		  DstBlock		  "ess_module_num"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Gain"
		  SrcPort		  1
		  Points		  [0, 0]
		  Branch {
		    Points		    [0, -25; 195, 0; 0, 230]
		    DstBlock		    "Limits"
		    DstPort		    7
		  }
		  Branch {
		    DstBlock		    "limit by battery max\nor min mc v"
"oltage\nor ess min"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "Rint"
		  SrcPort		  1
		  Points		  [-15, 0; 0, -55]
		  DstBlock		  "Mux"
		  DstPort		  3
		}
		Line {
		  SrcBlock		  "mc minimum\nvoltage"
		  SrcPort		  1
		  Points		  [30, 0]
		  Branch {
		    Points		    [0, 155]
		    DstBlock		    "Limits"
		    DstPort		    6
		  }
		  Branch {
		    DstBlock		    "limit by battery max\nor min mc v"
"oltage\nor ess min"
		    DstPort		    2
		  }
		}
		Line {
		  SrcBlock		  "discharge\nmax power allowed\n(-0.1"
" is for safety, to prevent\ntaking the square of a tiny\n-ive # in I=I(P) els"
"ewhere)"
		  SrcPort		  1
		  Points		  [5, 0; 0, 75]
		  Branch {
		    DstBlock		    "min"
		    DstPort		    2
		  }
		  Branch {
		    Points		    [0, 105]
		    DstBlock		    "Limits"
		    DstPort		    4
		  }
		}
		Line {
		  SrcBlock		  "limit by battery max\nor min mc vol"
"tage\nor ess min"
		  SrcPort		  1
		  Points		  [65, 0]
		  Branch {
		    Points		    [0, 140]
		    DstBlock		    "Limits"
		    DstPort		    5
		  }
		  Branch {
		    Points		    [0, -55]
		    DstBlock		    "Mux"
		    DstPort		    2
		  }
		}
		Line {
		  SrcBlock		  "Mux"
		  SrcPort		  1
		  DstBlock		  "discharge\nmax power allowed\n(-0.1"
" is for safety, to prevent\ntaking the square of a tiny\n-ive # in I=I(P) els"
"ewhere)"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "min"
		  SrcPort		  1
		  Points		  [30, 0]
		  Branch {
		    Points		    [0, 130]
		    DstBlock		    "Limits"
		    DstPort		    3
		  }
		  Branch {
		    DstBlock		    "no power req if\nSOC<0 and trying"
" \nto discharge"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "Voc"
		  SrcPort		  1
		  Points		  [80, 0]
		  Branch {
		    DstBlock		    "Gain"
		    DstPort		    1
		  }
		  Branch {
		    DstBlock		    "Mux"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "Logical\nOperator"
		  SrcPort		  1
		  Points		  [180, 0; 0, 185]
		  Branch {
		    Points		    [0, 105]
		    DstBlock		    "Limits"
		    DstPort		    2
		  }
		  Branch {
		    DstBlock		    "no power req if\nSOC<0 and trying"
" \nto discharge"
		    DstPort		    2
		  }
		}
		Line {
		  SrcBlock		  "Constant3"
		  SrcPort		  1
		  Points		  [0, -25]
		  DstBlock		  "no power req if\nSOC<0 and trying "
"\nto discharge"
		  DstPort		  3
		}
		Line {
		  SrcBlock		  "Relational\nOperator3"
		  SrcPort		  1
		  Points		  [10, 0]
		  DstBlock		  "Logical\nOperator"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Constant2"
		  SrcPort		  1
		  DstBlock		  "Relational\nOperator3"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Pbty"
		  SrcPort		  1
		  Points		  [335, 0]
		  Branch {
		    Points		    [230, 0]
		    Branch {
		    Points		    [0, -75]
		    DstBlock		    "charging\n(Preq is neg)"
		    DstPort		    1
		    }
		    Branch {
		    DstBlock		    "min"
		    DstPort		    1
		    }
		  }
		  Branch {
		    Points		    [0, -50]
		    DstBlock		    "Relational\nOperator3"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "Relational\nOperator"
		  SrcPort		  1
		  DstBlock		  "Logical\nOperator"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Constant1"
		  SrcPort		  1
		  DstBlock		  "Relational\nOperator"
		  DstPort		  2
		}
	      }
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "max pack\npwr (W)1"
	      Ports		      [2, 2]
	      Position		      [240, 16, 270, 49]
	      ShowPortLabels	      off
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"max pack\npwr (W)1"
		Location		[19, 84, 877, 663]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "SOC"
		  Position		  [50, 25, 70, 45]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "ess_mod_tmp"
		  Position		  [45, 110, 65, 130]
		  Port			  "2"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Constant
		  Name			  "#bty"
		  Position		  [195, 173, 285, 197]
		  Orientation		  "left"
		  Value			  "ess_module_num"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Constant
		  Name			  "Constant"
		  Position		  [307, 200, 393, 220]
		  Orientation		  "up"
		  ShowName		  off
		  FontName		  "Arial"
		  Value			  "mc_min_volts"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Constant
		  Name			  "Constant1"
		  Position		  [335, 90, 370, 110]
		  Orientation		  "left"
		  Value			  "0.001"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Constant
		  Name			  "Constant2"
		  Position		  [645, 190, 680, 210]
		  Orientation		  "left"
		  Value			  "0"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Constant
		  Name			  "Constant7"
		  Position		  [435, 60, 475, 80]
		  ShowName		  off
		  Value			  "ess_on"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Gain
		  Name			  "Gain"
		  Position		  [335, 142, 365, 168]
		  ShowName		  off
		  FontName		  "Arial"
		  Gain			  "0.5"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  MinMax
		  Name			  "MinMax1"
		  Ports			  [3, 1]
		  Position		  [415, 149, 445, 181]
		  ShowName		  off
		  Function		  "max"
		  Inputs		  "3"
		}
		Block {
		  BlockType		  Mux
		  Name			  "Mux"
		  Ports			  [3, 1]
		  Position		  [475, 123, 495, 157]
		  FontName		  "Arial"
		  Inputs		  "3"
		  DisplayOption		  "none"
		}
		Block {
		  BlockType		  Mux
		  Name			  "Mux3"
		  Ports			  [3, 1]
		  Position		  [555, 368, 575, 402]
		  Inputs		  "3"
		  DisplayOption		  "none"
		}
		Block {
		  BlockType		  Mux
		  Name			  "Mux5"
		  Ports			  [3, 1]
		  Position		  [370, 311, 390, 399]
		  Inputs		  "3"
		  DisplayOption		  "none"
		}
		Block {
		  BlockType		  Product
		  Name			  "Product"
		  Ports			  [2, 1]
		  Position		  [225, 118, 255, 142]
		  Inputs		  "2"
		  Multiplication	  "Element-wise(.*)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Product
		  Name			  "Product3"
		  Ports			  [2, 1]
		  Position		  [710, 348, 740, 372]
		  Inputs		  "2"
		  Multiplication	  "Element-wise(.*)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Rchg\n(ohms)1"
		  Ports			  [2, 1]
		  Position		  [135, 413, 165, 437]
		  ShowPortLabels	  off
		  TreatAsAtomicUnit	  off
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  MaskType		  "2-D Table Lookup"
		  MaskDescription	  "Two Dimensional Table Lookup\nThe f"
"irst input corresponds to X Index and the second input corresponds to the Y I"
"ndex"
		  MaskHelp		  "This block returns a linearly inter"
"polated intersection from the table using the X index (which corresponds to t"
"he rows of the table) and the Y index (which corresponds to the columns of th"
"e table).  Extrapolation is used."
		  MaskPromptString	  "X Index|Y Index|Table"
		  MaskStyleString	  "edit,edit,edit"
		  MaskTunableValueString  "on,on,on"
		  MaskCallbackString	  "||"
		  MaskEnableString	  "on,on,on"
		  MaskVisibilityString	  "on,on,on"
		  MaskToolTipString	  "on,on,on"
		  MaskInitialization	  "xindex=@1; yindex=@2; table=@3; sft"
"ab2chk(xindex,yindex,table);"
		  MaskDisplay		  "plot(-10,-10,110,110,[90,50,10],[90"
",40,30],[90,50,10],[50,26,20],[90,50,10],[22,13,10])"
		  MaskIconFrame		  on
		  MaskIconOpaque	  on
		  MaskIconRotate	  "none"
		  MaskIconUnits		  "autoscale"
		  MaskValueString	  "ess_tmp|ess_soc|ess_r_chg"
		  MaskVariableAliases	  ",,"
		  System {
		    Name		    "Rchg\n(ohms)1"
		    Location		    [316, 263, 598, 417]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "x0"
		    Position		    [20, 25, 40, 45]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "y0"
		    Position		    [20, 80, 40, 100]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Mux
		    Name		    "Mux"
		    Ports		    [2, 1]
		    Position		    [90, 46, 120, 79]
		    Inputs		    "2"
		    DisplayOption	    "none"
		    }
		    Block {
		    BlockType		    "S-Function"
		    Name		    "S-function"
		    Ports		    [1, 1]
		    Position		    [140, 52, 190, 78]
		    FunctionName	    "sftable2"
		    Parameters		    "xindex, yindex, table"
		    PortCounts		    "[]"
		    SFunctionModules	    "''"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "table out"
		    Position		    [215, 55, 235, 75]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "y0"
		    SrcPort		    1
		    Points		    [20, 0; 0, -20]
		    DstBlock		    "Mux"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "S-function"
		    SrcPort		    1
		    DstBlock		    "table out"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "x0"
		    SrcPort		    1
		    Points		    [20, 0; 0, 20]
		    DstBlock		    "Mux"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Mux"
		    SrcPort		    1
		    DstBlock		    "S-function"
		    DstPort		    1
		    }
		  }
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Rdis\n(ohms)"
		  Ports			  [2, 1]
		  Position		  [140, 228, 170, 252]
		  ShowPortLabels	  off
		  TreatAsAtomicUnit	  off
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  MaskType		  "2-D Table Lookup"
		  MaskDescription	  "Two Dimensional Table Lookup\nThe f"
"irst input corresponds to X Index and the second input corresponds to the Y I"
"ndex"
		  MaskHelp		  "This block returns a linearly inter"
"polated intersection from the table using the X index (which corresponds to t"
"he rows of the table) and the Y index (which corresponds to the columns of th"
"e table).  Extrapolation is used."
		  MaskPromptString	  "X Index|Y Index|Table"
		  MaskStyleString	  "edit,edit,edit"
		  MaskTunableValueString  "on,on,on"
		  MaskCallbackString	  "||"
		  MaskEnableString	  "on,on,on"
		  MaskVisibilityString	  "on,on,on"
		  MaskToolTipString	  "on,on,on"
		  MaskInitialization	  "xindex=@1; yindex=@2; table=@3; sft"
"ab2chk(xindex,yindex,table);"
		  MaskDisplay		  "plot(-10,-10,110,110,[90,50,10],[90"
",40,30],[90,50,10],[50,26,20],[90,50,10],[22,13,10])"
		  MaskIconFrame		  on
		  MaskIconOpaque	  on
		  MaskIconRotate	  "none"
		  MaskIconUnits		  "autoscale"
		  MaskValueString	  "ess_tmp|ess_soc|ess_r_dis"
		  MaskVariableAliases	  ",,"
		  System {
		    Name		    "Rdis\n(ohms)"
		    Location		    [316, 263, 598, 417]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "x0"
		    Position		    [20, 25, 40, 45]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "y0"
		    Position		    [20, 80, 40, 100]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Mux
		    Name		    "Mux"
		    Ports		    [2, 1]
		    Position		    [90, 46, 120, 79]
		    Inputs		    "2"
		    DisplayOption	    "none"
		    }
		    Block {
		    BlockType		    "S-Function"
		    Name		    "S-function"
		    Ports		    [1, 1]
		    Position		    [140, 52, 190, 78]
		    FunctionName	    "sftable2"
		    Parameters		    "xindex, yindex, table"
		    PortCounts		    "[]"
		    SFunctionModules	    "''"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "table out"
		    Position		    [215, 55, 235, 75]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "y0"
		    SrcPort		    1
		    Points		    [20, 0; 0, -20]
		    DstBlock		    "Mux"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "S-function"
		    SrcPort		    1
		    DstBlock		    "table out"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "x0"
		    SrcPort		    1
		    Points		    [20, 0; 0, 20]
		    DstBlock		    "Mux"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Mux"
		    SrcPort		    1
		    DstBlock		    "S-function"
		    DstPort		    1
		    }
		  }
		}
		Block {
		  BlockType		  RelationalOperator
		  Name			  "Relational\nOperator"
		  Position		  [340, 27, 370, 58]
		  Operator		  ">"
		}
		Block {
		  BlockType		  Switch
		  Name			  "Switch"
		  Position		  [645, 140, 675, 170]
		  Threshold		  "eps"
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "VOC\n(V)"
		  Ports			  [2, 1]
		  Position		  [145, 113, 175, 137]
		  ShowPortLabels	  off
		  TreatAsAtomicUnit	  off
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  MaskType		  "2-D Table Lookup"
		  MaskDescription	  "Two Dimensional Table Lookup\nThe f"
"irst input corresponds to X Index and the second input corresponds to the Y I"
"ndex"
		  MaskHelp		  "This block returns a linearly inter"
"polated intersection from the table using the X index (which corresponds to t"
"he rows of the table) and the Y index (which corresponds to the columns of th"
"e table).  Extrapolation is used."
		  MaskPromptString	  "X Index|Y Index|Table"
		  MaskStyleString	  "edit,edit,edit"
		  MaskTunableValueString  "on,on,on"
		  MaskCallbackString	  "||"
		  MaskEnableString	  "on,on,on"
		  MaskVisibilityString	  "on,on,on"
		  MaskToolTipString	  "on,on,on"
		  MaskInitialization	  "xindex=@1; yindex=@2; table=@3; sft"
"ab2chk(xindex,yindex,table);"
		  MaskDisplay		  "plot(-10,-10,110,110,[90,50,10],[90"
",40,30],[90,50,10],[50,26,20],[90,50,10],[22,13,10])"
		  MaskIconFrame		  on
		  MaskIconOpaque	  on
		  MaskIconRotate	  "none"
		  MaskIconUnits		  "autoscale"
		  MaskValueString	  "ess_tmp|ess_soc|ess_voc"
		  MaskVariableAliases	  ",,"
		  System {
		    Name		    "VOC\n(V)"
		    Location		    [316, 263, 598, 417]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "x0"
		    Position		    [20, 25, 40, 45]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "y0"
		    Position		    [20, 80, 40, 100]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Mux
		    Name		    "Mux"
		    Ports		    [2, 1]
		    Position		    [90, 46, 120, 79]
		    Inputs		    "2"
		    DisplayOption	    "none"
		    }
		    Block {
		    BlockType		    "S-Function"
		    Name		    "S-function"
		    Ports		    [1, 1]
		    Position		    [140, 52, 190, 78]
		    FunctionName	    "sftable2"
		    Parameters		    "xindex, yindex, table"
		    PortCounts		    "[]"
		    SFunctionModules	    "''"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "table out"
		    Position		    [215, 55, 235, 75]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "y0"
		    SrcPort		    1
		    Points		    [20, 0; 0, -20]
		    DstBlock		    "Mux"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "S-function"
		    SrcPort		    1
		    DstBlock		    "table out"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "x0"
		    SrcPort		    1
		    Points		    [20, 0; 0, 20]
		    DstBlock		    "Mux"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Mux"
		    SrcPort		    1
		    DstBlock		    "S-function"
		    DstPort		    1
		    }
		  }
		}
		Block {
		  BlockType		  Fcn
		  Name			  "Voc-I*R"
		  Position		  [600, 374, 680, 396]
		  Expr			  "u[2]-u[1]*u[3]"
		}
		Block {
		  BlockType		  Logic
		  Name			  "and"
		  Ports			  [2, 1]
		  Position		  [505, 37, 535, 68]
		  NamePlacement		  "alternate"
		  ShowName		  off
		  Operator		  "AND"
		  Inputs		  "2"
		}
		Block {
		  BlockType		  Fcn
		  Name			  "iabs min=(Voc-Vmax)/R"
		  Position		  [435, 344, 465, 366]
		  Expr			  "(u(1)-u(2))/u(3)"
		}
		Block {
		  BlockType		  Fcn
		  Name			  "max power corresponding\nto minimum"
" voltage"
		  Position		  [520, 131, 615, 159]
		  FontName		  "Arial"
		  Expr			  "(u[1]-u[2])*u[2]/u[3]"
		}
		Block {
		  BlockType		  Constant
		  Name			  "min ess V"
		  Position		  [315, 252, 480, 278]
		  Orientation		  "left"
		  Value			  "ess_module_num*ess_min_volts"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Constant
		  Name			  "min ess V1"
		  Position		  [185, 342, 350, 368]
		  Value			  "ess_module_num*ess_max_volts"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Gain
		  Name			  "resistance scale fun"
		  Position		  [225, 410, 255, 440]
		  Gain			  "ess_res_scale_fun(ess_res_scale_coe"
"f,ess_module_num,ess_cap_scale)"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Gain
		  Name			  "resistance scale fun1"
		  Position		  [225, 225, 255, 255]
		  Gain			  "ess_res_scale_fun(ess_res_scale_coe"
"f,ess_module_num,ess_cap_scale)"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Outport
		  Name			  "max ess\ndischarge\npwr"
		  Position		  [730, 145, 750, 165]
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Block {
		  BlockType		  Outport
		  Name			  "max ess\ncharge\npwr"
		  Position		  [775, 350, 795, 370]
		  Port			  "2"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Line {
		  SrcBlock		  "Constant7"
		  SrcPort		  1
		  Points		  [10, 0]
		  DstBlock		  "and"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Relational\nOperator"
		  SrcPort		  1
		  DstBlock		  "and"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "and"
		  SrcPort		  1
		  Points		  [90, 0]
		  DstBlock		  "Switch"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "min ess V"
		  SrcPort		  1
		  Points		  [0, -20; 90, 0]
		  DstBlock		  "MinMax1"
		  DstPort		  3
		}
		Line {
		  SrcBlock		  "ess_mod_tmp"
		  SrcPort		  1
		  Points		  [40, 0]
		  Branch {
		    DstBlock		    "VOC\n(V)"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, 115]
		    Branch {
		    DstBlock		    "Rdis\n(ohms)"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [0, 185]
		    DstBlock		    "Rchg\n(ohms)1"
		    DstPort		    1
		    }
		  }
		}
		Line {
		  SrcBlock		  "Constant1"
		  SrcPort		  1
		  Points		  [-5, 0]
		  DstBlock		  "Relational\nOperator"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Constant"
		  SrcPort		  1
		  Points		  [35, 0; 0, -30]
		  DstBlock		  "MinMax1"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Mux"
		  SrcPort		  1
		  Points		  [0, 5]
		  DstBlock		  "max power corresponding\nto minimum"
" voltage"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Gain"
		  SrcPort		  1
		  DstBlock		  "MinMax1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "MinMax1"
		  SrcPort		  1
		  Points		  [0, -25]
		  DstBlock		  "Mux"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Product"
		  SrcPort		  1
		  Points		  [40, 0]
		  Branch {
		    DstBlock		    "Mux"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, 25]
		    DstBlock		    "Gain"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, 170]
		    Branch {
		    Points		    [0, 25]
		    DstBlock		    "Mux5"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [210, 0; 0, 85]
		    DstBlock		    "Mux3"
		    DstPort		    2
		    }
		  }
		}
		Line {
		  SrcBlock		  "resistance scale fun1"
		  SrcPort		  1
		  Points		  [200, 0]
		  DstBlock		  "Mux"
		  DstPort		  3
		}
		Line {
		  SrcBlock		  "VOC\n(V)"
		  SrcPort		  1
		  DstBlock		  "Product"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Rdis\n(ohms)"
		  SrcPort		  1
		  DstBlock		  "resistance scale fun1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "max power corresponding\nto minimum"
" voltage"
		  SrcPort		  1
		  DstBlock		  "Switch"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Constant2"
		  SrcPort		  1
		  Points		  [-10, 0]
		  DstBlock		  "Switch"
		  DstPort		  3
		}
		Line {
		  SrcBlock		  "SOC"
		  SrcPort		  1
		  Points		  [45, 0]
		  Branch {
		    DstBlock		    "Relational\nOperator"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, 95]
		    Branch {
		    DstBlock		    "VOC\n(V)"
		    DstPort		    2
		    }
		    Branch {
		    Points		    [0, 115]
		    Branch {
		    DstBlock		    "Rdis\n(ohms)"
		    DstPort		    2
		    }
		    Branch {
		    DstBlock		    "Rchg\n(ohms)1"
		    DstPort		    2
		    }
		    }
		  }
		}
		Line {
		  SrcBlock		  "Switch"
		  SrcPort		  1
		  DstBlock		  "max ess\ndischarge\npwr"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "min ess V1"
		  SrcPort		  1
		  DstBlock		  "Mux5"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Mux5"
		  SrcPort		  1
		  DstBlock		  "iabs min=(Voc-Vmax)/R"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Mux3"
		  SrcPort		  1
		  DstBlock		  "Voc-I*R"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "iabs min=(Voc-Vmax)/R"
		  SrcPort		  1
		  Points		  [60, 0]
		  Branch {
		    Points		    [0, 20]
		    DstBlock		    "Mux3"
		    DstPort		    1
		  }
		  Branch {
		    DstBlock		    "Product3"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "Voc-I*R"
		  SrcPort		  1
		  Points		  [0, -20]
		  DstBlock		  "Product3"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Product3"
		  SrcPort		  1
		  DstBlock		  "max ess\ncharge\npwr"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "resistance scale fun"
		  SrcPort		  1
		  Points		  [95, 0]
		  Branch {
		    DstBlock		    "Mux5"
		    DstPort		    3
		  }
		  Branch {
		    Points		    [175, 0; 0, -30]
		    DstBlock		    "Mux3"
		    DstPort		    3
		  }
		}
		Line {
		  SrcBlock		  "Rchg\n(ohms)1"
		  SrcPort		  1
		  DstBlock		  "resistance scale fun"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "#bty"
		  SrcPort		  1
		  Points		  [-10, 0; 0, -50]
		  DstBlock		  "Product"
		  DstPort		  2
		}
	      }
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "pack\nVoc, Rint"
	      Ports		      [3, 2]
	      Position		      [135, 142, 165, 198]
	      ShowPortLabels	      off
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"pack\nVoc, Rint"
		Location		[133, 354, 681, 657]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "SOC (prev)"
		  Position		  [25, 80, 45, 100]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "req'd battery\npower (W)"
		  Position		  [230, 160, 250, 180]
		  Port			  "2"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "mod tmp \n (C)"
		  Position		  [80, 140, 100, 160]
		  Port			  "3"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Constant
		  Name			  "#bty"
		  Position		  [255, 54, 350, 76]
		  Value			  "ess_module_num"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Product
		  Name			  "Product"
		  Ports			  [2, 1]
		  Position		  [380, 28, 410, 52]
		  Inputs		  "2"
		  Multiplication	  "Element-wise(.*)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Rchg\n(ohms)"
		  Ports			  [2, 1]
		  Position		  [200, 228, 230, 252]
		  ShowPortLabels	  off
		  TreatAsAtomicUnit	  off
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  MaskType		  "2-D Table Lookup"
		  MaskDescription	  "Two Dimensional Table Lookup\nThe f"
"irst input corresponds to X Index and the second input corresponds to the Y I"
"ndex"
		  MaskHelp		  "This block returns a linearly inter"
"polated intersection from the table using the X index (which corresponds to t"
"he rows of the table) and the Y index (which corresponds to the columns of th"
"e table).  Extrapolation is used."
		  MaskPromptString	  "X Index|Y Index|Table"
		  MaskStyleString	  "edit,edit,edit"
		  MaskTunableValueString  "on,on,on"
		  MaskCallbackString	  "||"
		  MaskEnableString	  "on,on,on"
		  MaskVisibilityString	  "on,on,on"
		  MaskToolTipString	  "on,on,on"
		  MaskInitialization	  "xindex=@1; yindex=@2; table=@3; sft"
"ab2chk(xindex,yindex,table);"
		  MaskDisplay		  "plot(-10,-10,110,110,[90,50,10],[90"
",40,30],[90,50,10],[50,26,20],[90,50,10],[22,13,10])"
		  MaskIconFrame		  on
		  MaskIconOpaque	  on
		  MaskIconRotate	  "none"
		  MaskIconUnits		  "autoscale"
		  MaskValueString	  "ess_tmp|ess_soc|ess_r_chg"
		  MaskVariableAliases	  ",,"
		  System {
		    Name		    "Rchg\n(ohms)"
		    Location		    [316, 263, 598, 417]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "x0"
		    Position		    [20, 25, 40, 45]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "y0"
		    Position		    [20, 80, 40, 100]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Mux
		    Name		    "Mux"
		    Ports		    [2, 1]
		    Position		    [90, 46, 120, 79]
		    Inputs		    "2"
		    DisplayOption	    "none"
		    }
		    Block {
		    BlockType		    "S-Function"
		    Name		    "S-function"
		    Ports		    [1, 1]
		    Position		    [140, 52, 190, 78]
		    FunctionName	    "sftable2"
		    Parameters		    "xindex, yindex, table"
		    PortCounts		    "[]"
		    SFunctionModules	    "''"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "table out"
		    Position		    [215, 55, 235, 75]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "Mux"
		    SrcPort		    1
		    DstBlock		    "S-function"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "x0"
		    SrcPort		    1
		    Points		    [20, 0; 0, 20]
		    DstBlock		    "Mux"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "S-function"
		    SrcPort		    1
		    DstBlock		    "table out"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "y0"
		    SrcPort		    1
		    Points		    [20, 0; 0, -20]
		    DstBlock		    "Mux"
		    DstPort		    2
		    }
		  }
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Rdis\n(ohms)"
		  Ports			  [2, 1]
		  Position		  [195, 108, 225, 132]
		  ShowPortLabels	  off
		  TreatAsAtomicUnit	  off
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  MaskType		  "2-D Table Lookup"
		  MaskDescription	  "Two Dimensional Table Lookup\nThe f"
"irst input corresponds to X Index and the second input corresponds to the Y I"
"ndex"
		  MaskHelp		  "This block returns a linearly inter"
"polated intersection from the table using the X index (which corresponds to t"
"he rows of the table) and the Y index (which corresponds to the columns of th"
"e table).  Extrapolation is used."
		  MaskPromptString	  "X Index|Y Index|Table"
		  MaskStyleString	  "edit,edit,edit"
		  MaskTunableValueString  "on,on,on"
		  MaskCallbackString	  "||"
		  MaskEnableString	  "on,on,on"
		  MaskVisibilityString	  "on,on,on"
		  MaskToolTipString	  "on,on,on"
		  MaskInitialization	  "xindex=@1; yindex=@2; table=@3; sft"
"ab2chk(xindex,yindex,table);"
		  MaskDisplay		  "plot(-10,-10,110,110,[90,50,10],[90"
",40,30],[90,50,10],[50,26,20],[90,50,10],[22,13,10])"
		  MaskIconFrame		  on
		  MaskIconOpaque	  on
		  MaskIconRotate	  "none"
		  MaskIconUnits		  "autoscale"
		  MaskValueString	  "ess_tmp|ess_soc|ess_r_dis"
		  MaskVariableAliases	  ",,"
		  System {
		    Name		    "Rdis\n(ohms)"
		    Location		    [316, 263, 598, 417]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "x0"
		    Position		    [20, 25, 40, 45]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "y0"
		    Position		    [20, 80, 40, 100]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Mux
		    Name		    "Mux"
		    Ports		    [2, 1]
		    Position		    [90, 46, 120, 79]
		    Inputs		    "2"
		    DisplayOption	    "none"
		    }
		    Block {
		    BlockType		    "S-Function"
		    Name		    "S-function"
		    Ports		    [1, 1]
		    Position		    [140, 52, 190, 78]
		    FunctionName	    "sftable2"
		    Parameters		    "xindex, yindex, table"
		    PortCounts		    "[]"
		    SFunctionModules	    "''"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "table out"
		    Position		    [215, 55, 235, 75]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "Mux"
		    SrcPort		    1
		    DstBlock		    "S-function"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "x0"
		    SrcPort		    1
		    Points		    [20, 0; 0, 20]
		    DstBlock		    "Mux"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "S-function"
		    SrcPort		    1
		    DstBlock		    "table out"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "y0"
		    SrcPort		    1
		    Points		    [20, 0; 0, -20]
		    DstBlock		    "Mux"
		    DstPort		    2
		    }
		  }
		}
		Block {
		  BlockType		  Switch
		  Name			  "Switch"
		  Position		  [365, 154, 395, 186]
		  Threshold		  "0"
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "VOC\n(V)"
		  Ports			  [2, 1]
		  Position		  [205, 23, 235, 47]
		  ShowPortLabels	  off
		  TreatAsAtomicUnit	  off
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  MaskType		  "2-D Table Lookup"
		  MaskDescription	  "Two Dimensional Table Lookup\nThe f"
"irst input corresponds to X Index and the second input corresponds to the Y I"
"ndex"
		  MaskHelp		  "This block returns a linearly inter"
"polated intersection from the table using the X index (which corresponds to t"
"he rows of the table) and the Y index (which corresponds to the columns of th"
"e table).  Extrapolation is used."
		  MaskPromptString	  "X Index|Y Index|Table"
		  MaskStyleString	  "edit,edit,edit"
		  MaskTunableValueString  "on,on,on"
		  MaskCallbackString	  "||"
		  MaskEnableString	  "on,on,on"
		  MaskVisibilityString	  "on,on,on"
		  MaskToolTipString	  "on,on,on"
		  MaskInitialization	  "xindex=@1; yindex=@2; table=@3; sft"
"ab2chk(xindex,yindex,table);"
		  MaskDisplay		  "plot(-10,-10,110,110,[90,50,10],[90"
",40,30],[90,50,10],[50,26,20],[90,50,10],[22,13,10])"
		  MaskIconFrame		  on
		  MaskIconOpaque	  on
		  MaskIconRotate	  "none"
		  MaskIconUnits		  "autoscale"
		  MaskValueString	  "ess_tmp|ess_soc|ess_voc"
		  MaskVariableAliases	  ",,"
		  System {
		    Name		    "VOC\n(V)"
		    Location		    [316, 263, 598, 417]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "x0"
		    Position		    [20, 25, 40, 45]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "y0"
		    Position		    [20, 80, 40, 100]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Mux
		    Name		    "Mux"
		    Ports		    [2, 1]
		    Position		    [90, 46, 120, 79]
		    Inputs		    "2"
		    DisplayOption	    "none"
		    }
		    Block {
		    BlockType		    "S-Function"
		    Name		    "S-function"
		    Ports		    [1, 1]
		    Position		    [140, 52, 190, 78]
		    FunctionName	    "sftable2"
		    Parameters		    "xindex, yindex, table"
		    PortCounts		    "[]"
		    SFunctionModules	    "''"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "table out"
		    Position		    [215, 55, 235, 75]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "Mux"
		    SrcPort		    1
		    DstBlock		    "S-function"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "x0"
		    SrcPort		    1
		    Points		    [20, 0; 0, 20]
		    DstBlock		    "Mux"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "S-function"
		    SrcPort		    1
		    DstBlock		    "table out"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "y0"
		    SrcPort		    1
		    Points		    [20, 0; 0, -20]
		    DstBlock		    "Mux"
		    DstPort		    2
		    }
		  }
		}
		Block {
		  BlockType		  Gain
		  Name			  "resistance scale fun"
		  Position		  [275, 105, 305, 135]
		  Gain			  "ess_res_scale_fun(ess_res_scale_coe"
"f,ess_module_num,ess_cap_scale)"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Gain
		  Name			  "resistance scale fun1"
		  Position		  [280, 225, 310, 255]
		  Gain			  "ess_res_scale_fun(ess_res_scale_coe"
"f,ess_module_num,ess_cap_scale)"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Outport
		  Name			  "pack open-\ncircuit voltage"
		  Position		  [450, 30, 470, 50]
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Block {
		  BlockType		  Outport
		  Name			  "pack\nresistance"
		  Position		  [450, 105, 470, 125]
		  Port			  "2"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Line {
		  SrcBlock		  "mod tmp \n (C)"
		  SrcPort		  1
		  Points		  [55, 0]
		  Branch {
		    Points		    [0, 85]
		    DstBlock		    "Rchg\n(ohms)"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, -35]
		    Branch {
		    DstBlock		    "Rdis\n(ohms)"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [0, -85]
		    DstBlock		    "VOC\n(V)"
		    DstPort		    1
		    }
		  }
		}
		Line {
		  SrcBlock		  "SOC (prev)"
		  SrcPort		  1
		  Points		  [0, 0]
		  Branch {
		    Points		    [0, 35]
		    Branch {
		    Points		    [0, 120]
		    DstBlock		    "Rchg\n(ohms)"
		    DstPort		    2
		    }
		    Branch {
		    DstBlock		    "Rdis\n(ohms)"
		    DstPort		    2
		    }
		  }
		  Branch {
		    Points		    [0, -50]
		    DstBlock		    "VOC\n(V)"
		    DstPort		    2
		  }
		}
		Line {
		  SrcBlock		  "req'd battery\npower (W)"
		  SrcPort		  1
		  DstBlock		  "Switch"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "VOC\n(V)"
		  SrcPort		  1
		  DstBlock		  "Product"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Product"
		  SrcPort		  1
		  DstBlock		  "pack open-\ncircuit voltage"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "#bty"
		  SrcPort		  1
		  Points		  [5, 0; 0, -20]
		  DstBlock		  "Product"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Switch"
		  SrcPort		  1
		  Points		  [15, 0; 0, -55]
		  DstBlock		  "pack\nresistance"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Rdis\n(ohms)"
		  SrcPort		  1
		  DstBlock		  "resistance scale fun"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "resistance scale fun"
		  SrcPort		  1
		  Points		  [40, 0]
		  DstBlock		  "Switch"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Rchg\n(ohms)"
		  SrcPort		  1
		  DstBlock		  "resistance scale fun1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "resistance scale fun1"
		  SrcPort		  1
		  Points		  [35, 0]
		  DstBlock		  "Switch"
		  DstPort		  3
		}
	      }
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "stop sim"
	      Ports		      [1, 0, 1]
	      Position		      [525, 104, 585, 136]
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      on
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"stop sim"
		Location		[423, 258, 819, 468]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "SOC"
		  Position		  [75, 85, 95, 105]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  EnablePort
		  Name			  "Enable"
		  Ports			  []
		  Position		  [170, 25, 190, 45]
		  StatesWhenEnabling	  "held"
		  ShowOutputPort	  off
		}
		Block {
		  BlockType		  Constant
		  Name			  "Const"
		  Position		  [95, 145, 165, 165]
		  Orientation		  "up"
		  ShowName		  off
		  FontName		  "Arial"
		  Value			  ".001"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  RelationalOperator
		  Name			  "Relational\nOperator"
		  Position		  [185, 88, 215, 112]
		  Operator		  "<"
		}
		Block {
		  BlockType		  Stop
		  Name			  "Stop Simulation"
		  Position		  [255, 83, 295, 117]
		}
		Line {
		  SrcBlock		  "Relational\nOperator"
		  SrcPort		  1
		  DstBlock		  "Stop Simulation"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "SOC"
		  SrcPort		  1
		  DstBlock		  "Relational\nOperator"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Const"
		  SrcPort		  1
		  Points		  [0, -35]
		  DstBlock		  "Relational\nOperator"
		  DstPort		  2
		}
	      }
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "power available\nto bus (W)"
	      Position		      [440, 170, 460, 190]
	      FontName		      "Arial"
	      Port		      "1"
	      OutputWhenDisabled      "held"
	      InitialOutput	      "0"
	    }
	    Line {
	      SrcBlock		      "compute\ncurrent"
	      SrcPort		      2
	      Points		      [0, -10; 15, 0]
	      Branch {
		DstBlock		"Product"
		DstPort			2
	      }
	      Branch {
		Points			[0, 35]
		Branch {
		  Points		  [0, 70]
		  DstBlock		  "Mux"
		  DstPort		  3
		}
		Branch {
		  DstBlock		  "Goto <mc>, <gc>, <sdo>"
		  DstPort		  1
		}
	      }
	    }
	    Line {
	      SrcBlock		      "Mux"
	      SrcPort		      1
	      DstBlock		      "Fcn"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "power req'd\ninto bus (W)"
	      SrcPort		      1
	      Points		      [30, 0]
	      Branch {
		Points			[0, 90; 30, 0]
		Branch {
		  Points		  [0, 15]
		  DstBlock		  "To Workspace8"
		  DstPort		  1
		}
		Branch {
		  DstBlock		  "limit power"
		  DstPort		  2
		}
	      }
	      Branch {
		DstBlock		"pack\nVoc, Rint"
		DstPort			2
	      }
	    }
	    Line {
	      SrcBlock		      "compute\ncurrent"
	      SrcPort		      1
	      Points		      [0, -10; 25, 0]
	      Branch {
		Points			[0, -45]
		DstBlock		"SOC\nalgorithm"
		DstPort			1
	      }
	      Branch {
		Points			[0, 20]
		Branch {
		  DstBlock		  "Product"
		  DstPort		  1
		}
		Branch {
		  DstBlock		  "Mux"
		  DstPort		  1
		}
	      }
	    }
	    Line {
	      SrcBlock		      "Product"
	      SrcPort		      1
	      Points		      [35, 0]
	      Branch {
		DstBlock		"power available\nto bus (W)"
		DstPort			1
	      }
	      Branch {
		Points			[0, -45]
		Branch {
		  DstBlock		  "To Workspace9"
		  DstPort		  1
		}
		Branch {
		  DstBlock		  "Goto"
		  DstPort		  1
		}
	      }
	    }
	    Line {
	      SrcBlock		      "Fcn"
	      SrcPort		      1
	      Points		      [5, 0]
	      Branch {
		DstBlock		"To WS1"
		DstPort			1
	      }
	      Branch {
		DstBlock		"ess tmp"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "do ex calcs?"
	      SrcPort		      1
	      DstBlock		      "ess tmp"
	      DstPort		      enable
	    }
	    Line {
	      SrcBlock		      "SOC\nalgorithm"
	      SrcPort		      1
	      Points		      [10, 0]
	      Branch {
		DstBlock		"stop sim"
		DstPort			1
	      }
	      Branch {
		Points			[0, -25; -170, 0]
		Branch {
		  Points		  [-95, 0; 0, 25]
		  Branch {
		    Points		    [20, 0]
		    DstBlock		    "Goto <sdo>, <cs>"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, 30]
		    Branch {
		    DstBlock		    "pack\nVoc, Rint"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [0, 95]
		    DstBlock		    "limit power"
		    DstPort		    1
		    }
		  }
		}
		Branch {
		  Points		  [0, -70]
		  DstBlock		  "max pack\npwr (W)1"
		  DstPort		  1
		}
	      }
	    }
	    Line {
	      SrcBlock		      "Const"
	      SrcPort		      1
	      DstBlock		      "stop sim"
	      DstPort		      enable
	    }
	    Line {
	      SrcBlock		      "pack\nVoc, Rint"
	      SrcPort		      2
	      Points		      [0, -10; 10, 0]
	      Branch {
		Points			[35, 0]
		DstBlock		"compute\ncurrent"
		DstPort			2
	      }
	      Branch {
		Points			[0, 115]
		Branch {
		  DstBlock		  "limit power"
		  DstPort		  4
		}
		Branch {
		  Points		  [0, 30; 90, 0; 0, -40]
		  DstBlock		  "Mux"
		  DstPort		  2
		}
	      }
	    }
	    Line {
	      SrcBlock		      "pack\nVoc, Rint"
	      SrcPort		      1
	      Points		      [15, 0]
	      Branch {
		Points			[30, 0]
		DstBlock		"compute\ncurrent"
		DstPort			1
	      }
	      Branch {
		Points			[0, 120]
		DstBlock		"limit power"
		DstPort			3
	      }
	    }
	    Line {
	      SrcBlock		      "limit power"
	      SrcPort		      1
	      Points		      [5, 0; 0, -35; -50, 0]
	      DstBlock		      "compute\ncurrent"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "ess tmp"
	      SrcPort		      2
	      DstBlock		      "To WS3"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "ess tmp"
	      SrcPort		      3
	      DstBlock		      "To WS4"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "ess tmp"
	      SrcPort		      1
	      DstBlock		      "Memory"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "coul eff"
	      SrcPort		      1
	      DstBlock		      "Mux"
	      DstPort		      4
	    }
	    Line {
	      SrcBlock		      "max pack\npwr (W)1"
	      SrcPort		      1
	      DstBlock		      "Goto <cs>1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Memory"
	      SrcPort		      1
	      Points		      [10, 0]
	      Branch {
		DstBlock		"To WS2"
		DstPort			1
	      }
	      Branch {
		Points			[0, 65]
		Branch {
		  Points		  [0, 15; -230, 0]
		  Branch {
		    Points		    [0, -220]
		    DstBlock		    "SOC\nalgorithm"
		    DstPort		    2
		  }
		  Branch {
		    Points		    [-80, 0]
		    Branch {
		    Points		    [0, 25]
		    DstBlock		    "coul eff"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [-30, 0]
		    Branch {
		    Points		    [-85, 0]
		    DstBlock		    "pack\nVoc, Rint"
		    DstPort		    3
		    }
		    Branch {
		    Points		    [0, -305]
		    DstBlock		    "max pack\npwr (W)1"
		    DstPort		    2
		    }
		    }
		  }
		}
		Branch {
		  DstBlock		  "Goto <cs>"
		  DstPort		  1
		}
	      }
	    }
	    Line {
	      SrcBlock		      "max pack\npwr (W)1"
	      SrcPort		      2
	      DstBlock		      "Goto <cs>2"
	      DstPort		      1
	    }
	  }
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "energy\nstorage <ess>\nRC"
	  Ports			  [1, 1]
	  Position		  [245, 88, 310, 132]
	  ForegroundColor	  "magenta"
	  BackgroundColor	  "yellow"
	  ShowPortLabels	  off
	  TreatAsAtomicUnit	  off
	  RTWSystemCode		  "Auto"
	  RTWFcnNameOpts	  "Auto"
	  RTWFileNameOpts	  "Auto"
	  MaskDisplay		  "image(imread('bdi_ess.jpg'))"
	  MaskIconFrame		  on
	  MaskIconOpaque	  on
	  MaskIconRotate	  "none"
	  MaskIconUnits		  "autoscale"
	  System {
	    Name		    "energy\nstorage <ess>\nRC"
	    Location		    [101, 171, 870, 620]
	    Open		    off
	    ModelBrowserVisibility  off
	    ModelBrowserWidth	    200
	    ScreenColor		    "white"
	    PaperOrientation	    "landscape"
	    PaperPositionMode	    "auto"
	    PaperType		    "usletter"
	    PaperUnits		    "inches"
	    ZoomFactor		    "100"
	    Block {
	      BlockType		      Inport
	      Name		      "power req'd\ninto bus (W)"
	      Position		      [85, 270, 105, 290]
	      Orientation	      "up"
	      NamePlacement	      "alternate"
	      FontName		      "Arial"
	      Port		      "1"
	      LatchInput	      off
	      Interpolate	      on
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Allow simulation\nto stop based on \nlo"
"w SOC"
	      Ports		      [1, 0, 1]
	      Position		      [385, 54, 445, 86]
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      on
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"Allow simulation\nto stop based on \n"
"low SOC"
		Location		[425, 260, 821, 470]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "SOC"
		  Position		  [75, 85, 95, 105]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  EnablePort
		  Name			  "Enable"
		  Ports			  []
		  Position		  [170, 25, 190, 45]
		  StatesWhenEnabling	  "held"
		  ShowOutputPort	  off
		}
		Block {
		  BlockType		  Constant
		  Name			  "Const"
		  Position		  [95, 145, 165, 165]
		  Orientation		  "up"
		  ShowName		  off
		  FontName		  "Arial"
		  Value			  ".001"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  RelationalOperator
		  Name			  "Relational\nOperator"
		  Position		  [185, 88, 215, 112]
		  Operator		  "<"
		}
		Block {
		  BlockType		  Stop
		  Name			  "Stop Simulation"
		  Position		  [255, 83, 295, 117]
		}
		Line {
		  SrcBlock		  "Relational\nOperator"
		  SrcPort		  1
		  DstBlock		  "Stop Simulation"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "SOC"
		  SrcPort		  1
		  DstBlock		  "Relational\nOperator"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Const"
		  SrcPort		  1
		  Points		  [0, -35]
		  DstBlock		  "Relational\nOperator"
		  DstPort		  2
		}
	      }
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Block NOTES"
	      Ports		      []
	      Position		      [635, 345, 691, 385]
	      BackgroundColor	      "green"
	      ShowName		      off
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      MaskDisplay	      "disp('Block\\nNOTES')"
	      MaskIconFrame	      on
	      MaskIconOpaque	      on
	      MaskIconRotate	      "none"
	      MaskIconUnits	      "autoscale"
	      System {
		Name			"Block NOTES"
		Location		[254, 542, 739, 847]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Annotation {
		  Position		  [242, 146]
		  Text			  "This block models the energy storag"
"e system as an SOC-dependent voltage\nin series with an SOC- and current dire"
"ction-dependent internal resistance.\nSOC is computed assuming that A-h capac"
"ity is constant, but limited\nsuch that a minimum voltage is never exceeded ("
"replacing the \nprevious Peukert relationship which underpredicted battery ca"
"pacity).\n\nDischarge power is limited here so as not to bring the bus (batte"
"ry pack) voltage below\nthe minimum controller voltage or the minimum battery"
" voltage and so as to allow \nthe solution of the quadratic eq'n for discharg"
"e current.\n\nCharge current is limited to ensure the voltage does not exceed"
" a maximum\nvoltage\n\nPositive current is discharge current in the conventio"
"n used here.\nPower loss is computed as I*R+losses due to Coulombic (in)effic"
"iency.\n\nThermal modeling of the battery performance is modeled in the\nOCV,"
" Rint, and capacity."
		}
	      }
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Const"
	      Position		      [380, 20, 450, 40]
	      Orientation	      "down"
	      ShowName		      off
	      FontName		      "Arial"
	      Value		      "enable_stop"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <cs>"
	      Position		      [685, 275, 735, 295]
	      GotoTag		      "ess_tmp"
	      TagVisibility	      "global"
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <mc>, <gc>, <sdo>"
	      Position		      [375, 195, 455, 215]
	      GotoTag		      "bus_voltage"
	      TagVisibility	      "global"
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <sdo>, <cs>"
	      Position		      [400, 159, 445, 181]
	      GotoTag		      "SOC"
	      TagVisibility	      "global"
	    }
	    Block {
	      BlockType		      Memory
	      Name		      "Memory"
	      Position		      [620, 210, 635, 230]
	      ShowName		      off
	      X0		      "ess_mod_init_tmp"
	      InheritSampleTime	      off
	      RTWStateStorageClass    "Auto"
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Model Parameters"
	      Ports		      [3, 5]
	      Position		      [70, 109, 165, 221]
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"Model Parameters"
		Location		[140, 501, 507, 892]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "SOC"
		  Position		  [45, 155, 65, 175]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "Ess Temp"
		  Position		  [55, 40, 75, 60]
		  Port			  "2"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "Preq"
		  Position		  [45, 335, 65, 355]
		  Port			  "3"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Terminator
		  Name			  "Terminator"
		  Position		  [95, 335, 115, 355]
		}
		Block {
		  BlockType		  Lookup
		  Name			  "cb"
		  Position		  [175, 35, 205, 65]
		  InputValues		  "ess_tmp"
		  OutputValues		  "ess_cb"
		}
		Block {
		  BlockType		  Lookup
		  Name			  "cc"
		  Position		  [175, 85, 205, 115]
		  InputValues		  "ess_tmp"
		  OutputValues		  "ess_cc"
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "rc"
		  Ports			  [2, 1]
		  Position		  [175, 203, 205, 227]
		  ShowPortLabels	  off
		  TreatAsAtomicUnit	  off
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  MaskType		  "2-D Table Lookup"
		  MaskDescription	  "Two Dimensional Table Lookup\nThe f"
"irst input corresponds to X Index and the second input corresponds to the Y I"
"ndex"
		  MaskHelp		  "This block returns a linearly inter"
"polated intersection from the table using the X index (which corresponds to t"
"he rows of the table) and the Y index (which corresponds to the columns of th"
"e table).  Extrapolation is used."
		  MaskPromptString	  "X Index|Y Index|Table"
		  MaskStyleString	  "edit,edit,edit"
		  MaskTunableValueString  "on,on,on"
		  MaskCallbackString	  "||"
		  MaskEnableString	  "on,on,on"
		  MaskVisibilityString	  "on,on,on"
		  MaskToolTipString	  "on,on,on"
		  MaskInitialization	  "xindex=@1; yindex=@2; table=@3; sft"
"ab2chk(xindex,yindex,table);"
		  MaskDisplay		  "plot(-10,-10,110,110,[90,50,10],[90"
",40,30],[90,50,10],[50,26,20],[90,50,10],[22,13,10])"
		  MaskIconFrame		  on
		  MaskIconOpaque	  on
		  MaskIconRotate	  "none"
		  MaskIconUnits		  "autoscale"
		  MaskValueString	  "ess_tmp|ess_soc|ess_rc"
		  MaskVariableAliases	  ",,"
		  System {
		    Name		    "rc"
		    Location		    [316, 263, 598, 417]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "x0"
		    Position		    [20, 25, 40, 45]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "y0"
		    Position		    [20, 80, 40, 100]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Mux
		    Name		    "Mux"
		    Ports		    [2, 1]
		    Position		    [90, 46, 120, 79]
		    Inputs		    "2"
		    DisplayOption	    "none"
		    }
		    Block {
		    BlockType		    "S-Function"
		    Name		    "S-function"
		    Ports		    [1, 1]
		    Position		    [140, 52, 190, 78]
		    FunctionName	    "sftable2"
		    Parameters		    "xindex, yindex, table"
		    PortCounts		    "[]"
		    SFunctionModules	    "''"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "table out"
		    Position		    [215, 55, 235, 75]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "y0"
		    SrcPort		    1
		    Points		    [20, 0; 0, -20]
		    DstBlock		    "Mux"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "S-function"
		    SrcPort		    1
		    DstBlock		    "table out"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "x0"
		    SrcPort		    1
		    Points		    [20, 0; 0, 20]
		    DstBlock		    "Mux"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Mux"
		    SrcPort		    1
		    DstBlock		    "S-function"
		    DstPort		    1
		    }
		  }
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "re"
		  Ports			  [2, 1]
		  Position		  [175, 148, 205, 172]
		  ShowPortLabels	  off
		  TreatAsAtomicUnit	  off
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  MaskType		  "2-D Table Lookup"
		  MaskDescription	  "Two Dimensional Table Lookup\nThe f"
"irst input corresponds to X Index and the second input corresponds to the Y I"
"ndex"
		  MaskHelp		  "This block returns a linearly inter"
"polated intersection from the table using the X index (which corresponds to t"
"he rows of the table) and the Y index (which corresponds to the columns of th"
"e table).  Extrapolation is used."
		  MaskPromptString	  "X Index|Y Index|Table"
		  MaskStyleString	  "edit,edit,edit"
		  MaskTunableValueString  "on,on,on"
		  MaskCallbackString	  "||"
		  MaskEnableString	  "on,on,on"
		  MaskVisibilityString	  "on,on,on"
		  MaskToolTipString	  "on,on,on"
		  MaskInitialization	  "xindex=@1; yindex=@2; table=@3; sft"
"ab2chk(xindex,yindex,table);"
		  MaskDisplay		  "plot(-10,-10,110,110,[90,50,10],[90"
",40,30],[90,50,10],[50,26,20],[90,50,10],[22,13,10])"
		  MaskIconFrame		  on
		  MaskIconOpaque	  on
		  MaskIconRotate	  "none"
		  MaskIconUnits		  "autoscale"
		  MaskValueString	  "ess_tmp|ess_soc|ess_re"
		  MaskVariableAliases	  ",,"
		  System {
		    Name		    "re"
		    Location		    [318, 265, 600, 419]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "x0"
		    Position		    [20, 25, 40, 45]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "y0"
		    Position		    [20, 80, 40, 100]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Mux
		    Name		    "Mux"
		    Ports		    [2, 1]
		    Position		    [90, 46, 120, 79]
		    Inputs		    "2"
		    DisplayOption	    "none"
		    }
		    Block {
		    BlockType		    "S-Function"
		    Name		    "S-function"
		    Ports		    [1, 1]
		    Position		    [140, 52, 190, 78]
		    FunctionName	    "sftable2"
		    Parameters		    "xindex, yindex, table"
		    PortCounts		    "[]"
		    SFunctionModules	    "''"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "table out"
		    Position		    [215, 55, 235, 75]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "Mux"
		    SrcPort		    1
		    DstBlock		    "S-function"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "x0"
		    SrcPort		    1
		    Points		    [20, 0; 0, 20]
		    DstBlock		    "Mux"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "S-function"
		    SrcPort		    1
		    DstBlock		    "table out"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "y0"
		    SrcPort		    1
		    Points		    [20, 0; 0, -20]
		    DstBlock		    "Mux"
		    DstPort		    2
		    }
		  }
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "rt"
		  Ports			  [2, 1]
		  Position		  [175, 263, 205, 287]
		  ShowPortLabels	  off
		  TreatAsAtomicUnit	  off
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  MaskType		  "2-D Table Lookup"
		  MaskDescription	  "Two Dimensional Table Lookup\nThe f"
"irst input corresponds to X Index and the second input corresponds to the Y I"
"ndex"
		  MaskHelp		  "This block returns a linearly inter"
"polated intersection from the table using the X index (which corresponds to t"
"he rows of the table) and the Y index (which corresponds to the columns of th"
"e table).  Extrapolation is used."
		  MaskPromptString	  "X Index|Y Index|Table"
		  MaskStyleString	  "edit,edit,edit"
		  MaskTunableValueString  "on,on,on"
		  MaskCallbackString	  "||"
		  MaskEnableString	  "on,on,on"
		  MaskVisibilityString	  "on,on,on"
		  MaskToolTipString	  "on,on,on"
		  MaskInitialization	  "xindex=@1; yindex=@2; table=@3; sft"
"ab2chk(xindex,yindex,table);"
		  MaskDisplay		  "plot(-10,-10,110,110,[90,50,10],[90"
",40,30],[90,50,10],[50,26,20],[90,50,10],[22,13,10])"
		  MaskIconFrame		  on
		  MaskIconOpaque	  on
		  MaskIconRotate	  "none"
		  MaskIconUnits		  "autoscale"
		  MaskValueString	  "ess_tmp|ess_soc|ess_rt"
		  MaskVariableAliases	  ",,"
		  System {
		    Name		    "rt"
		    Location		    [316, 263, 598, 417]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "x0"
		    Position		    [20, 25, 40, 45]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "y0"
		    Position		    [20, 80, 40, 100]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Mux
		    Name		    "Mux"
		    Ports		    [2, 1]
		    Position		    [90, 46, 120, 79]
		    Inputs		    "2"
		    DisplayOption	    "none"
		    }
		    Block {
		    BlockType		    "S-Function"
		    Name		    "S-function"
		    Ports		    [1, 1]
		    Position		    [140, 52, 190, 78]
		    FunctionName	    "sftable2"
		    Parameters		    "xindex, yindex, table"
		    PortCounts		    "[]"
		    SFunctionModules	    "''"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "table out"
		    Position		    [215, 55, 235, 75]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "Mux"
		    SrcPort		    1
		    DstBlock		    "S-function"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "x0"
		    SrcPort		    1
		    Points		    [20, 0; 0, 20]
		    DstBlock		    "Mux"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "S-function"
		    SrcPort		    1
		    DstBlock		    "table out"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "y0"
		    SrcPort		    1
		    Points		    [20, 0; 0, -20]
		    DstBlock		    "Mux"
		    DstPort		    2
		    }
		  }
		}
		Block {
		  BlockType		  Outport
		  Name			  "Cb"
		  Position		  [255, 40, 275, 60]
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Cc"
		  Position		  [255, 90, 275, 110]
		  Port			  "2"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Re"
		  Position		  [255, 150, 275, 170]
		  Port			  "3"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Rc"
		  Position		  [255, 205, 275, 225]
		  Port			  "4"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Rt"
		  Position		  [255, 265, 275, 285]
		  Port			  "5"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Line {
		  SrcBlock		  "rc"
		  SrcPort		  1
		  DstBlock		  "Rc"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "rt"
		  SrcPort		  1
		  DstBlock		  "Rt"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "re"
		  SrcPort		  1
		  DstBlock		  "Re"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "cc"
		  SrcPort		  1
		  DstBlock		  "Cc"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "cb"
		  SrcPort		  1
		  DstBlock		  "Cb"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "SOC"
		  SrcPort		  1
		  Points		  [60, 0]
		  Branch {
		    Points		    [0, 55]
		    Branch {
		    Points		    [0, 60]
		    DstBlock		    "rt"
		    DstPort		    2
		    }
		    Branch {
		    DstBlock		    "rc"
		    DstPort		    2
		    }
		  }
		  Branch {
		    DstBlock		    "re"
		    DstPort		    2
		  }
		}
		Line {
		  SrcBlock		  "Preq"
		  SrcPort		  1
		  DstBlock		  "Terminator"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Ess Temp"
		  SrcPort		  1
		  Points		  [60, 0]
		  Branch {
		    Points		    [0, 50]
		    Branch {
		    Points		    [0, 55]
		    Branch {
		    Points		    [0, 55]
		    Branch {
		    Points		    [0, 60]
		    DstBlock		    "rt"
		    DstPort		    1
		    }
		    Branch {
		    DstBlock		    "rc"
		    DstPort		    1
		    }
		    }
		    Branch {
		    DstBlock		    "re"
		    DstPort		    1
		    }
		    }
		    Branch {
		    DstBlock		    "cc"
		    DstPort		    1
		    }
		  }
		  Branch {
		    DstBlock		    "cb"
		    DstPort		    1
		  }
		}
	      }
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "RC model"
	      Ports		      [7, 4]
	      Position		      [235, 118, 330, 252]
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"RC model"
		Location		[71, 196, 928, 766]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "Cb"
		  Position		  [55, 70, 75, 90]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "Cc"
		  Position		  [55, 125, 75, 145]
		  Port			  "2"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "Re"
		  Position		  [55, 180, 75, 200]
		  Port			  "3"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "Rc"
		  Position		  [55, 235, 75, 255]
		  Port			  "4"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "Rt"
		  Position		  [55, 290, 75, 310]
		  Port			  "5"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "Preq"
		  Position		  [55, 345, 75, 365]
		  Port			  "6"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "Ess Temp"
		  Position		  [60, 400, 80, 420]
		  Port			  "7"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Gain
		  Name			  "#mods"
		  Position		  [495, 73, 645, 117]
		  Gain			  "ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Gain
		  Name			  "#mods1"
		  Position		  [495, 173, 645, 217]
		  Gain			  "ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Gain
		  Name			  "#mods2"
		  Position		  [495, 223, 645, 267]
		  Gain			  "ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Gain
		  Name			  "#mods3"
		  Position		  [465, 273, 615, 317]
		  Gain			  "ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Gain
		  Name			  "#mods4"
		  Position		  [465, 323, 615, 367]
		  Gain			  "ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Gain
		  Name			  "1/#mods"
		  Position		  [100, 333, 250, 377]
		  Gain			  "1/ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Demux
		  Name			  "Demux1"
		  Ports			  [1, 7]
		  Position		  [440, 66, 445, 424]
		  BackgroundColor	  "black"
		  Outputs		  "7"
		  BusSelectionMode	  off
		}
		Block {
		  BlockType		  Goto
		  Name			  "Goto <cs>1"
		  Position		  [675, 285, 755, 305]
		  GotoTag		  "ess_max_pwr"
		  TagVisibility		  "global"
		}
		Block {
		  BlockType		  Goto
		  Name			  "Goto <cs>2"
		  Position		  [670, 335, 775, 355]
		  GotoTag		  "ess_max_chg_pwr"
		  TagVisibility		  "global"
		}
		Block {
		  BlockType		  Memory
		  Name			  "Memory1"
		  Position		  [530, 135, 545, 155]
		  ShowName		  off
		  X0			  "ess_init_soc"
		  InheritSampleTime	  off
		  RTWStateStorageClass	  "Auto"
		}
		Block {
		  BlockType		  Memory
		  Name			  "Memory2"
		  Position		  [635, 335, 650, 355]
		  ShowName		  off
		  X0			  "0"
		  InheritSampleTime	  off
		  RTWStateStorageClass	  "Auto"
		}
		Block {
		  BlockType		  Memory
		  Name			  "Memory3"
		  Position		  [640, 285, 655, 305]
		  ShowName		  off
		  X0			  "0"
		  InheritSampleTime	  off
		  RTWStateStorageClass	  "Auto"
		}
		Block {
		  BlockType		  Mux
		  Name			  "Mux2"
		  Ports			  [7, 1]
		  Position		  [295, 48, 300, 442]
		  Inputs		  "7"
		  DisplayOption		  "none"
		}
		Block {
		  BlockType		  "S-Function"
		  Name			  "RC model\nof one module"
		  Ports			  [1, 1]
		  Position		  [330, 230, 390, 260]
		  FunctionName		  "RC"
		  Parameters		  "ess_min_volts,ess_max_volts,mc_min_"
"volts/ess_module_num,ess_soc,ess_tmp,ess_voc,ess_init_soc,ess_mod_init_tmp"
		  PortCounts		  "[]"
		  SFunctionModules	  "''"
		}
		Block {
		  BlockType		  ToWorkspace
		  Name			  "To Workspace9"
		  Position		  [680, 384, 755, 406]
		  VariableName		  "ess_current"
		  MaxDataPoints		  "inf"
		  Decimation		  "1"
		  SampleTime		  "-1"
		  SaveFormat		  "Array"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Pavailable"
		  Position		  [705, 85, 725, 105]
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Block {
		  BlockType		  Outport
		  Name			  "SOC"
		  Position		  [705, 135, 725, 155]
		  Port			  "2"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Vout"
		  Position		  [705, 185, 725, 205]
		  Port			  "3"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Qess_gen"
		  Position		  [705, 235, 725, 255]
		  Port			  "4"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Line {
		  SrcBlock		  "RC model\nof one module"
		  SrcPort		  1
		  DstBlock		  "Demux1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "#mods2"
		  SrcPort		  1
		  DstBlock		  "Qess_gen"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Demux1"
		  SrcPort		  4
		  DstBlock		  "#mods2"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "#mods1"
		  SrcPort		  1
		  DstBlock		  "Vout"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Demux1"
		  SrcPort		  3
		  DstBlock		  "#mods1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "#mods"
		  SrcPort		  1
		  DstBlock		  "Pavailable"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Demux1"
		  SrcPort		  1
		  DstBlock		  "#mods"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "1/#mods"
		  SrcPort		  1
		  DstBlock		  "Mux2"
		  DstPort		  6
		}
		Line {
		  SrcBlock		  "Preq"
		  SrcPort		  1
		  DstBlock		  "1/#mods"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Mux2"
		  SrcPort		  1
		  DstBlock		  "RC model\nof one module"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Rt"
		  SrcPort		  1
		  DstBlock		  "Mux2"
		  DstPort		  5
		}
		Line {
		  SrcBlock		  "Rc"
		  SrcPort		  1
		  DstBlock		  "Mux2"
		  DstPort		  4
		}
		Line {
		  SrcBlock		  "Re"
		  SrcPort		  1
		  DstBlock		  "Mux2"
		  DstPort		  3
		}
		Line {
		  SrcBlock		  "Cc"
		  SrcPort		  1
		  DstBlock		  "Mux2"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Cb"
		  SrcPort		  1
		  DstBlock		  "Mux2"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Ess Temp"
		  SrcPort		  1
		  DstBlock		  "Mux2"
		  DstPort		  7
		}
		Line {
		  SrcBlock		  "Demux1"
		  SrcPort		  7
		  DstBlock		  "To Workspace9"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Demux1"
		  SrcPort		  6
		  DstBlock		  "#mods4"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Memory2"
		  SrcPort		  1
		  DstBlock		  "Goto <cs>2"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Demux1"
		  SrcPort		  5
		  DstBlock		  "#mods3"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Memory3"
		  SrcPort		  1
		  DstBlock		  "Goto <cs>1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Demux1"
		  SrcPort		  2
		  DstBlock		  "Memory1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Memory1"
		  SrcPort		  1
		  DstBlock		  "SOC"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "#mods3"
		  SrcPort		  1
		  DstBlock		  "Memory3"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "#mods4"
		  SrcPort		  1
		  DstBlock		  "Memory2"
		  DstPort		  1
		}
	      }
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Thermal Model\nof Battery"
	      Ports		      [1, 3, 1]
	      Position		      [510, 213, 600, 267]
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      on
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"Thermal Model\nof Battery"
		Location		[435, 254, 950, 524]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "Qess_gen"
		  Position		  [25, 205, 45, 225]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  EnablePort
		  Name			  "Enable"
		  Ports			  []
		  Position		  [390, 217, 420, 243]
		  StatesWhenEnabling	  "reset"
		  ShowOutputPort	  off
		}
		Block {
		  BlockType		  Gain
		  Name			  "#of mods"
		  Position		  [390, 88, 415, 112]
		  Gain			  "ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Gain
		  Name			  "1/#of mods"
		  Position		  [95, 203, 120, 227]
		  Gain			  "1/ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Gain
		  Name			  "1/mcp"
		  Position		  [380, 153, 405, 177]
		  Gain			  "1/(ess_module_mass*ess_mod_cp)"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Block NOTES"
		  Ports			  []
		  Position		  [445, 220, 501, 260]
		  BackgroundColor	  "green"
		  ShowName		  off
		  ShowPortLabels	  on
		  TreatAsAtomicUnit	  off
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  MaskDisplay		  "disp('Block\\nNOTES')"
		  MaskIconFrame		  on
		  MaskIconOpaque	  on
		  MaskIconRotate	  "none"
		  MaskIconUnits		  "autoscale"
		  System {
		    Name		    "Block NOTES"
		    Location		    [505, 510, 924, 573]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Annotation {
		    Position		    [207, 33]
		    Text		    "This block models the thermal beh"
"avior of a battery module with active air cooling.\nThe module is modeled as "
"a single lumped thermal mass.  \nThe fan is on whenever the battery temp is >"
" the set temp."
		    }
		  }
		}
		Block {
		  BlockType		  Memory
		  Name			  "Memory"
		  Position		  [250, 165, 285, 185]
		  Orientation		  "left"
		  FontName		  "Arial"
		  X0			  "cyc_mph(1,2)*.447"
		  InheritSampleTime	  off
		  RTWStateStorageClass	  "Auto"
		}
		Block {
		  BlockType		  Memory
		  Name			  "Memory1"
		  Position		  [100, 30, 135, 50]
		  Orientation		  "left"
		  FontName		  "Arial"
		  X0			  "cyc_mph(1,2)*.447"
		  InheritSampleTime	  off
		  RTWStateStorageClass	  "Auto"
		}
		Block {
		  BlockType		  Mux
		  Name			  "Mux20"
		  Ports			  [3, 1]
		  Position		  [195, 84, 200, 156]
		  NamePlacement		  "alternate"
		  ShowName		  off
		  Inputs		  "3"
		  DisplayOption		  "none"
		}
		Block {
		  BlockType		  Sum
		  Name			  "Qc"
		  Ports			  [2, 1]
		  Position		  [350, 114, 360, 221]
		  ShowName		  off
		  IconShape		  "rectangular"
		  Inputs		  "++"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Fcn
		  Name			  "Qess_case"
		  Position		  [235, 108, 315, 132]
		  NamePlacement		  "alternate"
		  FontName		  "Arial"
		  Expr			  "(u(2) - u(1))/u(3)"
		}
		Block {
		  BlockType		  Saturate
		  Name			  "Saturation3"
		  Position		  [190, 29, 200, 51]
		  Orientation		  "left"
		  ShowName		  off
		  UpperLimit		  "1"
		  LowerLimit		  "0"
		  LinearizeAsGain	  on
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Tair,ave"
		  Ports			  [1, 2, 1]
		  Position		  [30, 107, 140, 158]
		  ShowPortLabels	  on
		  TreatAsAtomicUnit	  on
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  System {
		    Name		    "Tair,ave"
		    Location		    [347, 78, 747, 306]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "Qess_case"
		    Position		    [45, 35, 65, 55]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    EnablePort
		    Name		    "Enable"
		    Ports		    []
		    Position		    [265, 167, 295, 193]
		    StatesWhenEnabling	    "reset"
		    ShowOutputPort	    off
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "Block NOTES"
		    Ports		    []
		    Position		    [325, 165, 381, 205]
		    BackgroundColor	    "green"
		    ShowName		    off
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    MaskDisplay		    "disp('Block\\nNOTES')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "autoscale"
		    System {
		    Name		    "Block NOTES"
		    Location		    [505, 510, 924, 573]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Annotation {
		    Position		    [207, 33]
		    Text		    "This block determins the average "
"temperature of the cooling air over the module."
		    }
		    }
		    }
		    Block {
		    BlockType		    Fcn
		    Name		    "Tamb-(Q/mcp)/2"
		    Position		    [90, 34, 330, 56]
		    Expr		    "amb_tmp - (u(1)/(ess_mod_airflow*"
"air_cp))/2 "
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "do ex calcs?1"
		    Position		    [35, 105, 115, 125]
		    ShowName		    off
		    Value		    "ess_th_res_on"
		    VectorParams1D	    on
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "Tair_ave"
		    Position		    [355, 35, 375, 55]
		    Port		    "1"
		    OutputWhenDisabled	    "reset"
		    InitialOutput	    "amb_tmp"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "Th Res"
		    Position		    [355, 105, 375, 125]
		    Port		    "2"
		    OutputWhenDisabled	    "reset"
		    InitialOutput	    "ess_th_res_off"
		    }
		    Line {
		    SrcBlock		    "do ex calcs?1"
		    SrcPort		    1
		    DstBlock		    "Th Res"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Qess_case"
		    SrcPort		    1
		    DstBlock		    "Tamb-(Q/mcp)/2"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Tamb-(Q/mcp)/2"
		    SrcPort		    1
		    DstBlock		    "Tair_ave"
		    DstPort		    1
		    }
		  }
		}
		Block {
		  BlockType		  Integrator
		  Name			  "Tess2"
		  Ports			  [1, 1]
		  Position		  [420, 155, 440, 175]
		  ExternalReset		  "none"
		  InitialConditionSource  "internal"
		  InitialCondition	  "ess_mod_init_tmp"
		  LimitOutput		  off
		  UpperSaturationLimit	  "inf"
		  LowerSaturationLimit	  "-inf"
		  ShowSaturationPort	  off
		  ShowStatePort		  off
		  AbsoluteTolerance	  "auto"
		}
		Block {
		  BlockType		  Fcn
		  Name			  "thermostat"
		  Position		  [235, 29, 340, 51]
		  Orientation		  "left"
		  NamePlacement		  "alternate"
		  FontName		  "Arial"
		  Expr			  "u(1) - ess_set_tmp"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Tess"
		  Position		  [470, 155, 490, 175]
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Tair"
		  Position		  [470, 60, 490, 80]
		  NamePlacement		  "alternate"
		  Port			  "2"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "[]"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Qair"
		  Position		  [470, 90, 490, 110]
		  Port			  "3"
		  OutputWhenDisabled	  "reset"
		  InitialOutput		  "0"
		}
		Line {
		  SrcBlock		  "Tair,ave"
		  SrcPort		  1
		  Points		  [10, 0]
		  Branch {
		    Points		    [0, -50]
		    DstBlock		    "Tair"
		    DstPort		    1
		  }
		  Branch {
		    DstBlock		    "Mux20"
		    DstPort		    2
		  }
		}
		Line {
		  SrcBlock		  "Tair,ave"
		  SrcPort		  2
		  DstBlock		  "Mux20"
		  DstPort		  3
		}
		Line {
		  SrcBlock		  "Mux20"
		  SrcPort		  1
		  DstBlock		  "Qess_case"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "#of mods"
		  SrcPort		  1
		  DstBlock		  "Qair"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Memory"
		  SrcPort		  1
		  Points		  [-230, 0]
		  DstBlock		  "Tair,ave"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Memory1"
		  SrcPort		  1
		  Points		  [-10, 0]
		  DstBlock		  "Tair,ave"
		  DstPort		  enable
		}
		Line {
		  SrcBlock		  "Saturation3"
		  SrcPort		  1
		  DstBlock		  "Memory1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "thermostat"
		  SrcPort		  1
		  DstBlock		  "Saturation3"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "1/#of mods"
		  SrcPort		  1
		  Points		  [210, 0]
		  DstBlock		  "Qc"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Qess_gen"
		  SrcPort		  1
		  DstBlock		  "1/#of mods"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Tess2"
		  SrcPort		  1
		  Points		  [0, 0]
		  Branch {
		    Points		    [0, -85; -80, 0]
		    Branch {
		    Points		    [0, -40]
		    DstBlock		    "thermostat"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [-185, 0]
		    DstBlock		    "Mux20"
		    DstPort		    1
		    }
		  }
		  Branch {
		    DstBlock		    "Tess"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "1/mcp"
		  SrcPort		  1
		  DstBlock		  "Tess2"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Qess_case"
		  SrcPort		  1
		  Points		  [5, 0]
		  Branch {
		    Points		    [0, -20]
		    DstBlock		    "#of mods"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, 55]
		    DstBlock		    "Memory"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [10, 0]
		    DstBlock		    "Qc"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "Qc"
		  SrcPort		  1
		  DstBlock		  "1/mcp"
		  DstPort		  1
		}
	      }
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS1"
	      Position		      [304, 290, 386, 305]
	      Orientation	      "down"
	      NamePlacement	      "alternate"
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_pwr_loss_a"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "0"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS2"
	      Position		      [665, 213, 735, 227]
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_mod_tmp"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "0"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS3"
	      Position		      [665, 233, 735, 247]
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_air_tmp"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "0"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS4"
	      Position		      [665, 254, 740, 266]
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_air_th_pwr"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "0"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS5"
	      Position		      [380, 252, 460, 268]
	      NamePlacement	      "alternate"
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_voltage"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "0"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To Workspace8"
	      Position		      [130, 270, 200, 290]
	      NamePlacement	      "alternate"
	      ShowName		      off
	      VariableName	      "ess_pwr_out_r"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "-1"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To Workspace9"
	      Position		      [660, 64, 735, 86]
	      NamePlacement	      "alternate"
	      ShowName		      off
	      VariableName	      "ess_pwr_out_a"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "-1"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "do ex calcs?"
	      Position		      [525, 185, 585, 200]
	      Orientation	      "down"
	      ShowName		      off
	      Value		      "ess_th_calc"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "documentation9"
	      Ports		      []
	      Position		      [705, 346, 734, 385]
	      BackgroundColor	      "orange"
	      DropShadow	      on
	      ShowName		      off
	      OpenFcn		      "web(['file:\\\\\\' which('energy_storag"
"e.htm')]);"
	      ShowPortLabels	      off
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      MaskDisplay	      "image(imread('doc_man.jpg'))"
	      MaskIconFrame	      on
	      MaskIconOpaque	      on
	      MaskIconRotate	      "none"
	      MaskIconUnits	      "autoscale"
	      System {
		Name			"documentation9"
		Location		[129, 62, 308, 146]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
	      }
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "power available\nto bus (W)"
	      Position		      [670, 125, 690, 145]
	      FontName		      "Arial"
	      Port		      "1"
	      OutputWhenDisabled      "held"
	      InitialOutput	      "0"
	    }
	    Line {
	      SrcBlock		      "RC model"
	      SrcPort		      1
	      Points		      [285, 0]
	      Branch {
		Points			[0, -60]
		DstBlock		"To Workspace9"
		DstPort			1
	      }
	      Branch {
		DstBlock		"power available\nto bus (W)"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "do ex calcs?"
	      SrcPort		      1
	      DstBlock		      "Thermal Model\nof Battery"
	      DstPort		      enable
	    }
	    Line {
	      SrcBlock		      "Thermal Model\nof Battery"
	      SrcPort		      2
	      DstBlock		      "To WS3"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Thermal Model\nof Battery"
	      SrcPort		      3
	      DstBlock		      "To WS4"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Thermal Model\nof Battery"
	      SrcPort		      1
	      DstBlock		      "Memory"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Memory"
	      SrcPort		      1
	      Points		      [10, 0]
	      Branch {
		Points			[0, 65]
		Branch {
		  Points		  [0, 35; -430, 0]
		  Branch {
		    DstBlock		    "RC model"
		    DstPort		    7
		  }
		  Branch {
		    Points		    [-200, 0; 0, -155]
		    DstBlock		    "Model Parameters"
		    DstPort		    2
		  }
		}
		Branch {
		  DstBlock		  "Goto <cs>"
		  DstPort		  1
		}
	      }
	      Branch {
		DstBlock		"To WS2"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Const"
	      SrcPort		      1
	      DstBlock		      "Allow simulation\nto stop based on \nlo"
"w SOC"
	      DstPort		      enable
	    }
	    Line {
	      SrcBlock		      "RC model"
	      SrcPort		      2
	      Points		      [15, 0]
	      Branch {
		DstBlock		"Goto <sdo>, <cs>"
		DstPort			1
	      }
	      Branch {
		Points			[0, -70]
		Branch {
		  Points		  [20, 0]
		  DstBlock		  "Allow simulation\nto stop based on "
"\nlow SOC"
		  DstPort		  1
		}
		Branch {
		  Points		  [-295, 0]
		  DstBlock		  "Model Parameters"
		  DstPort		  1
		}
	      }
	    }
	    Line {
	      SrcBlock		      "RC model"
	      SrcPort		      4
	      Points		      [10, 0]
	      Branch {
		DstBlock		"Thermal Model\nof Battery"
		DstPort			1
	      }
	      Branch {
		DstBlock		"To WS1"
		DstPort			1
	      }
	    }
	    Line {
	      Labels		      [1, 0]
	      SrcBlock		      "power req'd\ninto bus (W)"
	      SrcPort		      1
	      Points		      [0, -15]
	      Branch {
		Points			[20, 0]
		Branch {
		  DstBlock		  "To Workspace8"
		  DstPort		  1
		}
		Branch {
		  Points		  [75, 0; 0, -25]
		  DstBlock		  "RC model"
		  DstPort		  6
		}
	      }
	      Branch {
		Points			[-40, 0]
		DstBlock		"Model Parameters"
		DstPort			3
	      }
	    }
	    Line {
	      SrcBlock		      "Model Parameters"
	      SrcPort		      5
	      DstBlock		      "RC model"
	      DstPort		      5
	    }
	    Line {
	      SrcBlock		      "Model Parameters"
	      SrcPort		      4
	      DstBlock		      "RC model"
	      DstPort		      4
	    }
	    Line {
	      SrcBlock		      "Model Parameters"
	      SrcPort		      3
	      DstBlock		      "RC model"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "Model Parameters"
	      SrcPort		      2
	      DstBlock		      "RC model"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Model Parameters"
	      SrcPort		      1
	      DstBlock		      "RC model"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "RC model"
	      SrcPort		      3
	      Points		      [15, 0]
	      Branch {
		DstBlock		"Goto <mc>, <gc>, <sdo>"
		DstPort			1
	      }
	      Branch {
		Points			[0, 55]
		DstBlock		"To WS5"
		DstPort			1
	      }
	    }
	  }
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "energy\nstorage <ess>\nnnet"
	  Ports			  [1, 1]
	  Position		  [90, 202, 155, 248]
	  ForegroundColor	  "magenta"
	  ShowPortLabels	  off
	  TreatAsAtomicUnit	  off
	  RTWSystemCode		  "Auto"
	  RTWFcnNameOpts	  "Auto"
	  RTWFileNameOpts	  "Auto"
	  MaskDisplay		  "image(imread('bdi_ess.jpg'))"
	  MaskIconFrame		  on
	  MaskIconOpaque	  on
	  MaskIconRotate	  "none"
	  MaskIconUnits		  "autoscale"
	  System {
	    Name		    "energy\nstorage <ess>\nnnet"
	    Location		    [67, 197, 1095, 788]
	    Open		    off
	    ModelBrowserVisibility  off
	    ModelBrowserWidth	    200
	    ScreenColor		    "white"
	    PaperOrientation	    "landscape"
	    PaperPositionMode	    "auto"
	    PaperType		    "usletter"
	    PaperUnits		    "inches"
	    ZoomFactor		    "100"
	    Block {
	      BlockType		      Inport
	      Name		      "power req'd\ninto bus (W)"
	      Position		      [110, 250, 130, 270]
	      FontName		      "Arial"
	      Port		      "1"
	      LatchInput	      off
	      Interpolate	      on
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "# batteries1"
	      Position		      [650, 266, 695, 294]
	      NamePlacement	      "alternate"
	      Gain		      "ess_module_num"
	      Multiplication	      "Element-wise(K.*u)"
	      SaturateOnIntegerOverflow	on
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "# batteries2"
	      Position		      [610, 205, 660, 235]
	      Gain		      "ess_module_num"
	      Multiplication	      "Element-wise(K.*u)"
	      SaturateOnIntegerOverflow	on
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "1/# batteries"
	      Position		      [200, 240, 345, 280]
	      Gain		      "1/ess_module_num"
	      Multiplication	      "Element-wise(K.*u)"
	      SaturateOnIntegerOverflow	on
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Const"
	      Position		      [210, 345, 280, 365]
	      Orientation	      "down"
	      ShowName		      off
	      FontName		      "Arial"
	      Value		      "enable_stop"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Const2"
	      Position		      [575, 420, 630, 440]
	      Orientation	      "left"
	      ShowName		      off
	      FontName		      "Arial"
	      Value		      "amb_tmp"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Const4"
	      Position		      [285, 103, 305, 127]
	      ShowName		      off
	      FontName		      "Arial"
	      Value		      "0"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Const5"
	      Position		      [405, 353, 425, 377]
	      ShowName		      off
	      FontName		      "Arial"
	      Value		      "0"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Const6"
	      Position		      [450, 278, 470, 302]
	      ShowName		      off
	      FontName		      "Arial"
	      Value		      "0"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <cs>1"
	      Position		      [415, 510, 495, 530]
	      GotoTag		      "ess_max_pwr"
	      TagVisibility	      "global"
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <mc>, <gc>, <sdo>"
	      Position		      [700, 210, 780, 230]
	      GotoTag		      "bus_voltage"
	      TagVisibility	      "global"
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <sdo>, <cs>"
	      Position		      [365, 449, 410, 471]
	      GotoTag		      "SOC"
	      TagVisibility	      "global"
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Limits"
	      Ports		      [2]
	      Position		      [935, 15, 965, 95]
	      FontName		      "Arial"
	      ShowPortLabels	      off
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"Limits"
		Location		[74, 112, 640, 703]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "power req"
		  Position		  [60, 315, 80, 335]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "power \navailable from\nbattery"
		  Position		  [60, 390, 80, 410]
		  Port			  "2"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Constant
		  Name			  "Const1"
		  Position		  [265, 35, 285, 55]
		  ShowName		  off
		  FontName		  "Arial"
		  Value			  "0"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Constant
		  Name			  "Const2"
		  Position		  [270, 90, 290, 110]
		  ShowName		  off
		  FontName		  "Arial"
		  Value			  "0"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Constant
		  Name			  "Const3"
		  Position		  [275, 150, 295, 170]
		  ShowName		  off
		  FontName		  "Arial"
		  Value			  "0"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Constant
		  Name			  "Const4"
		  Position		  [285, 205, 305, 225]
		  ShowName		  off
		  FontName		  "Arial"
		  Value			  "0"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Goto
		  Name			  "Goto <sdo>"
		  Position		  [395, 349, 485, 371]
		  GotoTag		  "ess_pwr_limited"
		  TagVisibility		  "global"
		}
		Block {
		  BlockType		  Goto
		  Name			  "Goto <sdo>1"
		  Position		  [340, 202, 450, 228]
		  GotoTag		  "mc_voltage_limited"
		  TagVisibility		  "global"
		}
		Block {
		  BlockType		  Goto
		  Name			  "Goto <sdo>2"
		  Position		  [310, 34, 400, 56]
		  GotoTag		  "ess_soc_limited"
		  TagVisibility		  "global"
		}
		Block {
		  BlockType		  Goto
		  Name			  "Goto <sdo>3"
		  Position		  [330, 148, 435, 172]
		  GotoTag		  "ess_minV_limited"
		  TagVisibility		  "global"
		}
		Block {
		  BlockType		  Goto
		  Name			  "Goto <sdo>4"
		  Position		  [320, 88, 425, 112]
		  GotoTag		  "ess_maxV_limited"
		  TagVisibility		  "global"
		}
		Block {
		  BlockType		  RelationalOperator
		  Name			  "Relational\nOperator1"
		  Position		  [150, 342, 180, 373]
		  ShowName		  off
		  Operator		  "=="
		}
		Block {
		  BlockType		  Logic
		  Name			  "limited\nby battery"
		  Ports			  [1, 1]
		  Position		  [330, 344, 360, 376]
		  Operator		  "NOT"
		  Inputs		  "1"
		}
		Line {
		  SrcBlock		  "Relational\nOperator1"
		  SrcPort		  1
		  DstBlock		  "limited\nby battery"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "limited\nby battery"
		  SrcPort		  1
		  DstBlock		  "Goto <sdo>"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "power req"
		  SrcPort		  1
		  Points		  [50, 0]
		  DstBlock		  "Relational\nOperator1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "power \navailable from\nbattery"
		  SrcPort		  1
		  Points		  [50, 0]
		  DstBlock		  "Relational\nOperator1"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Const4"
		  SrcPort		  1
		  DstBlock		  "Goto <sdo>1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Const3"
		  SrcPort		  1
		  DstBlock		  "Goto <sdo>3"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Const2"
		  SrcPort		  1
		  DstBlock		  "Goto <sdo>4"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Const1"
		  SrcPort		  1
		  DstBlock		  "Goto <sdo>2"
		  DstPort		  1
		}
	      }
	    }
	    Block {
	      BlockType		      Logic
	      Name		      "Logical\nOperator"
	      Ports		      [1, 1]
	      Position		      [370, 170, 400, 200]
	      Orientation	      "down"
	      NamePlacement	      "alternate"
	      ShowName		      off
	      Operator		      "NOT"
	      Inputs		      "1"
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "NNet"
	      Ports		      [2, 2, 1]
	      Position		      [360, 240, 415, 320]
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      on
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"NNet"
		Location		[481, 588, 979, 888]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "Preq"
		  Position		  [40, 60, 60, 80]
		  FontName		  "Arial"
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "SOC"
		  Position		  [40, 160, 60, 180]
		  FontName		  "Arial"
		  Port			  "2"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  EnablePort
		  Name			  "Enable"
		  Ports			  []
		  Position		  [245, 30, 265, 50]
		  StatesWhenEnabling	  "held"
		  ShowOutputPort	  off
		}
		Block {
		  BlockType		  Fcn
		  Name			  "De-Normalizer1\nVoltage"
		  Position		  [375, 155, 435, 185]
		  Expr			  "(u-0.2)*(ess_MMo(2,2)-ess_MMo(2,1))"
"/(0.8-0.2)+ess_MMo(2,1)"
		}
		Block {
		  BlockType		  Fcn
		  Name			  "De-Normalizer2\nCurrent"
		  Position		  [370, 55, 430, 85]
		  Expr			  "(u-0.2)*(ess_MMo(1,2)-ess_MMo(1,1))"
"/(0.8-0.2)+ess_MMo(1,1)"
		}
		Block {
		  BlockType		  Demux
		  Name			  "Demux"
		  Ports			  [1, 2]
		  Position		  [305, 107, 340, 143]
		  Outputs		  "2"
		  BusSelectionMode	  off
		}
		Block {
		  BlockType		  Mux
		  Name			  "Mux"
		  Ports			  [2, 1]
		  Position		  [175, 107, 210, 143]
		  Inputs		  "2"
		  DisplayOption		  "none"
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Neural Network"
		  Ports			  [1, 1]
		  Position		  [225, 105, 285, 145]
		  BackgroundColor	  "lightBlue"
		  ShowPortLabels	  on
		  TreatAsAtomicUnit	  off
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  System {
		    Name		    "Neural Network"
		    Location		    [614, 586, 1114, 846]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "p{1}"
		    Position		    [40, 40, 60, 60]
		    BackgroundColor	    "magenta"
		    Port		    "1"
		    LatchInput		    off
		    PortDimensions	    "2"
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    From
		    Name		    " a{1} "
		    Position		    [40, 120, 60, 140]
		    GotoTag		    "feedback1"
		    MaskDisplay		    "plot(cos(0:.1:2*pi),sin(0:.1:2*pi"
"))"
		    MaskIconFrame	    off
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "autoscale"
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "Layer 1"
		    Ports		    [1, 1]
		    Position		    [190, 40, 250, 60]
		    BackgroundColor	    "lightBlue"
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    System {
		    Name		    "Layer 1"
		    Location		    [557, 498, 1057, 758]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "p{1}"
		    Position		    [40, 40, 60, 60]
		    BackgroundColor	    "magenta"
		    Port		    "1"
		    LatchInput		    off
		    PortDimensions	    "2"
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "Delays 1"
		    Ports		    [1, 1]
		    Position		    [100, 40, 120, 60]
		    BackgroundColor	    "lightBlue"
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    MaskDisplay		    "disp('TDL')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "autoscale"
		    System {
		    Name		    "Delays 1"
		    Location		    [70, 200, 570, 460]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "p{1}"
		    Position		    [60, 40, 80, 60]
		    Orientation		    "down"
		    BackgroundColor	    "magenta"
		    NamePlacement	    "alternate"
		    Port		    "1"
		    LatchInput		    off
		    PortDimensions	    "2"
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Mux
		    Name		    "mux"
		    Ports		    [1, 1]
		    Position		    [200, 60, 240, 80]
		    BackgroundColor	    "lightBlue"
		    Inputs		    "1"
		    DisplayOption	    "none"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "pd{1,1}"
		    Position		    [300, 60, 320, 80]
		    BackgroundColor	    "magenta"
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "mux"
		    SrcPort		    1
		    DstBlock		    "pd{1,1}"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "p{1}"
		    SrcPort		    1
		    DstBlock		    "mux"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "IW{1,1}"
		    Ports		    [1, 1]
		    Position		    [160, 40, 200, 60]
		    BackgroundColor	    "lightBlue"
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    MaskDisplay		    "disp('weight')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "autoscale"
		    System {
		    Name		    "IW{1,1}"
		    Location		    [74, 196, 574, 456]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "pd{1,1}"
		    Position		    [40, 120, 60, 140]
		    BackgroundColor	    "magenta"
		    Port		    "1"
		    LatchInput		    off
		    PortDimensions	    "2"
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "IW{1,1}(1,:)'"
		    Position		    [140, 40, 180, 60]
		    BackgroundColor	    "lightBlue"
		    Value		    "[-4.5598890000000001;5.793647]"
		    VectorParams1D	    on
		    MaskDisplay		    "disp('weights')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "autoscale"
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "IW{1,1}(2,:)'"
		    Position		    [140, 100, 180, 120]
		    BackgroundColor	    "lightBlue"
		    Value		    "[-2.8283469999999999;1.417519]"
		    VectorParams1D	    on
		    MaskDisplay		    "disp('weights')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "autoscale"
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "IW{1,1}(3,:)'"
		    Position		    [140, 160, 180, 180]
		    BackgroundColor	    "lightBlue"
		    Value		    "[-2.3043559999999998;-1.446742999"
"9999999]"
		    VectorParams1D	    on
		    MaskDisplay		    "disp('weights')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "autoscale"
		    }
		    Block {
		    BlockType		    Mux
		    Name		    "Mux"
		    Ports		    [3, 1]
		    Position		    [340, 120, 380, 140]
		    Inputs		    "3"
		    DisplayOption	    "none"
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "dotprod1"
		    Ports		    [2, 1]
		    Position		    [240, 40, 260, 80]
		    BackgroundColor	    "lightBlue"
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    System {
		    Name		    "dotprod1"
		    Location		    [539, 732, 797, 865]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "w"
		    Position		    [25, 33, 55, 47]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "p"
		    Position		    [25, 78, 55, 92]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "Dot Product"
		    Ports		    [2, 1]
		    Position		    [120, 47, 150, 83]
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    MaskType		    "Dot Product"
		    MaskDescription	    "Inner (dot) product.\ny=sum(u1.*u"
"2)       "
		    MaskHelp		    "Computes the inner (dot) product "
"of the inputs: sum(u1.*u2).  The inputs are vectors of the same length. Outpu"
"t is a scalar."
		    MaskInitialization	    "t=(0:.1:2*pi)';\nx=cos(t);\ny=sin"
"(t);"
		    MaskDisplay		    "plot(0,0,1,1,x*[0.025 0.07]+0.5,y"
"*[0.025 0.07]+0.5)"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "normalized"
		    System {
		    Name		    "Dot Product"
		    Location		    [33, 479, 253, 634]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "in_1"
		    Position		    [15, 25, 35, 45]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "in_2"
		    Position		    [15, 90, 35, 110]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Product
		    Name		    "Product"
		    Ports		    [2, 1]
		    Position		    [65, 55, 90, 75]
		    Inputs		    "2"
		    Multiplication	    "Element-wise(.*)"
		    SaturateOnIntegerOverflow on
		    }
		    Block {
		    BlockType		    Sum
		    Name		    "Sum"
		    Ports		    [1, 1]
		    Position		    [125, 55, 145, 75]
		    IconShape		    "rectangular"
		    Inputs		    "+"
		    SaturateOnIntegerOverflow on
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "out_1"
		    Position		    [185, 55, 205, 75]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "in_2"
		    SrcPort		    1
		    DstBlock		    "Product"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "in_1"
		    SrcPort		    1
		    DstBlock		    "Product"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Product"
		    SrcPort		    1
		    DstBlock		    "Sum"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Sum"
		    SrcPort		    1
		    DstBlock		    "out_1"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "z"
		    Position		    [200, 58, 230, 72]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "w"
		    SrcPort		    1
		    Points		    [45, 0]
		    DstBlock		    "Dot Product"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "p"
		    SrcPort		    1
		    Points		    [45, 0]
		    DstBlock		    "Dot Product"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "Dot Product"
		    SrcPort		    1
		    DstBlock		    "z"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "dotprod2"
		    Ports		    [2, 1]
		    Position		    [240, 100, 260, 140]
		    BackgroundColor	    "lightBlue"
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    System {
		    Name		    "dotprod2"
		    Location		    [539, 732, 797, 865]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "w"
		    Position		    [25, 33, 55, 47]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "p"
		    Position		    [25, 78, 55, 92]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "Dot Product"
		    Ports		    [2, 1]
		    Position		    [120, 47, 150, 83]
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    MaskType		    "Dot Product"
		    MaskDescription	    "Inner (dot) product.\ny=sum(u1.*u"
"2)       "
		    MaskHelp		    "Computes the inner (dot) product "
"of the inputs: sum(u1.*u2).  The inputs are vectors of the same length. Outpu"
"t is a scalar."
		    MaskInitialization	    "t=(0:.1:2*pi)';\nx=cos(t);\ny=sin"
"(t);"
		    MaskDisplay		    "plot(0,0,1,1,x*[0.025 0.07]+0.5,y"
"*[0.025 0.07]+0.5)"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "normalized"
		    System {
		    Name		    "Dot Product"
		    Location		    [33, 479, 253, 634]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "in_1"
		    Position		    [15, 25, 35, 45]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "in_2"
		    Position		    [15, 90, 35, 110]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Product
		    Name		    "Product"
		    Ports		    [2, 1]
		    Position		    [65, 55, 90, 75]
		    Inputs		    "2"
		    Multiplication	    "Element-wise(.*)"
		    SaturateOnIntegerOverflow on
		    }
		    Block {
		    BlockType		    Sum
		    Name		    "Sum"
		    Ports		    [1, 1]
		    Position		    [125, 55, 145, 75]
		    IconShape		    "rectangular"
		    Inputs		    "+"
		    SaturateOnIntegerOverflow on
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "out_1"
		    Position		    [185, 55, 205, 75]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "in_2"
		    SrcPort		    1
		    DstBlock		    "Product"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "in_1"
		    SrcPort		    1
		    DstBlock		    "Product"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Product"
		    SrcPort		    1
		    DstBlock		    "Sum"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Sum"
		    SrcPort		    1
		    DstBlock		    "out_1"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "z"
		    Position		    [200, 58, 230, 72]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "w"
		    SrcPort		    1
		    Points		    [45, 0]
		    DstBlock		    "Dot Product"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "p"
		    SrcPort		    1
		    Points		    [45, 0]
		    DstBlock		    "Dot Product"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "Dot Product"
		    SrcPort		    1
		    DstBlock		    "z"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "dotprod3"
		    Ports		    [2, 1]
		    Position		    [240, 160, 260, 200]
		    BackgroundColor	    "lightBlue"
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    System {
		    Name		    "dotprod3"
		    Location		    [539, 732, 797, 865]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "w"
		    Position		    [25, 33, 55, 47]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "p"
		    Position		    [25, 78, 55, 92]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "Dot Product"
		    Ports		    [2, 1]
		    Position		    [120, 47, 150, 83]
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    MaskType		    "Dot Product"
		    MaskDescription	    "Inner (dot) product.\ny=sum(u1.*u"
"2)       "
		    MaskHelp		    "Computes the inner (dot) product "
"of the inputs: sum(u1.*u2).  The inputs are vectors of the same length. Outpu"
"t is a scalar."
		    MaskInitialization	    "t=(0:.1:2*pi)';\nx=cos(t);\ny=sin"
"(t);"
		    MaskDisplay		    "plot(0,0,1,1,x*[0.025 0.07]+0.5,y"
"*[0.025 0.07]+0.5)"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "normalized"
		    System {
		    Name		    "Dot Product"
		    Location		    [33, 479, 253, 634]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "in_1"
		    Position		    [15, 25, 35, 45]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "in_2"
		    Position		    [15, 90, 35, 110]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Product
		    Name		    "Product"
		    Ports		    [2, 1]
		    Position		    [65, 55, 90, 75]
		    Inputs		    "2"
		    Multiplication	    "Element-wise(.*)"
		    SaturateOnIntegerOverflow on
		    }
		    Block {
		    BlockType		    Sum
		    Name		    "Sum"
		    Ports		    [1, 1]
		    Position		    [125, 55, 145, 75]
		    IconShape		    "rectangular"
		    Inputs		    "+"
		    SaturateOnIntegerOverflow on
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "out_1"
		    Position		    [185, 55, 205, 75]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "in_2"
		    SrcPort		    1
		    DstBlock		    "Product"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "in_1"
		    SrcPort		    1
		    DstBlock		    "Product"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Product"
		    SrcPort		    1
		    DstBlock		    "Sum"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Sum"
		    SrcPort		    1
		    DstBlock		    "out_1"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "z"
		    Position		    [200, 58, 230, 72]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "w"
		    SrcPort		    1
		    Points		    [45, 0]
		    DstBlock		    "Dot Product"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "p"
		    SrcPort		    1
		    Points		    [45, 0]
		    DstBlock		    "Dot Product"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "Dot Product"
		    SrcPort		    1
		    DstBlock		    "z"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "iz{1,1}"
		    Position		    [420, 120, 440, 140]
		    BackgroundColor	    "magenta"
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "Mux"
		    SrcPort		    1
		    DstBlock		    "iz{1,1}"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "dotprod3"
		    SrcPort		    1
		    DstBlock		    "Mux"
		    DstPort		    3
		    }
		    Line {
		    SrcBlock		    "IW{1,1}(3,:)'"
		    SrcPort		    1
		    DstBlock		    "dotprod3"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "dotprod2"
		    SrcPort		    1
		    DstBlock		    "Mux"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "pd{1,1}"
		    SrcPort		    1
		    Points		    [0, 0]
		    Branch {
		    DstBlock		    "dotprod3"
		    DstPort		    2
		    }
		    Branch {
		    DstBlock		    "dotprod2"
		    DstPort		    2
		    }
		    Branch {
		    DstBlock		    "dotprod1"
		    DstPort		    2
		    }
		    }
		    Line {
		    SrcBlock		    "IW{1,1}(2,:)'"
		    SrcPort		    1
		    DstBlock		    "dotprod2"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "dotprod1"
		    SrcPort		    1
		    DstBlock		    "Mux"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "IW{1,1}(1,:)'"
		    SrcPort		    1
		    DstBlock		    "dotprod1"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "b{1}"
		    Position		    [160, 80, 200, 100]
		    BackgroundColor	    "lightBlue"
		    Value		    "[-6.0348629999999996;2.0410720000"
"000002;2.002373]"
		    VectorParams1D	    on
		    MaskDisplay		    "disp('bias')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "autoscale"
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "logsig"
		    Ports		    [1, 1]
		    Position		    [300, 60, 320, 80]
		    BackgroundColor	    "lightBlue"
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    MaskDisplay		    "plot([-1 1],[0 0],[-1 -.9 -.8 -.7"
" -.6 -.5 -.4 -.3 -.2 -.1 0 .1 .2 .3 .4 .5 .6 .7 .8 .9 1],1./(1+exp(-8*[-1 -.9"
" -.8 -.7 -.6 -.5 -.4 -.3 -.2 -.1 0 .1 .2 .3 .4 .5 .6 .7 .8 .9 1]))+.01)"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "autoscale"
		    System {
		    Name		    "logsig"
		    Location		    [260, 574, 703, 704]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "n"
		    Position		    [25, 33, 55, 47]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    ElementaryMath
		    Name		    "Exp"
		    Ports		    [1, 1]
		    Position		    [155, 25, 185, 55]
		    Operator		    "exp"
		    }
		    Block {
		    BlockType		    Gain
		    Name		    "Gain"
		    Position		    [90, 25, 120, 55]
		    Gain		    "-1"
		    Multiplication	    "Element-wise(K.*u)"
		    SaturateOnIntegerOverflow on
		    }
		    Block {
		    BlockType		    ElementaryMath
		    Name		    "Reciprocal"
		    Ports		    [1, 1]
		    Position		    [295, 35, 325, 65]
		    Operator		    "reciprocal"
		    }
		    Block {
		    BlockType		    Sum
		    Name		    "Sum"
		    Ports		    [2, 1]
		    Position		    [225, 32, 255, 63]
		    IconShape		    "rectangular"
		    Inputs		    "++"
		    SaturateOnIntegerOverflow on
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "one"
		    Position		    [155, 75, 175, 95]
		    Value		    "1"
		    VectorParams1D	    on
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "a"
		    Position		    [370, 43, 400, 57]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "n"
		    SrcPort		    1
		    DstBlock		    "Gain"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Gain"
		    SrcPort		    1
		    DstBlock		    "Exp"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Exp"
		    SrcPort		    1
		    DstBlock		    "Sum"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "one"
		    SrcPort		    1
		    Points		    [30, 0]
		    DstBlock		    "Sum"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "Sum"
		    SrcPort		    1
		    DstBlock		    "Reciprocal"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Reciprocal"
		    SrcPort		    1
		    DstBlock		    "a"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    Sum
		    Name		    "netsum"
		    Ports		    [2, 1]
		    Position		    [240, 60, 260, 80]
		    BackgroundColor	    "lightBlue"
		    IconShape		    "rectangular"
		    Inputs		    "2"
		    SaturateOnIntegerOverflow on
		    MaskDisplay		    "disp('+')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "autoscale"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "a{1}"
		    Position		    [360, 60, 380, 80]
		    BackgroundColor	    "magenta"
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "[0;0;0]"
		    }
		    Line {
		    SrcBlock		    "logsig"
		    SrcPort		    1
		    DstBlock		    "a{1}"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "netsum"
		    SrcPort		    1
		    DstBlock		    "logsig"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "b{1}"
		    SrcPort		    1
		    DstBlock		    "netsum"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "IW{1,1}"
		    SrcPort		    1
		    DstBlock		    "netsum"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Delays 1"
		    SrcPort		    1
		    DstBlock		    "IW{1,1}"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "p{1}"
		    SrcPort		    1
		    DstBlock		    "Delays 1"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "Layer 2"
		    Ports		    [1, 1]
		    Position		    [190, 80, 250, 100]
		    BackgroundColor	    "lightBlue"
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    System {
		    Name		    "Layer 2"
		    Location		    [70, 200, 570, 460]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "a{1} "
		    Position		    [40, 40, 60, 60]
		    BackgroundColor	    "magenta"
		    Port		    "1"
		    LatchInput		    off
		    PortDimensions	    "3"
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "Delays 1"
		    Ports		    [1, 1]
		    Position		    [100, 40, 120, 60]
		    BackgroundColor	    "lightBlue"
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    MaskDisplay		    "disp('TDL')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "autoscale"
		    System {
		    Name		    "Delays 1"
		    Location		    [70, 200, 570, 460]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "p{2}"
		    Position		    [60, 40, 80, 60]
		    Orientation		    "down"
		    BackgroundColor	    "magenta"
		    NamePlacement	    "alternate"
		    Port		    "1"
		    LatchInput		    off
		    PortDimensions	    "3"
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Mux
		    Name		    "mux"
		    Ports		    [1, 1]
		    Position		    [200, 60, 240, 80]
		    BackgroundColor	    "lightBlue"
		    Inputs		    "1"
		    DisplayOption	    "none"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "pd{2,1}"
		    Position		    [300, 60, 320, 80]
		    BackgroundColor	    "magenta"
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "mux"
		    SrcPort		    1
		    DstBlock		    "pd{2,1}"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "p{2}"
		    SrcPort		    1
		    DstBlock		    "mux"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "LW{2,1}"
		    Ports		    [1, 1]
		    Position		    [160, 40, 200, 60]
		    BackgroundColor	    "lightBlue"
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    MaskDisplay		    "disp('weight')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "autoscale"
		    System {
		    Name		    "LW{2,1}"
		    Location		    [70, 200, 570, 460]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "ad{2,1}"
		    Position		    [40, 90, 60, 110]
		    BackgroundColor	    "magenta"
		    Port		    "1"
		    LatchInput		    off
		    PortDimensions	    "3"
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "IW{2,1}(1,:)'"
		    Position		    [140, 40, 180, 60]
		    BackgroundColor	    "lightBlue"
		    Value		    "[-0.2776092;-2.6799360000000001;-"
"2.2138360000000001]"
		    VectorParams1D	    on
		    MaskDisplay		    "disp('weights')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "autoscale"
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "IW{2,1}(2,:)'"
		    Position		    [140, 100, 180, 120]
		    BackgroundColor	    "lightBlue"
		    Value		    "[3.601111;2.064257;0.866180799999"
"99997]"
		    VectorParams1D	    on
		    MaskDisplay		    "disp('weights')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "autoscale"
		    }
		    Block {
		    BlockType		    Mux
		    Name		    "Mux"
		    Ports		    [2, 1]
		    Position		    [340, 90, 380, 110]
		    Inputs		    "2"
		    DisplayOption	    "none"
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "dotprod1"
		    Ports		    [2, 1]
		    Position		    [240, 40, 260, 80]
		    BackgroundColor	    "lightBlue"
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    System {
		    Name		    "dotprod1"
		    Location		    [539, 732, 797, 865]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "w"
		    Position		    [25, 33, 55, 47]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "p"
		    Position		    [25, 78, 55, 92]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "Dot Product"
		    Ports		    [2, 1]
		    Position		    [120, 47, 150, 83]
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    MaskType		    "Dot Product"
		    MaskDescription	    "Inner (dot) product.\ny=sum(u1.*u"
"2)       "
		    MaskHelp		    "Computes the inner (dot) product "
"of the inputs: sum(u1.*u2).  The inputs are vectors of the same length. Outpu"
"t is a scalar."
		    MaskInitialization	    "t=(0:.1:2*pi)';\nx=cos(t);\ny=sin"
"(t);"
		    MaskDisplay		    "plot(0,0,1,1,x*[0.025 0.07]+0.5,y"
"*[0.025 0.07]+0.5)"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "normalized"
		    System {
		    Name		    "Dot Product"
		    Location		    [33, 479, 253, 634]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "in_1"
		    Position		    [15, 25, 35, 45]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "in_2"
		    Position		    [15, 90, 35, 110]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Product
		    Name		    "Product"
		    Ports		    [2, 1]
		    Position		    [65, 55, 90, 75]
		    Inputs		    "2"
		    Multiplication	    "Element-wise(.*)"
		    SaturateOnIntegerOverflow on
		    }
		    Block {
		    BlockType		    Sum
		    Name		    "Sum"
		    Ports		    [1, 1]
		    Position		    [125, 55, 145, 75]
		    IconShape		    "rectangular"
		    Inputs		    "+"
		    SaturateOnIntegerOverflow on
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "out_1"
		    Position		    [185, 55, 205, 75]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "in_2"
		    SrcPort		    1
		    DstBlock		    "Product"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "in_1"
		    SrcPort		    1
		    DstBlock		    "Product"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Product"
		    SrcPort		    1
		    DstBlock		    "Sum"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Sum"
		    SrcPort		    1
		    DstBlock		    "out_1"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "z"
		    Position		    [200, 58, 230, 72]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "w"
		    SrcPort		    1
		    Points		    [45, 0]
		    DstBlock		    "Dot Product"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "p"
		    SrcPort		    1
		    Points		    [45, 0]
		    DstBlock		    "Dot Product"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "Dot Product"
		    SrcPort		    1
		    DstBlock		    "z"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "dotprod2"
		    Ports		    [2, 1]
		    Position		    [240, 100, 260, 140]
		    BackgroundColor	    "lightBlue"
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    System {
		    Name		    "dotprod2"
		    Location		    [539, 732, 797, 865]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "w"
		    Position		    [25, 33, 55, 47]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "p"
		    Position		    [25, 78, 55, 92]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "Dot Product"
		    Ports		    [2, 1]
		    Position		    [120, 47, 150, 83]
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    MaskType		    "Dot Product"
		    MaskDescription	    "Inner (dot) product.\ny=sum(u1.*u"
"2)       "
		    MaskHelp		    "Computes the inner (dot) product "
"of the inputs: sum(u1.*u2).  The inputs are vectors of the same length. Outpu"
"t is a scalar."
		    MaskInitialization	    "t=(0:.1:2*pi)';\nx=cos(t);\ny=sin"
"(t);"
		    MaskDisplay		    "plot(0,0,1,1,x*[0.025 0.07]+0.5,y"
"*[0.025 0.07]+0.5)"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "normalized"
		    System {
		    Name		    "Dot Product"
		    Location		    [33, 479, 253, 634]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "in_1"
		    Position		    [15, 25, 35, 45]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Inport
		    Name		    "in_2"
		    Position		    [15, 90, 35, 110]
		    Port		    "2"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Product
		    Name		    "Product"
		    Ports		    [2, 1]
		    Position		    [65, 55, 90, 75]
		    Inputs		    "2"
		    Multiplication	    "Element-wise(.*)"
		    SaturateOnIntegerOverflow on
		    }
		    Block {
		    BlockType		    Sum
		    Name		    "Sum"
		    Ports		    [1, 1]
		    Position		    [125, 55, 145, 75]
		    IconShape		    "rectangular"
		    Inputs		    "+"
		    SaturateOnIntegerOverflow on
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "out_1"
		    Position		    [185, 55, 205, 75]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "in_2"
		    SrcPort		    1
		    DstBlock		    "Product"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "in_1"
		    SrcPort		    1
		    DstBlock		    "Product"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Product"
		    SrcPort		    1
		    DstBlock		    "Sum"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Sum"
		    SrcPort		    1
		    DstBlock		    "out_1"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "z"
		    Position		    [200, 58, 230, 72]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "w"
		    SrcPort		    1
		    Points		    [45, 0]
		    DstBlock		    "Dot Product"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "p"
		    SrcPort		    1
		    Points		    [45, 0]
		    DstBlock		    "Dot Product"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "Dot Product"
		    SrcPort		    1
		    DstBlock		    "z"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "lz{2,1}"
		    Position		    [420, 90, 440, 110]
		    BackgroundColor	    "magenta"
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "Mux"
		    SrcPort		    1
		    DstBlock		    "lz{2,1}"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "dotprod2"
		    SrcPort		    1
		    DstBlock		    "Mux"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "ad{2,1}"
		    SrcPort		    1
		    Points		    [0, 0]
		    Branch {
		    DstBlock		    "dotprod2"
		    DstPort		    2
		    }
		    Branch {
		    DstBlock		    "dotprod1"
		    DstPort		    2
		    }
		    }
		    Line {
		    SrcBlock		    "IW{2,1}(2,:)'"
		    SrcPort		    1
		    DstBlock		    "dotprod2"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "dotprod1"
		    SrcPort		    1
		    DstBlock		    "Mux"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "IW{2,1}(1,:)'"
		    SrcPort		    1
		    DstBlock		    "dotprod1"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "b{2}"
		    Position		    [160, 80, 200, 100]
		    BackgroundColor	    "lightBlue"
		    Value		    "[3.0652170000000001;-2.2814760000"
"000001]"
		    VectorParams1D	    on
		    MaskDisplay		    "disp('bias')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "autoscale"
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "logsig"
		    Ports		    [1, 1]
		    Position		    [300, 60, 320, 80]
		    BackgroundColor	    "lightBlue"
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    MaskDisplay		    "plot([-1 1],[0 0],[-1 -.9 -.8 -.7"
" -.6 -.5 -.4 -.3 -.2 -.1 0 .1 .2 .3 .4 .5 .6 .7 .8 .9 1],1./(1+exp(-8*[-1 -.9"
" -.8 -.7 -.6 -.5 -.4 -.3 -.2 -.1 0 .1 .2 .3 .4 .5 .6 .7 .8 .9 1]))+.01)"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "autoscale"
		    System {
		    Name		    "logsig"
		    Location		    [260, 574, 703, 704]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "n"
		    Position		    [25, 33, 55, 47]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    ElementaryMath
		    Name		    "Exp"
		    Ports		    [1, 1]
		    Position		    [155, 25, 185, 55]
		    Operator		    "exp"
		    }
		    Block {
		    BlockType		    Gain
		    Name		    "Gain"
		    Position		    [90, 25, 120, 55]
		    Gain		    "-1"
		    Multiplication	    "Element-wise(K.*u)"
		    SaturateOnIntegerOverflow on
		    }
		    Block {
		    BlockType		    ElementaryMath
		    Name		    "Reciprocal"
		    Ports		    [1, 1]
		    Position		    [295, 35, 325, 65]
		    Operator		    "reciprocal"
		    }
		    Block {
		    BlockType		    Sum
		    Name		    "Sum"
		    Ports		    [2, 1]
		    Position		    [225, 32, 255, 63]
		    IconShape		    "rectangular"
		    Inputs		    "++"
		    SaturateOnIntegerOverflow on
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "one"
		    Position		    [155, 75, 175, 95]
		    Value		    "1"
		    VectorParams1D	    on
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "a"
		    Position		    [370, 43, 400, 57]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "0"
		    }
		    Line {
		    SrcBlock		    "n"
		    SrcPort		    1
		    DstBlock		    "Gain"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Gain"
		    SrcPort		    1
		    DstBlock		    "Exp"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Exp"
		    SrcPort		    1
		    DstBlock		    "Sum"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "one"
		    SrcPort		    1
		    Points		    [30, 0]
		    DstBlock		    "Sum"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "Sum"
		    SrcPort		    1
		    DstBlock		    "Reciprocal"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Reciprocal"
		    SrcPort		    1
		    DstBlock		    "a"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    Sum
		    Name		    "netsum"
		    Ports		    [2, 1]
		    Position		    [240, 60, 260, 80]
		    BackgroundColor	    "lightBlue"
		    IconShape		    "rectangular"
		    Inputs		    "2"
		    SaturateOnIntegerOverflow on
		    MaskDisplay		    "disp('+')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "autoscale"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "a{2}"
		    Position		    [360, 60, 380, 80]
		    BackgroundColor	    "magenta"
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "[0;0]"
		    }
		    Line {
		    SrcBlock		    "logsig"
		    SrcPort		    1
		    DstBlock		    "a{2}"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "netsum"
		    SrcPort		    1
		    DstBlock		    "logsig"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "b{2}"
		    SrcPort		    1
		    DstBlock		    "netsum"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "LW{2,1}"
		    SrcPort		    1
		    DstBlock		    "netsum"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Delays 1"
		    SrcPort		    1
		    DstBlock		    "LW{2,1}"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "a{1} "
		    SrcPort		    1
		    DstBlock		    "Delays 1"
		    DstPort		    1
		    }
		    }
		    }
		    Block {
		    BlockType		    Goto
		    Name		    "a{1}"
		    Position		    [380, 40, 400, 60]
		    GotoTag		    "feedback1"
		    TagVisibility	    "local"
		    MaskDisplay		    "plot(cos(0:.1:2*pi),sin(0:.1:2*pi"
"))"
		    MaskIconFrame	    off
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "autoscale"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "y{1}"
		    Position		    [380, 120, 400, 140]
		    BackgroundColor	    "magenta"
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "[0;0]"
		    }
		    Line {
		    SrcBlock		    "Layer 2"
		    SrcPort		    1
		    DstBlock		    "y{1}"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    " a{1} "
		    SrcPort		    1
		    DstBlock		    "Layer 2"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Layer 1"
		    SrcPort		    1
		    DstBlock		    "a{1}"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "p{1}"
		    SrcPort		    1
		    DstBlock		    "Layer 1"
		    DstPort		    1
		    }
		  }
		}
		Block {
		  BlockType		  Fcn
		  Name			  "Normalizer\nPower"
		  Position		  [85, 55, 145, 85]
		  Expr			  "(u-ess_MMi(1,1))/(ess_MMi(1,2)-ess_"
"MMi(1,1))"
		}
		Block {
		  BlockType		  Fcn
		  Name			  "Normalizer\nSOC"
		  Position		  [85, 155, 145, 185]
		  Expr			  "(u-ess_MMi(2,1))/(ess_MMi(2,2)-ess_"
"MMi(2,1))"
		}
		Block {
		  BlockType		  Outport
		  Name			  "V"
		  Position		  [460, 160, 480, 180]
		  FontName		  "Arial"
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Block {
		  BlockType		  Outport
		  Name			  "i"
		  Position		  [450, 60, 470, 80]
		  FontName		  "Arial"
		  Port			  "2"
		  OutputWhenDisabled	  "reset"
		  InitialOutput		  "0"
		}
		Line {
		  SrcBlock		  "De-Normalizer1\nVoltage"
		  SrcPort		  1
		  DstBlock		  "V"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Demux"
		  SrcPort		  2
		  Points		  [0, 35]
		  DstBlock		  "De-Normalizer1\nVoltage"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Demux"
		  SrcPort		  1
		  Points		  [0, -45]
		  DstBlock		  "De-Normalizer2\nCurrent"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "De-Normalizer2\nCurrent"
		  SrcPort		  1
		  DstBlock		  "i"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Normalizer\nSOC"
		  SrcPort		  1
		  Points		  [0, -35]
		  DstBlock		  "Mux"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "SOC"
		  SrcPort		  1
		  DstBlock		  "Normalizer\nSOC"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Normalizer\nPower"
		  SrcPort		  1
		  Points		  [0, 45]
		  DstBlock		  "Mux"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Preq"
		  SrcPort		  1
		  DstBlock		  "Normalizer\nPower"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Neural Network"
		  SrcPort		  1
		  DstBlock		  "Demux"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Mux"
		  SrcPort		  1
		  DstBlock		  "Neural Network"
		  DstPort		  1
		}
	      }
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "No Thermal\nmodel"
	      Ports		      []
	      Position		      [775, 390, 805, 470]
	      FontName		      "Arial"
	      ShowPortLabels	      off
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"No Thermal\nmodel"
		Location		[78, 108, 387, 310]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Constant
		  Name			  "Const1"
		  Position		  [80, 45, 100, 65]
		  ShowName		  off
		  FontName		  "Arial"
		  Value			  "0"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Constant
		  Name			  "Const2"
		  Position		  [55, 75, 110, 95]
		  ShowName		  off
		  FontName		  "Arial"
		  Value			  "amb_tmp"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Constant
		  Name			  "Const3"
		  Position		  [85, 115, 105, 135]
		  ShowName		  off
		  FontName		  "Arial"
		  Value			  "0"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  ToWorkspace
		  Name			  "To WS1"
		  Position		  [125, 47, 205, 63]
		  NamePlacement		  "alternate"
		  ShowName		  off
		  FontName		  "Arial"
		  VariableName		  "ess_pwr_loss_a"
		  MaxDataPoints		  "inf"
		  Decimation		  "1"
		  SampleTime		  "0"
		  SaveFormat		  "Array"
		}
		Block {
		  BlockType		  ToWorkspace
		  Name			  "To WS2"
		  Position		  [130, 78, 200, 92]
		  ShowName		  off
		  FontName		  "Arial"
		  VariableName		  "ess_mod_tmp"
		  MaxDataPoints		  "inf"
		  Decimation		  "1"
		  SampleTime		  "0"
		  SaveFormat		  "Array"
		}
		Block {
		  BlockType		  ToWorkspace
		  Name			  "To WS3"
		  Position		  [130, 98, 200, 112]
		  ShowName		  off
		  FontName		  "Arial"
		  VariableName		  "ess_air_tmp"
		  MaxDataPoints		  "inf"
		  Decimation		  "1"
		  SampleTime		  "0"
		  SaveFormat		  "Array"
		}
		Block {
		  BlockType		  ToWorkspace
		  Name			  "To WS4"
		  Position		  [130, 119, 205, 131]
		  ShowName		  off
		  FontName		  "Arial"
		  VariableName		  "ess_air_th_pwr"
		  MaxDataPoints		  "inf"
		  Decimation		  "1"
		  SampleTime		  "0"
		  SaveFormat		  "Array"
		}
		Line {
		  SrcBlock		  "Const3"
		  SrcPort		  1
		  DstBlock		  "To WS4"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Const2"
		  SrcPort		  1
		  Points		  [0, 0]
		  Branch {
		    DstBlock		    "To WS3"
		    DstPort		    1
		  }
		  Branch {
		    DstBlock		    "To WS2"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "Const1"
		  SrcPort		  1
		  DstBlock		  "To WS1"
		  DstPort		  1
		}
	      }
	    }
	    Block {
	      BlockType		      Product
	      Name		      "Pout"
	      Ports		      [2, 1]
	      Position		      [560, 268, 590, 292]
	      Inputs		      "2"
	      Multiplication	      "Element-wise(.*)"
	      SaturateOnIntegerOverflow	on
	    }
	    Block {
	      BlockType		      Switch
	      Name		      "Preq=0\ncondition"
	      Position		      [845, 95, 875, 125]
	      Threshold		      "eps"
	    }
	    Block {
	      BlockType		      RelationalOperator
	      Name		      "Relational\nOperator"
	      Position		      [330, 92, 360, 123]
	      ShowName		      off
	      Operator		      "=="
	    }
	    Block {
	      BlockType		      RelationalOperator
	      Name		      "Relational\nOperator1"
	      Position		      [440, 342, 470, 373]
	      ShowName		      off
	      Operator		      "=="
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "SOC\nalgorithm"
	      Ports		      [2, 1]
	      Position		      [365, 376, 395, 409]
	      Orientation	      "left"
	      FontName		      "Arial"
	      ShowPortLabels	      off
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"SOC\nalgorithm"
		Location		[427, 629, 1207, 901]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "(A)"
		  Position		  [15, 35, 35, 55]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "tmp\n(C)"
		  Position		  [20, 125, 40, 145]
		  Port			  "2"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Gain
		  Name			  "(sec->hrs)"
		  Position		  [265, 43, 330, 77]
		  Gain			  "1/3600"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Saturate
		  Name			  "0 <= SOC <= 1"
		  Position		  [650, 121, 680, 139]
		  UpperLimit		  "1"
		  LowerLimit		  "0"
		  LinearizeAsGain	  on
		}
		Block {
		  BlockType		  Sum
		  Name			  "A-h\nremaining"
		  Ports			  [2, 1]
		  Position		  [505, 85, 525, 105]
		  IconShape		  "rectangular"
		  Inputs		  "-+"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Integrator
		  Name			  "Ah used"
		  Ports			  [2, 1]
		  Position		  [425, 50, 445, 70]
		  ExternalReset		  "none"
		  InitialConditionSource  "external"
		  InitialCondition	  "(1-ess_init_soc)*ess_max_ah_cap"
		  LimitOutput		  off
		  UpperSaturationLimit	  "inf"
		  LowerSaturationLimit	  "-inf"
		  ShowSaturationPort	  off
		  ShowStatePort		  off
		  AbsoluteTolerance	  "auto"
		}
		Block {
		  BlockType		  Fcn
		  Name			  "Fcn"
		  Position		  [500, 150, 540, 170]
		  ShowName		  off
		  Expr			  "1/u"
		}
		Block {
		  BlockType		  Fcn
		  Name			  "Fcn1"
		  Position		  [285, 96, 385, 114]
		  ShowName		  off
		  Expr			  "(1-ess_init_soc)*u"
		}
		Block {
		  BlockType		  Product
		  Name			  "SOC"
		  Ports			  [2, 1]
		  Position		  [580, 118, 610, 142]
		  Inputs		  "2"
		  Multiplication	  "Element-wise(.*)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Switch
		  Name			  "Switch"
		  Position		  [205, 35, 235, 85]
		  ShowName		  off
		  Threshold		  "0"
		}
		Block {
		  BlockType		  Product
		  Name			  "adjusted A"
		  Ports			  [2, 1]
		  Position		  [135, 63, 165, 87]
		  Inputs		  "2"
		  Multiplication	  "Element-wise(.*)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Lookup
		  Name			  "coul eff"
		  Position		  [75, 88, 105, 112]
		  InputValues		  "ess_tmp"
		  OutputValues		  "ess_coulombic_eff"
		}
		Block {
		  BlockType		  Lookup
		  Name			  "max cap"
		  Position		  [200, 128, 230, 152]
		  InputValues		  "ess_tmp"
		  OutputValues		  "ess_max_ah_cap"
		}
		Block {
		  BlockType		  Outport
		  Name			  "SOC1"
		  Position		  [720, 120, 740, 140]
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Line {
		  SrcBlock		  "Fcn1"
		  SrcPort		  1
		  Points		  [20, 0]
		  DstBlock		  "Ah used"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "max cap"
		  SrcPort		  1
		  Points		  [30, 0]
		  Branch {
		    Points		    [0, -35]
		    DstBlock		    "Fcn1"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [170, 0; 0, -30; 50, 0]
		    Branch {
		    DstBlock		    "Fcn"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [5, 0]
		    DstBlock		    "A-h\nremaining"
		    DstPort		    2
		    }
		  }
		}
		Line {
		  SrcBlock		  "adjusted A"
		  SrcPort		  1
		  DstBlock		  "Switch"
		  DstPort		  3
		}
		Line {
		  SrcBlock		  "coul eff"
		  SrcPort		  1
		  Points		  [10, 0]
		  DstBlock		  "adjusted A"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "tmp\n(C)"
		  SrcPort		  1
		  Points		  [15, 0]
		  Branch {
		    DstBlock		    "coul eff"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [125, 0]
		    DstBlock		    "max cap"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "0 <= SOC <= 1"
		  SrcPort		  1
		  DstBlock		  "SOC1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "A-h\nremaining"
		  SrcPort		  1
		  Points		  [35, 0]
		  DstBlock		  "SOC"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "SOC"
		  SrcPort		  1
		  DstBlock		  "0 <= SOC <= 1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Fcn"
		  SrcPort		  1
		  Points		  [20, 0]
		  DstBlock		  "SOC"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Ah used"
		  SrcPort		  1
		  Points		  [40, 0]
		  DstBlock		  "A-h\nremaining"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "(sec->hrs)"
		  SrcPort		  1
		  Points		  [75, 0]
		  DstBlock		  "Ah used"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Switch"
		  SrcPort		  1
		  DstBlock		  "(sec->hrs)"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "(A)"
		  SrcPort		  1
		  Points		  [5, 0]
		  Branch {
		    Points		    [0, 25]
		    DstBlock		    "adjusted A"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [130, 0]
		    Branch {
		    DstBlock		    "Switch"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [0, 15]
		    DstBlock		    "Switch"
		    DstPort		    2
		    }
		  }
		}
		Annotation {
		  Position		  [533, 207]
		  Text			  "SOC=(Max Ah capacity-Ah used)/Max A"
"h capacity"
		}
	      }
	    }
	    Block {
	      BlockType		      Switch
	      Name		      "SOC=0\n->i=0"
	      Position		      [490, 305, 520, 335]
	      Threshold		      "eps"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To Workspace10"
	      Position		      [570, 374, 645, 396]
	      VariableName	      "ess_current"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "-1"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To Workspace11"
	      Position		      [710, 164, 785, 186]
	      VariableName	      "ess_volt"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "-1"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To Workspace8"
	      Position		      [40, 225, 110, 245]
	      Orientation	      "left"
	      VariableName	      "ess_pwr_out_r"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "-1"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To Workspace9"
	      Position		      [955, 179, 1030, 201]
	      VariableName	      "ess_pwr_out_a"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "-1"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "max pack\npwr (W)"
	      Ports		      [1, 1]
	      Position		      [355, 505, 385, 535]
	      ShowPortLabels	      off
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"max pack\npwr (W)"
		Location		[502, 536, 957, 673]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "SOC"
		  Position		  [35, 43, 65, 57]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Gain
		  Name			  "# batteries"
		  Position		  [245, 35, 295, 65]
		  Gain			  "ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Lookup
		  Name			  "max power"
		  Position		  [165, 35, 195, 65]
		  InputValues		  "ess_max_p_soc"
		  OutputValues		  "ess_max_p"
		}
		Block {
		  BlockType		  Outport
		  Name			  "ess\ndischarge\npwr"
		  Position		  [355, 40, 375, 60]
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Line {
		  SrcBlock		  "# batteries"
		  SrcPort		  1
		  DstBlock		  "ess\ndischarge\npwr"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "max power"
		  SrcPort		  1
		  DstBlock		  "# batteries"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "SOC"
		  SrcPort		  1
		  DstBlock		  "max power"
		  DstPort		  1
		}
	      }
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "stop sim"
	      Ports		      [1, 0, 1]
	      Position		      [215, 379, 275, 411]
	      Orientation	      "left"
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      on
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"stop sim"
		Location		[423, 258, 819, 468]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "SOC"
		  Position		  [75, 85, 95, 105]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  EnablePort
		  Name			  "Enable"
		  Ports			  []
		  Position		  [170, 25, 190, 45]
		  StatesWhenEnabling	  "held"
		  ShowOutputPort	  off
		}
		Block {
		  BlockType		  Constant
		  Name			  "Const"
		  Position		  [95, 145, 165, 165]
		  Orientation		  "up"
		  ShowName		  off
		  FontName		  "Arial"
		  Value			  ".001"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  RelationalOperator
		  Name			  "Relational\nOperator"
		  Position		  [185, 88, 215, 112]
		  Operator		  "<"
		}
		Block {
		  BlockType		  Stop
		  Name			  "Stop Simulation"
		  Position		  [255, 83, 295, 117]
		}
		Line {
		  SrcBlock		  "Relational\nOperator"
		  SrcPort		  1
		  DstBlock		  "Stop Simulation"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "SOC"
		  SrcPort		  1
		  DstBlock		  "Relational\nOperator"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Const"
		  SrcPort		  1
		  Points		  [0, -35]
		  DstBlock		  "Relational\nOperator"
		  DstPort		  2
		}
	      }
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "power available\nto bus (W)"
	      Position		      [980, 100, 1000, 120]
	      FontName		      "Arial"
	      Port		      "1"
	      OutputWhenDisabled      "held"
	      InitialOutput	      "0"
	    }
	    Line {
	      SrcBlock		      "SOC=0\n->i=0"
	      SrcPort		      1
	      Points		      [5, 0]
	      Branch {
		Points			[0, -35]
		DstBlock		"Pout"
		DstPort			2
	      }
	      Branch {
		Points			[0, 65]
		Branch {
		  DstBlock		  "To Workspace10"
		  DstPort		  1
		}
		Branch {
		  DstBlock		  "SOC\nalgorithm"
		  DstPort		  1
		}
	      }
	    }
	    Line {
	      SrcBlock		      "Relational\nOperator1"
	      SrcPort		      1
	      DstBlock		      "SOC=0\n->i=0"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Const5"
	      SrcPort		      1
	      DstBlock		      "Relational\nOperator1"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "NNet"
	      SrcPort		      2
	      Points		      [10, 0; 0, 30]
	      DstBlock		      "SOC=0\n->i=0"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "Const6"
	      SrcPort		      1
	      DstBlock		      "SOC=0\n->i=0"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Const2"
	      SrcPort		      1
	      Points		      [-160, 0]
	      DstBlock		      "SOC\nalgorithm"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Preq=0\ncondition"
	      SrcPort		      1
	      Points		      [25, 0]
	      Branch {
		Points			[0, -35]
		DstBlock		"Limits"
		DstPort			2
	      }
	      Branch {
		Points			[10, 0]
		Branch {
		  Points		  [0, 80]
		  DstBlock		  "To Workspace9"
		  DstPort		  1
		}
		Branch {
		  DstBlock		  "power available\nto bus (W)"
		  DstPort		  1
		}
	      }
	    }
	    Line {
	      SrcBlock		      "# batteries1"
	      SrcPort		      1
	      Points		      [130, 0]
	      DstBlock		      "Preq=0\ncondition"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "# batteries2"
	      SrcPort		      1
	      Points		      [0, 0]
	      Branch {
		Points			[0, -45]
		DstBlock		"To Workspace11"
		DstPort			1
	      }
	      Branch {
		DstBlock		"Goto <mc>, <gc>, <sdo>"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "NNet"
	      SrcPort		      1
	      Points		      [125, 0]
	      Branch {
		Points			[0, -40]
		DstBlock		"# batteries2"
		DstPort			1
	      }
	      Branch {
		DstBlock		"Pout"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Pout"
	      SrcPort		      1
	      DstBlock		      "# batteries1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "max pack\npwr (W)"
	      SrcPort		      1
	      DstBlock		      "Goto <cs>1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Relational\nOperator"
	      SrcPort		      1
	      Points		      [20, 0]
	      Branch {
		DstBlock		"Logical\nOperator"
		DstPort			1
	      }
	      Branch {
		DstBlock		"Preq=0\ncondition"
		DstPort			2
	      }
	    }
	    Line {
	      SrcBlock		      "Logical\nOperator"
	      SrcPort		      1
	      DstBlock		      "NNet"
	      DstPort		      enable
	    }
	    Line {
	      SrcBlock		      "Const4"
	      SrcPort		      1
	      DstBlock		      "Relational\nOperator"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "1/# batteries"
	      SrcPort		      1
	      DstBlock		      "NNet"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "power req'd\ninto bus (W)"
	      SrcPort		      1
	      Points		      [15, 0]
	      Branch {
		Points			[15, 0]
		Branch {
		  Points		  [0, -170; 150, 0]
		  Branch {
		    Points		    [0, -30; 515, 0]
		    Branch {
		    Points		    [0, -25]
		    DstBlock		    "Limits"
		    DstPort		    1
		    }
		    Branch {
		    DstBlock		    "Preq=0\ncondition"
		    DstPort		    1
		    }
		  }
		  Branch {
		    DstBlock		    "Relational\nOperator"
		    DstPort		    1
		  }
		}
		Branch {
		  DstBlock		  "1/# batteries"
		  DstPort		  1
		}
	      }
	      Branch {
		Points			[0, -25]
		DstBlock		"To Workspace8"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "SOC\nalgorithm"
	      SrcPort		      1
	      Points		      [-15, 0]
	      Branch {
		Points			[0, -45]
		Branch {
		  DstBlock		  "Relational\nOperator1"
		  DstPort		  1
		}
		Branch {
		  DstBlock		  "NNet"
		  DstPort		  2
		}
	      }
	      Branch {
		Points			[-30, 0]
		Branch {
		  Points		  [0, 65]
		  Branch {
		    Points		    [0, 60]
		    DstBlock		    "max pack\npwr (W)"
		    DstPort		    1
		  }
		  Branch {
		    DstBlock		    "Goto <sdo>, <cs>"
		    DstPort		    1
		  }
		}
		Branch {
		  DstBlock		  "stop sim"
		  DstPort		  1
		}
	      }
	    }
	    Line {
	      SrcBlock		      "Const"
	      SrcPort		      1
	      DstBlock		      "stop sim"
	      DstPort		      enable
	    }
	  }
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "energy storage <ess>\nSaber"
	  Ports			  [1, 1]
	  Position		  [105, 488, 170, 532]
	  ForegroundColor	  "magenta"
	  ShowPortLabels	  off
	  TreatAsAtomicUnit	  off
	  RTWSystemCode		  "Auto"
	  RTWFcnNameOpts	  "Auto"
	  RTWFileNameOpts	  "Auto"
	  MaskDisplay		  "image(imread('bdi_ess.jpg'))"
	  MaskIconFrame		  on
	  MaskIconOpaque	  on
	  MaskIconRotate	  "none"
	  MaskIconUnits		  "autoscale"
	  System {
	    Name		    "energy storage <ess>\nSaber"
	    Location		    [223, 98, 1135, 874]
	    Open		    off
	    ModelBrowserVisibility  off
	    ModelBrowserWidth	    200
	    ScreenColor		    "white"
	    PaperOrientation	    "landscape"
	    PaperPositionMode	    "auto"
	    PaperType		    "usletter"
	    PaperUnits		    "inches"
	    ZoomFactor		    "100"
	    Block {
	      BlockType		      Inport
	      Name		      "power req'd\ninto bus (W)"
	      Position		      [15, 35, 35, 55]
	      FontName		      "Arial"
	      Port		      "1"
	      LatchInput	      off
	      Interpolate	      on
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Block NOTES"
	      Ports		      []
	      Position		      [875, 230, 931, 270]
	      BackgroundColor	      "green"
	      ShowName		      off
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      MaskDisplay	      "disp('Block\\nNOTES')"
	      MaskIconFrame	      on
	      MaskIconOpaque	      on
	      MaskIconRotate	      "none"
	      MaskIconUnits	      "autoscale"
	      System {
		Name			"Block NOTES"
		Location		[64, 843, 576, 1017]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Annotation {
		  Position		  [256, 77]
		  Text			  "Saber co-simulation\n"
		}
	      }
	    }
	    Block {
	      BlockType		      Demux
	      Name		      "Demux"
	      Ports		      [1, 5]
	      Position		      [505, 106, 515, 184]
	      BackgroundColor	      "black"
	      ShowName		      off
	      Outputs		      "[1 10 10 10 10]"
	      BusSelectionMode	      off
	    }
	    Block {
	      BlockType		      Demux
	      Name		      "Demux1"
	      Ports		      [1, 10]
	      Position		      [75, 270, 80, 315]
	      BackgroundColor	      "black"
	      ShowName		      off
	      Outputs		      "10"
	      BusSelectionMode	      off
	    }
	    Block {
	      BlockType		      Demux
	      Name		      "Demux10"
	      Ports		      [1, 10]
	      Position		      [60, 620, 65, 665]
	      BackgroundColor	      "black"
	      ShowName		      off
	      Outputs		      "10"
	      BusSelectionMode	      off
	    }
	    Block {
	      BlockType		      Demux
	      Name		      "Demux11"
	      Ports		      [1, 10]
	      Position		      [170, 515, 175, 560]
	      BackgroundColor	      "black"
	      ShowName		      off
	      Outputs		      "10"
	      BusSelectionMode	      off
	    }
	    Block {
	      BlockType		      Demux
	      Name		      "Demux12"
	      Ports		      [1, 10]
	      Position		      [170, 585, 175, 630]
	      BackgroundColor	      "black"
	      ShowName		      off
	      Outputs		      "10"
	      BusSelectionMode	      off
	    }
	    Block {
	      BlockType		      Demux
	      Name		      "Demux13"
	      Ports		      [1, 10]
	      Position		      [170, 655, 175, 700]
	      BackgroundColor	      "black"
	      ShowName		      off
	      Outputs		      "10"
	      BusSelectionMode	      off
	    }
	    Block {
	      BlockType		      Demux
	      Name		      "Demux2"
	      Ports		      [1, 10]
	      Position		      [170, 305, 175, 350]
	      BackgroundColor	      "black"
	      ShowName		      off
	      Outputs		      "10"
	      BusSelectionMode	      off
	    }
	    Block {
	      BlockType		      Demux
	      Name		      "Demux3"
	      Ports		      [1, 10]
	      Position		      [65, 340, 70, 385]
	      BackgroundColor	      "black"
	      ShowName		      off
	      Outputs		      "10"
	      BusSelectionMode	      off
	    }
	    Block {
	      BlockType		      Demux
	      Name		      "Demux4"
	      Ports		      [1, 10]
	      Position		      [170, 375, 175, 420]
	      BackgroundColor	      "black"
	      ShowName		      off
	      Outputs		      "10"
	      BusSelectionMode	      off
	    }
	    Block {
	      BlockType		      Demux
	      Name		      "Demux5"
	      Ports		      [1, 10]
	      Position		      [65, 410, 70, 455]
	      BackgroundColor	      "black"
	      ShowName		      off
	      Outputs		      "10"
	      BusSelectionMode	      off
	    }
	    Block {
	      BlockType		      Demux
	      Name		      "Demux6"
	      Ports		      [1, 10]
	      Position		      [170, 445, 175, 490]
	      BackgroundColor	      "black"
	      ShowName		      off
	      Outputs		      "10"
	      BusSelectionMode	      off
	    }
	    Block {
	      BlockType		      Demux
	      Name		      "Demux8"
	      Ports		      [1, 10]
	      Position		      [65, 480, 70, 525]
	      BackgroundColor	      "black"
	      ShowName		      off
	      Outputs		      "10"
	      BusSelectionMode	      off
	    }
	    Block {
	      BlockType		      Demux
	      Name		      "Demux9"
	      Ports		      [1, 10]
	      Position		      [70, 550, 75, 595]
	      BackgroundColor	      "black"
	      ShowName		      off
	      Outputs		      "10"
	      BusSelectionMode	      off
	    }
	    Block {
	      BlockType		      "S-Function"
	      Name		      "Matrix\nConcatenation1"
	      Ports		      [17, 1]
	      Position		      [240, 111, 330, 689]
	      ShowName		      off
	      FunctionName	      "smatrxcat"
	      Parameters	      "numInports,catMethod"
	      PortCounts	      "[]"
	      SFunctionModules	      "''"
	      MaskType		      "Matrix Concatenation"
	      MaskDescription	      "Perform horizontal or vertical concaten"
"ation.  1-D vector input signals are treated as column vectors, i.e., [Mx1] m"
"atrices.  The output is always a matrix."
	      MaskPromptString	      "Number of inputs:|Concatenation method:"
	      MaskStyleString	      "edit,popup(Horizontal|Vertical)"
	      MaskTunableValueString  "on,on"
	      MaskCallbackString      "|"
	      MaskEnableString	      "on,on"
	      MaskVisibilityString    "on,on"
	      MaskToolTipString	      "on,on"
	      MaskVariables	      "numInports=@1;catMethod=@2;"
	      MaskInitialization      "xy = matrxcatmask('icon');"
	      MaskDisplay	      "plot(xy.x,xy.y);\ntext(0.15,0.86,xy.lab"
"el);\n"
	      MaskSelfModifiable      on
	      MaskIconFrame	      on
	      MaskIconOpaque	      on
	      MaskIconRotate	      "none"
	      MaskIconUnits	      "normalized"
	      MaskValueString	      "17|Horizontal"
	      MaskVariableAliases     ","
	    }
	    Block {
	      BlockType		      Reference
	      Name		      "Matrix\nConcatenation10"
	      Ports		      [10, 1]
	      Position		      [90, 550, 105, 595]
	      ShowName		      off
	      SourceBlock	      "simulink3/Signals\n& Systems/Matrix\nCo"
"ncatenation"
	      SourceType	      "Matrix Concatenation"
	      numInports	      "10"
	      catMethod		      "Horizontal"
	    }
	    Block {
	      BlockType		      Reference
	      Name		      "Matrix\nConcatenation11"
	      Ports		      [10, 1]
	      Position		      [80, 620, 95, 665]
	      ShowName		      off
	      SourceBlock	      "simulink3/Signals\n& Systems/Matrix\nCo"
"ncatenation"
	      SourceType	      "Matrix Concatenation"
	      numInports	      "10"
	      catMethod		      "Horizontal"
	    }
	    Block {
	      BlockType		      Reference
	      Name		      "Matrix\nConcatenation12"
	      Ports		      [10, 1]
	      Position		      [190, 515, 205, 560]
	      ShowName		      off
	      SourceBlock	      "simulink3/Signals\n& Systems/Matrix\nCo"
"ncatenation"
	      SourceType	      "Matrix Concatenation"
	      numInports	      "10"
	      catMethod		      "Horizontal"
	    }
	    Block {
	      BlockType		      Reference
	      Name		      "Matrix\nConcatenation13"
	      Ports		      [10, 1]
	      Position		      [190, 585, 205, 630]
	      ShowName		      off
	      SourceBlock	      "simulink3/Signals\n& Systems/Matrix\nCo"
"ncatenation"
	      SourceType	      "Matrix Concatenation"
	      numInports	      "10"
	      catMethod		      "Horizontal"
	    }
	    Block {
	      BlockType		      Reference
	      Name		      "Matrix\nConcatenation14"
	      Ports		      [10, 1]
	      Position		      [190, 655, 205, 700]
	      ShowName		      off
	      SourceBlock	      "simulink3/Signals\n& Systems/Matrix\nCo"
"ncatenation"
	      SourceType	      "Matrix Concatenation"
	      numInports	      "10"
	      catMethod		      "Horizontal"
	    }
	    Block {
	      BlockType		      Reference
	      Name		      "Matrix\nConcatenation2"
	      Ports		      [10, 1]
	      Position		      [95, 270, 110, 315]
	      ShowName		      off
	      SourceBlock	      "simulink3/Signals\n& Systems/Matrix\nCo"
"ncatenation"
	      SourceType	      "Matrix Concatenation"
	      numInports	      "10"
	      catMethod		      "Horizontal"
	    }
	    Block {
	      BlockType		      Reference
	      Name		      "Matrix\nConcatenation3"
	      Ports		      [10, 1]
	      Position		      [190, 305, 205, 350]
	      ShowName		      off
	      SourceBlock	      "simulink3/Signals\n& Systems/Matrix\nCo"
"ncatenation"
	      SourceType	      "Matrix Concatenation"
	      numInports	      "10"
	      catMethod		      "Horizontal"
	    }
	    Block {
	      BlockType		      Reference
	      Name		      "Matrix\nConcatenation4"
	      Ports		      [10, 1]
	      Position		      [85, 340, 100, 385]
	      ShowName		      off
	      SourceBlock	      "simulink3/Signals\n& Systems/Matrix\nCo"
"ncatenation"
	      SourceType	      "Matrix Concatenation"
	      numInports	      "10"
	      catMethod		      "Horizontal"
	    }
	    Block {
	      BlockType		      Reference
	      Name		      "Matrix\nConcatenation5"
	      Ports		      [10, 1]
	      Position		      [190, 375, 205, 420]
	      ShowName		      off
	      SourceBlock	      "simulink3/Signals\n& Systems/Matrix\nCo"
"ncatenation"
	      SourceType	      "Matrix Concatenation"
	      numInports	      "10"
	      catMethod		      "Horizontal"
	    }
	    Block {
	      BlockType		      Reference
	      Name		      "Matrix\nConcatenation6"
	      Ports		      [10, 1]
	      Position		      [85, 410, 100, 455]
	      ShowName		      off
	      SourceBlock	      "simulink3/Signals\n& Systems/Matrix\nCo"
"ncatenation"
	      SourceType	      "Matrix Concatenation"
	      numInports	      "10"
	      catMethod		      "Horizontal"
	    }
	    Block {
	      BlockType		      Reference
	      Name		      "Matrix\nConcatenation7"
	      Ports		      [10, 1]
	      Position		      [190, 445, 205, 490]
	      ShowName		      off
	      SourceBlock	      "simulink3/Signals\n& Systems/Matrix\nCo"
"ncatenation"
	      SourceType	      "Matrix Concatenation"
	      numInports	      "10"
	      catMethod		      "Horizontal"
	    }
	    Block {
	      BlockType		      Reference
	      Name		      "Matrix\nConcatenation9"
	      Ports		      [10, 1]
	      Position		      [85, 480, 100, 525]
	      ShowName		      off
	      SourceBlock	      "simulink3/Signals\n& Systems/Matrix\nCo"
"ncatenation"
	      SourceType	      "Matrix Concatenation"
	      numInports	      "10"
	      catMethod		      "Horizontal"
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Power"
	      Ports		      [2, 1]
	      Position		      [810, 85, 900, 145]
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"Power"
		Location		[1175, 566, 1551, 664]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"automatic"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "Current"
		  Position		  [25, 13, 55, 27]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Inport
		  Name			  "Voltage"
		  Position		  [35, 43, 65, 57]
		  Port			  "2"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Product
		  Name			  "P=i*V"
		  Ports			  [2, 1]
		  Position		  [90, 26, 135, 59]
		  Inputs		  "2"
		  Multiplication	  "Element-wise(.*)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  ToWorkspace
		  Name			  "To Workspace9"
		  Position		  [265, 13, 350, 37]
		  ShowName		  off
		  VariableName		  "ess_pwr_out_a"
		  MaxDataPoints		  "inf"
		  Decimation		  "1"
		  SampleTime		  "-1"
		  SaveFormat		  "Array"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Avail\nPower"
		  Position		  [245, 38, 275, 52]
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "[]"
		}
		Line {
		  SrcBlock		  "P=i*V"
		  SrcPort		  1
		  Points		  [60, 0]
		  Branch {
		    DstBlock		    "Avail\nPower"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, -20]
		    DstBlock		    "To Workspace9"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "Current"
		  SrcPort		  1
		  Points		  [0, 15]
		  DstBlock		  "P=i*V"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Voltage"
		  SrcPort		  1
		  DstBlock		  "P=i*V"
		  DstPort		  2
		}
	      }
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Power request"
	      Ports		      [1, 1]
	      Position		      [65, 24, 170, 66]
	      AncestorBlock	      "lib_energy_storage/Ess Choices/energy s"
"torage <ess>\nSaber/Power request"
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"Power request"
		Location		[118, 519, 774, 762]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"automatic"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "power req'd"
		  Position		  [35, 113, 65, 127]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Gain
		  Name			  "1/# batteries"
		  Position		  [280, 105, 330, 135]
		  Gain			  "1/ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  RelationalOperator
		  Name			  "Relational\nOperator1"
		  Position		  [390, 97, 420, 128]
		  ShowName		  off
		  Operator		  "=="
		}
		Block {
		  BlockType		  ToWorkspace
		  Name			  "To Workspace8"
		  Position		  [25, 185, 100, 205]
		  Orientation		  "left"
		  ShowName		  off
		  VariableName		  "ess_pwr_out_r"
		  MaxDataPoints		  "inf"
		  Decimation		  "1"
		  SampleTime		  "-1"
		  SaveFormat		  "Array"
		}
		Block {
		  BlockType		  Constant
		  Name			  "if P==0"
		  Position		  [330, 40, 350, 60]
		  Value			  "0"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Switch
		  Name			  "if P==0, pass \nP=0.0001"
		  Position		  [495, 100, 525, 130]
		  Threshold		  "0.1"
		}
		Block {
		  BlockType		  Constant
		  Name			  "non-zero power"
		  Position		  [400, 22, 460, 38]
		  Value			  "0.0001"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Outport
		  Name			  "P request"
		  Position		  [585, 108, 615, 122]
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "[]"
		}
		Line {
		  SrcBlock		  "power req'd"
		  SrcPort		  1
		  Points		  [155, 0]
		  Branch {
		    Points		    [0, 75]
		    DstBlock		    "To Workspace8"
		    DstPort		    1
		  }
		  Branch {
		    DstBlock		    "1/# batteries"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "1/# batteries"
		  SrcPort		  1
		  Points		  [35, 0]
		  Branch {
		    Points		    [0, 35; 75, 0; 0, -30]
		    DstBlock		    "if P==0, pass \nP=0.0001"
		    DstPort		    3
		  }
		  Branch {
		    DstBlock		    "Relational\nOperator1"
		    DstPort		    2
		  }
		}
		Line {
		  SrcBlock		  "if P==0, pass \nP=0.0001"
		  SrcPort		  1
		  DstBlock		  "P request"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "if P==0"
		  SrcPort		  1
		  Points		  [20, 0]
		  DstBlock		  "Relational\nOperator1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "non-zero power"
		  SrcPort		  1
		  Points		  [15, 0]
		  DstBlock		  "if P==0, pass \nP=0.0001"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Relational\nOperator1"
		  SrcPort		  1
		  DstBlock		  "if P==0, pass \nP=0.0001"
		  DstPort		  2
		}
	      }
	    }
	    Block {
	      BlockType		      "S-Function"
	      Name		      "S-Function that calls \nSaber co-simula"
"tion\ninputs: power request\nload parameters\noutputs: accessory power\nmodel"
" outputs: currrent, voltage"
	      Ports		      [1, 1]
	      Position		      [350, 131, 470, 159]
	      ForegroundColor	      "magenta"
	      FunctionName	      "SaberCosimSfun"
	      Parameters	      "strrep(which('advisor'),'advisor.m','tm"
"p\\'),time_step,Saber_Battery_IO_File"
	      PortCounts	      "[]"
	      SFunctionModules	      "''"
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "SOC's"
	      Ports		      [1]
	      Position		      [660, 184, 725, 216]
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"SOC's"
		Location		[348, 925, 961, 1099]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"automatic"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "Saber SOC's"
		  Position		  [25, 25, 55, 40]
		  Orientation		  "down"
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Constant
		  Name			  "Const"
		  Position		  [470, 35, 540, 55]
		  Orientation		  "down"
		  ShowName		  off
		  FontName		  "Arial"
		  Value			  "enable_stop"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  Goto
		  Name			  "Goto <sdo>, <cs>"
		  Position		  [360, 54, 405, 76]
		  GotoTag		  "SOC"
		  TagVisibility		  "global"
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Mean"
		  Ports			  [1, 1]
		  Position		  [110, 82, 150, 108]
		  ShowPortLabels	  on
		  TreatAsAtomicUnit	  off
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  System {
		    Name		    "Mean"
		    Location		    [1009, 776, 1293, 873]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "automatic"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "In"
		    Position		    [25, 33, 55, 47]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Gain
		    Name		    "Average over \n10 modules"
		    Position		    [140, 25, 195, 55]
		    Gain		    "1/10"
		    Multiplication	    "Element-wise(K.*u)"
		    SaturateOnIntegerOverflow on
		    }
		    Block {
		    BlockType		    Sum
		    Name		    "Sum2"
		    Ports		    [1, 1]
		    Position		    [80, 25, 110, 55]
		    ShowName		    off
		    IconShape		    "round"
		    Inputs		    "1"
		    SaturateOnIntegerOverflow on
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "Out"
		    Position		    [220, 33, 250, 47]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "[]"
		    }
		    Line {
		    SrcBlock		    "Sum2"
		    SrcPort		    1
		    DstBlock		    "Average over \n10 modules"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "In"
		    SrcPort		    1
		    DstBlock		    "Sum2"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Average over \n10 modules"
		    SrcPort		    1
		    DstBlock		    "Out"
		    DstPort		    1
		    }
		  }
		}
		Block {
		  BlockType		  ToWorkspace
		  Name			  "To Workspace2"
		  Position		  [100, 49, 200, 71]
		  ShowName		  off
		  VariableName		  "saber_ess_SOC"
		  MaxDataPoints		  "inf"
		  Decimation		  "1"
		  SampleTime		  "-1"
		  SaveFormat		  "Array"
		}
		Block {
		  BlockType		  Memory
		  Name			  "soc mem"
		  Position		  [230, 80, 260, 110]
		  X0			  "ess_init_soc"
		  InheritSampleTime	  off
		  RTWStateStorageClass	  "Auto"
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "stop sim"
		  Ports			  [1, 0, 1]
		  Position		  [475, 79, 535, 111]
		  ShowPortLabels	  on
		  TreatAsAtomicUnit	  on
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  System {
		    Name		    "stop sim"
		    Location		    [427, 258, 823, 468]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "SOC"
		    Position		    [75, 85, 95, 105]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    EnablePort
		    Name		    "Enable"
		    Ports		    []
		    Position		    [170, 25, 190, 45]
		    StatesWhenEnabling	    "held"
		    ShowOutputPort	    off
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "Const"
		    Position		    [95, 145, 165, 165]
		    Orientation		    "up"
		    ShowName		    off
		    FontName		    "Arial"
		    Value		    "0.1"
		    VectorParams1D	    on
		    }
		    Block {
		    BlockType		    RelationalOperator
		    Name		    "Relational\nOperator"
		    Position		    [185, 88, 215, 112]
		    Operator		    "<"
		    }
		    Block {
		    BlockType		    Stop
		    Name		    "Stop Simulation"
		    Position		    [255, 83, 295, 117]
		    }
		    Line {
		    SrcBlock		    "Const"
		    SrcPort		    1
		    Points		    [0, -35]
		    DstBlock		    "Relational\nOperator"
		    DstPort		    2
		    }
		    Line {
		    SrcBlock		    "SOC"
		    SrcPort		    1
		    DstBlock		    "Relational\nOperator"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Relational\nOperator"
		    SrcPort		    1
		    DstBlock		    "Stop Simulation"
		    DstPort		    1
		    }
		  }
		}
		Line {
		  SrcBlock		  "Saber SOC's"
		  SrcPort		  1
		  Points		  [0, 0; 0, 15]
		  Branch {
		    Points		    [0, 35]
		    DstBlock		    "Mean"
		    DstPort		    1
		  }
		  Branch {
		    DstBlock		    "To Workspace2"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "Const"
		  SrcPort		  1
		  DstBlock		  "stop sim"
		  DstPort		  enable
		}
		Line {
		  SrcBlock		  "Mean"
		  SrcPort		  1
		  DstBlock		  "soc mem"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "soc mem"
		  SrcPort		  1
		  Points		  [60, 0]
		  Branch {
		    Points		    [0, -30]
		    DstBlock		    "Goto <sdo>, <cs>"
		    DstPort		    1
		  }
		  Branch {
		    DstBlock		    "stop sim"
		    DstPort		    1
		  }
		}
	      }
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "Saber Current \nReversed"
	      Position		      [535, 107, 580, 123]
	      NamePlacement	      "alternate"
	      Gain		      "-1"
	      Multiplication	      "Element-wise(K.*u)"
	      SaturateOnIntegerOverflow	on
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Temps"
	      Ports		      [1]
	      Position		      [660, 248, 730, 282]
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"Temps"
		Location		[994, 803, 1293, 940]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"automatic"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "Saber Temps"
		  Position		  [25, 25, 55, 40]
		  Orientation		  "down"
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Mean"
		  Ports			  [1, 1]
		  Position		  [140, 47, 180, 73]
		  ShowPortLabels	  on
		  TreatAsAtomicUnit	  off
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  System {
		    Name		    "Mean"
		    Location		    [1009, 776, 1293, 873]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "automatic"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "In"
		    Position		    [25, 33, 55, 47]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    Gain
		    Name		    "Average over \n10 modules"
		    Position		    [140, 25, 195, 55]
		    Gain		    "1/10"
		    Multiplication	    "Element-wise(K.*u)"
		    SaturateOnIntegerOverflow on
		    }
		    Block {
		    BlockType		    Sum
		    Name		    "Sum2"
		    Ports		    [1, 1]
		    Position		    [80, 25, 110, 55]
		    ShowName		    off
		    IconShape		    "round"
		    Inputs		    "1"
		    SaturateOnIntegerOverflow on
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "Out"
		    Position		    [220, 33, 250, 47]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "[]"
		    }
		    Line {
		    SrcBlock		    "Sum2"
		    SrcPort		    1
		    DstBlock		    "Average over \n10 modules"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "In"
		    SrcPort		    1
		    DstBlock		    "Sum2"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Average over \n10 modules"
		    SrcPort		    1
		    DstBlock		    "Out"
		    DstPort		    1
		    }
		  }
		}
		Block {
		  BlockType		  ToWorkspace
		  Name			  "To WS2"
		  Position		  [205, 49, 290, 71]
		  ShowName		  off
		  FontName		  "Arial"
		  VariableName		  "ess_mod_tmp"
		  MaxDataPoints		  "inf"
		  Decimation		  "1"
		  SampleTime		  "0"
		  SaveFormat		  "Array"
		}
		Block {
		  BlockType		  ToWorkspace
		  Name			  "To Workspace3"
		  Position		  [135, 94, 235, 116]
		  ShowName		  off
		  VariableName		  "saber_ess_temp"
		  MaxDataPoints		  "inf"
		  Decimation		  "1"
		  SampleTime		  "-1"
		  SaveFormat		  "Array"
		}
		Line {
		  SrcBlock		  "Saber Temps"
		  SrcPort		  1
		  Points		  [0, 0; 0, 15]
		  Branch {
		    DstBlock		    "Mean"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, 45]
		    DstBlock		    "To Workspace3"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "Mean"
		  SrcPort		  1
		  DstBlock		  "To WS2"
		  DstPort		  1
		}
	      }
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Thermal Power"
	      Ports		      [1]
	      Position		      [660, 310, 745, 340]
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"Thermal Power"
		Location		[381, 800, 860, 937]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"automatic"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "Saber Thermal P"
		  Position		  [45, 42, 75, 58]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Gain
		  Name			  "# batteries"
		  Position		  [190, 41, 240, 59]
		  Gain			  "ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Saturate
		  Name			  "Saturation"
		  Position		  [120, 35, 150, 65]
		  UpperLimit		  "inf"
		  LowerLimit		  "0"
		  LinearizeAsGain	  on
		}
		Block {
		  BlockType		  Sum
		  Name			  "Sum2"
		  Ports			  [1, 1]
		  Position		  [310, 35, 340, 65]
		  ShowName		  off
		  IconShape		  "round"
		  Inputs		  "1"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  ToWorkspace
		  Name			  "To Workspace3"
		  Position		  [315, 84, 415, 106]
		  ShowName		  off
		  VariableName		  "saber_ess_th_pwr"
		  MaxDataPoints		  "inf"
		  Decimation		  "1"
		  SampleTime		  "-1"
		  SaveFormat		  "Array"
		}
		Block {
		  BlockType		  ToWorkspace
		  Name			  "To Workspace9"
		  Position		  [370, 40, 445, 60]
		  ShowName		  off
		  VariableName		  "ess_pwr_loss_a"
		  MaxDataPoints		  "inf"
		  Decimation		  "1"
		  SampleTime		  "-1"
		  SaveFormat		  "Array"
		}
		Line {
		  SrcBlock		  "Sum2"
		  SrcPort		  1
		  DstBlock		  "To Workspace9"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "# batteries"
		  SrcPort		  1
		  Points		  [25, 0]
		  Branch {
		    DstBlock		    "Sum2"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, 45]
		    DstBlock		    "To Workspace3"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "Saber Thermal P"
		  SrcPort		  1
		  DstBlock		  "Saturation"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Saturation"
		  SrcPort		  1
		  DstBlock		  "# batteries"
		  DstPort		  1
		}
	      }
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Time Dependent Power Request"
	      Ports		      [1, 1]
	      Position		      [185, 33, 315, 57]
	      AncestorBlock	      "lib_energy_storage/Ess Choices/energy s"
"torage <ess>\nSaber/Time Dependent Power Request"
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"Time Dependent Power Request"
		Location		[127, 108, 885, 796]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "P request"
		  Position		  [25, 358, 55, 372]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		  Port {
		    PortNumber		    1
		    Name		    "P request"
		    TestPoint		    off
		    LinearAnalysisOutput    off
		    LinearAnalysisInput	    off
		    RTWStorageClass	    "Auto"
		  }
		}
		Block {
		  BlockType		  Constant
		  Name			  "Constant"
		  Position		  [105, 65, 135, 95]
		  Value			  "0"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Enabled\nSubsystem1"
		  Ports			  [1, 1, 1]
		  Position		  [270, 163, 370, 187]
		  ShowPortLabels	  on
		  TreatAsAtomicUnit	  on
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  System {
		    Name		    "Enabled\nSubsystem1"
		    Location		    [421, 301, 919, 601]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "In1"
		    Position		    [110, 103, 140, 117]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    EnablePort
		    Name		    "Enable"
		    Ports		    []
		    Position		    [235, 20, 255, 40]
		    StatesWhenEnabling	    "held"
		    ShowOutputPort	    off
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "Out1"
		    Position		    [360, 103, 390, 117]
		    Port		    "1"
		    OutputWhenDisabled	    "held"
		    InitialOutput	    "[]"
		    }
		    Line {
		    SrcBlock		    "In1"
		    SrcPort		    1
		    DstBlock		    "Out1"
		    DstPort		    1
		    }
		  }
		}
		Block {
		  BlockType		  From
		  Name			  "From"
		  Position		  [220, 452, 270, 468]
		  CloseFcn		  "tagdialog Close"
		  GotoTag		  "time"
		}
		Block {
		  BlockType		  From
		  Name			  "From1"
		  Position		  [190, 262, 240, 278]
		  CloseFcn		  "tagdialog Close"
		  GotoTag		  "time"
		}
		Block {
		  BlockType		  From
		  Name			  "From4"
		  Position		  [95, 137, 145, 153]
		  CloseFcn		  "tagdialog Close"
		  GotoTag		  "time"
		}
		Block {
		  BlockType		  InitialCondition
		  Name			  "IC"
		  Position		  [330, 443, 385, 477]
		  Value			  "time_step"
		}
		Block {
		  BlockType		  Reference
		  Name			  "Matrix\nConcatenation1"
		  Ports			  [6, 1]
		  Position		  [565, 35, 595, 600]
		  ShowName		  off
		  SourceBlock		  "lib_energy_storage/Ess Choices/ener"
"gy storage <ess>\nSaber/Matrix\nConcatenation1"
		  SourceType		  "Matrix Concatenation"
		  numInports		  "6"
		  catMethod		  "Horizontal"
		}
		Block {
		  BlockType		  Memory
		  Name			  "Memory1"
		  Position		  [380, 255, 410, 285]
		  X0			  ".001"
		  InheritSampleTime	  on
		  RTWStateStorageClass	  "Auto"
		}
		Block {
		  BlockType		  Memory
		  Name			  "Memory2"
		  Position		  [245, 350, 275, 380]
		  ShowName		  off
		  X0			  "80"
		  InheritSampleTime	  on
		  RTWStateStorageClass	  "Auto"
		}
		Block {
		  BlockType		  RelationalOperator
		  Name			  "Relational\nOperator"
		  Position		  [225, 122, 255, 153]
		  ShowName		  off
		  Operator		  "=="
		}
		Block {
		  BlockType		  Saturate
		  Name			  "Saturation"
		  Position		  [275, 255, 305, 285]
		  UpperLimit		  "inf"
		  LowerLimit		  ".001"
		  LinearizeAsGain	  on
		}
		Block {
		  BlockType		  Outport
		  Name			  "P request time"
		  Position		  [680, 313, 710, 327]
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "[]"
		}
		Line {
		  SrcBlock		  "Relational\nOperator"
		  SrcPort		  1
		  Points		  [60, 0]
		  DstBlock		  "Enabled\nSubsystem1"
		  DstPort		  enable
		}
		Line {
		  SrcBlock		  "From4"
		  SrcPort		  1
		  DstBlock		  "Relational\nOperator"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Enabled\nSubsystem1"
		  SrcPort		  1
		  DstBlock		  "Matrix\nConcatenation1"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Memory2"
		  SrcPort		  1
		  DstBlock		  "Matrix\nConcatenation1"
		  DstPort		  4
		}
		Line {
		  SrcBlock		  "Matrix\nConcatenation1"
		  SrcPort		  1
		  DstBlock		  "P request time"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "IC"
		  SrcPort		  1
		  DstBlock		  "Matrix\nConcatenation1"
		  DstPort		  5
		}
		Line {
		  SrcBlock		  "Saturation"
		  SrcPort		  1
		  DstBlock		  "Memory1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "From1"
		  SrcPort		  1
		  DstBlock		  "Saturation"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Memory1"
		  SrcPort		  1
		  DstBlock		  "Matrix\nConcatenation1"
		  DstPort		  3
		}
		Line {
		  SrcBlock		  "From"
		  SrcPort		  1
		  DstBlock		  "IC"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Constant"
		  SrcPort		  1
		  Points		  [55, 0]
		  Branch {
		    Points		    [0, 50]
		    DstBlock		    "Relational\nOperator"
		    DstPort		    1
		  }
		  Branch {
		    DstBlock		    "Matrix\nConcatenation1"
		    DstPort		    1
		  }
		}
		Line {
		  Name			  "P request"
		  Labels		  [0, 0]
		  SrcBlock		  "P request"
		  SrcPort		  1
		  Points		  [35, 0]
		  Branch {
		    Points		    [85, 0]
		    Branch {
		    DstBlock		    "Memory2"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [0, 190]
		    DstBlock		    "Matrix\nConcatenation1"
		    DstPort		    6
		    }
		  }
		  Branch {
		    Points		    [0, -190]
		    DstBlock		    "Enabled\nSubsystem1"
		    DstPort		    1
		  }
		}
	      }
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To Workspace10"
	      Position		      [625, 37, 690, 63]
	      ShowName		      off
	      VariableName	      "ess_current"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "-1"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Voltages"
	      Ports		      [1, 1]
	      Position		      [620, 114, 760, 146]
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"Voltages"
		Location		[713, 524, 1254, 752]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"automatic"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "Saber\nVoltages"
		  Position		  [25, 93, 55, 107]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Gain
		  Name			  "# batteries"
		  Position		  [90, 91, 140, 109]
		  Gain			  "ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Goto
		  Name			  "Goto <mc>, <gc>, <sdo>"
		  Position		  [345, 60, 425, 80]
		  GotoTag		  "bus_voltage"
		  TagVisibility		  "global"
		}
		Block {
		  BlockType		  Sum
		  Name			  "Sum"
		  Ports			  [1, 1]
		  Position		  [185, 25, 215, 55]
		  ShowName		  off
		  IconShape		  "round"
		  Inputs		  "1"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  ToWorkspace
		  Name			  "To Workspace1"
		  Position		  [350, 104, 425, 126]
		  ShowName		  off
		  VariableName		  "ess_voltage"
		  MaxDataPoints		  "inf"
		  Decimation		  "1"
		  SampleTime		  "-1"
		  SaveFormat		  "Array"
		}
		Block {
		  BlockType		  ToWorkspace
		  Name			  "To Workspace11"
		  Position		  [185, 124, 285, 146]
		  ShowName		  off
		  VariableName		  "saber_ess_voltage"
		  MaxDataPoints		  "inf"
		  Decimation		  "1"
		  SampleTime		  "-1"
		  SaveFormat		  "Array"
		}
		Block {
		  BlockType		  Outport
		  Name			  "ADV\nVoltage"
		  Position		  [465, 33, 495, 47]
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "[]"
		}
		Line {
		  SrcBlock		  "# batteries"
		  SrcPort		  1
		  Points		  [-10, 0; 35, 0]
		  Branch {
		    DstBlock		    "Sum"
		    DstPort		    1
		  }
		  Branch {
		    DstBlock		    "To Workspace11"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "Sum"
		  SrcPort		  1
		  Points		  [0, 0; 30, 0]
		  Branch {
		    Points		    [0, 30; 65, 0]
		    Branch {
		    DstBlock		    "Goto <mc>, <gc>, <sdo>"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [0, 45]
		    DstBlock		    "To Workspace1"
		    DstPort		    1
		    }
		  }
		  Branch {
		    DstBlock		    "ADV\nVoltage"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "Saber\nVoltages"
		  SrcPort		  1
		  DstBlock		  "# batteries"
		  DstPort		  1
		}
	      }
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "ess_max_soc"
	      Position		      [60, 210, 90, 240]
	      Value		      "ess_max_soc"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "ess_max_volts"
	      Position		      [60, 140, 90, 170]
	      Value		      "ess_max_volts"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "ess_min_soc"
	      Position		      [160, 245, 190, 275]
	      Value		      "ess_min_soc"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "ess_min_volts"
	      Position		      [165, 175, 195, 205]
	      Value		      "ess_min_volts"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "ess_mod_cpm"
	      Position		      [125, 665, 155, 695]
	      Value		      "ess_mod_cpm"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "ess_th_res"
	      Position		      [15, 630, 45, 660]
	      Value		      "ess_th_res"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "max pack\npwr (W)"
	      Ports		      []
	      Position		      [820, 235, 850, 265]
	      ShowPortLabels	      off
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"max pack\npwr (W)"
		Location		[806, 295, 1261, 432]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Goto
		  Name			  "Goto <cs>1"
		  Position		  [340, 60, 420, 80]
		  GotoTag		  "ess_max_pwr"
		  TagVisibility		  "global"
		}
		Block {
		  BlockType		  Ground
		  Name			  "Ground"
		  Position		  [245, 60, 265, 80]
		}
		Line {
		  SrcBlock		  "Ground"
		  SrcPort		  1
		  DstBlock		  "Goto <cs>1"
		  DstPort		  1
		}
		Annotation {
		  Position		  [92, 38]
		  Text			  "Edit in the future\nUsed in series "
"power follower"
		}
	      }
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "saber_air_temp"
	      Position		      [125, 595, 155, 625]
	      Value		      "saber_air_temp"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "saber_init_soc"
	      Position		      [120, 315, 150, 345]
	      Value		      "saber_init_soc"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "saber_init_temp"
	      Position		      [25, 560, 55, 590]
	      Value		      "saber_init_temp"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "saber_init_voc"
	      Position		      [20, 280, 50, 310]
	      Value		      "saber_init_voc"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "saber_k_cb"
	      Position		      [115, 455, 145, 485]
	      Value		      "saber_k_cb"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "saber_k_cc"
	      Position		      [20, 490, 50, 520]
	      Value		      "saber_k_cc"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "saber_k_rc"
	      Position		      [15, 350, 45, 380]
	      Value		      "saber_k_rc"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "saber_k_re"
	      Position		      [115, 385, 145, 415]
	      Value		      "saber_k_re"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "saber_k_rt"
	      Position		      [15, 420, 45, 450]
	      Value		      "saber_k_rt"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "saber_k_soc"
	      Position		      [125, 525, 155, 555]
	      Value		      "saber_k_soc"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "power available\nto bus (W)"
	      Position		      [980, 105, 1000, 125]
	      FontName		      "Arial"
	      Port		      "1"
	      OutputWhenDisabled      "held"
	      InitialOutput	      "0"
	    }
	    Line {
	      SrcBlock		      "S-Function that calls \nSaber co-simula"
"tion\ninputs: power request\nload parameters\noutputs: accessory power\nmodel"
" outputs: currrent, voltage"
	      SrcPort		      1
	      DstBlock		      "Demux"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux"
	      SrcPort		      2
	      DstBlock		      "Voltages"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux"
	      SrcPort		      4
	      Points		      [70, 0; 0, 105]
	      DstBlock		      "Temps"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux"
	      SrcPort		      3
	      Points		      [85, 0; 0, 55]
	      DstBlock		      "SOC's"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Voltages"
	      SrcPort		      1
	      DstBlock		      "Power"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Power"
	      SrcPort		      1
	      DstBlock		      "power available\nto bus (W)"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux"
	      SrcPort		      1
	      DstBlock		      "Saber Current \nReversed"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Saber Current \nReversed"
	      SrcPort		      1
	      Points		      [15, 0; 0, -15]
	      Branch {
		DstBlock		"Power"
		DstPort			1
	      }
	      Branch {
		Points			[0, -50]
		DstBlock		"To Workspace10"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Demux"
	      SrcPort		      5
	      Points		      [0, 150]
	      DstBlock		      "Thermal Power"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "power req'd\ninto bus (W)"
	      SrcPort		      1
	      DstBlock		      "Power request"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Matrix\nConcatenation1"
	      SrcPort		      1
	      DstBlock		      "S-Function that calls \nSaber co-simula"
"tion\ninputs: power request\nload parameters\noutputs: accessory power\nmodel"
" outputs: currrent, voltage"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Time Dependent Power Request"
	      SrcPort		      1
	      Points		      [25, 0; 0, 35; -150, 0; 0, 40]
	      DstBlock		      "Matrix\nConcatenation1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "ess_max_volts"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation1"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "ess_min_volts"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation1"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "ess_max_soc"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation1"
	      DstPort		      4
	    }
	    Line {
	      SrcBlock		      "ess_min_soc"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation1"
	      DstPort		      5
	    }
	    Line {
	      SrcBlock		      "Demux1"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation2"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux1"
	      SrcPort		      2
	      DstBlock		      "Matrix\nConcatenation2"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Demux1"
	      SrcPort		      3
	      DstBlock		      "Matrix\nConcatenation2"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "Demux1"
	      SrcPort		      4
	      DstBlock		      "Matrix\nConcatenation2"
	      DstPort		      4
	    }
	    Line {
	      SrcBlock		      "Demux1"
	      SrcPort		      5
	      DstBlock		      "Matrix\nConcatenation2"
	      DstPort		      5
	    }
	    Line {
	      SrcBlock		      "Demux1"
	      SrcPort		      6
	      DstBlock		      "Matrix\nConcatenation2"
	      DstPort		      6
	    }
	    Line {
	      SrcBlock		      "Demux1"
	      SrcPort		      7
	      DstBlock		      "Matrix\nConcatenation2"
	      DstPort		      7
	    }
	    Line {
	      SrcBlock		      "Demux1"
	      SrcPort		      8
	      DstBlock		      "Matrix\nConcatenation2"
	      DstPort		      8
	    }
	    Line {
	      SrcBlock		      "Demux1"
	      SrcPort		      9
	      DstBlock		      "Matrix\nConcatenation2"
	      DstPort		      9
	    }
	    Line {
	      SrcBlock		      "Demux1"
	      SrcPort		      10
	      DstBlock		      "Matrix\nConcatenation2"
	      DstPort		      10
	    }
	    Line {
	      SrcBlock		      "saber_init_soc"
	      SrcPort		      1
	      DstBlock		      "Demux2"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux2"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation3"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux2"
	      SrcPort		      2
	      DstBlock		      "Matrix\nConcatenation3"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Demux2"
	      SrcPort		      3
	      DstBlock		      "Matrix\nConcatenation3"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "Demux2"
	      SrcPort		      4
	      DstBlock		      "Matrix\nConcatenation3"
	      DstPort		      4
	    }
	    Line {
	      SrcBlock		      "Demux2"
	      SrcPort		      5
	      DstBlock		      "Matrix\nConcatenation3"
	      DstPort		      5
	    }
	    Line {
	      SrcBlock		      "Demux2"
	      SrcPort		      6
	      DstBlock		      "Matrix\nConcatenation3"
	      DstPort		      6
	    }
	    Line {
	      SrcBlock		      "Demux2"
	      SrcPort		      7
	      DstBlock		      "Matrix\nConcatenation3"
	      DstPort		      7
	    }
	    Line {
	      SrcBlock		      "Demux2"
	      SrcPort		      8
	      DstBlock		      "Matrix\nConcatenation3"
	      DstPort		      8
	    }
	    Line {
	      SrcBlock		      "Demux2"
	      SrcPort		      9
	      DstBlock		      "Matrix\nConcatenation3"
	      DstPort		      9
	    }
	    Line {
	      SrcBlock		      "Demux2"
	      SrcPort		      10
	      DstBlock		      "Matrix\nConcatenation3"
	      DstPort		      10
	    }
	    Line {
	      SrcBlock		      "saber_k_rc"
	      SrcPort		      1
	      DstBlock		      "Demux3"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux3"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation4"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux3"
	      SrcPort		      2
	      DstBlock		      "Matrix\nConcatenation4"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Demux3"
	      SrcPort		      3
	      DstBlock		      "Matrix\nConcatenation4"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "Demux3"
	      SrcPort		      4
	      DstBlock		      "Matrix\nConcatenation4"
	      DstPort		      4
	    }
	    Line {
	      SrcBlock		      "Demux3"
	      SrcPort		      5
	      DstBlock		      "Matrix\nConcatenation4"
	      DstPort		      5
	    }
	    Line {
	      SrcBlock		      "Demux3"
	      SrcPort		      6
	      DstBlock		      "Matrix\nConcatenation4"
	      DstPort		      6
	    }
	    Line {
	      SrcBlock		      "Demux3"
	      SrcPort		      7
	      DstBlock		      "Matrix\nConcatenation4"
	      DstPort		      7
	    }
	    Line {
	      SrcBlock		      "Demux3"
	      SrcPort		      8
	      DstBlock		      "Matrix\nConcatenation4"
	      DstPort		      8
	    }
	    Line {
	      SrcBlock		      "Demux3"
	      SrcPort		      9
	      DstBlock		      "Matrix\nConcatenation4"
	      DstPort		      9
	    }
	    Line {
	      SrcBlock		      "Demux3"
	      SrcPort		      10
	      DstBlock		      "Matrix\nConcatenation4"
	      DstPort		      10
	    }
	    Line {
	      SrcBlock		      "saber_k_re"
	      SrcPort		      1
	      DstBlock		      "Demux4"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux4"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation5"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux4"
	      SrcPort		      2
	      DstBlock		      "Matrix\nConcatenation5"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Demux4"
	      SrcPort		      3
	      DstBlock		      "Matrix\nConcatenation5"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "Demux4"
	      SrcPort		      4
	      DstBlock		      "Matrix\nConcatenation5"
	      DstPort		      4
	    }
	    Line {
	      SrcBlock		      "Demux4"
	      SrcPort		      5
	      DstBlock		      "Matrix\nConcatenation5"
	      DstPort		      5
	    }
	    Line {
	      SrcBlock		      "Demux4"
	      SrcPort		      6
	      DstBlock		      "Matrix\nConcatenation5"
	      DstPort		      6
	    }
	    Line {
	      SrcBlock		      "Demux4"
	      SrcPort		      7
	      DstBlock		      "Matrix\nConcatenation5"
	      DstPort		      7
	    }
	    Line {
	      SrcBlock		      "Demux4"
	      SrcPort		      8
	      DstBlock		      "Matrix\nConcatenation5"
	      DstPort		      8
	    }
	    Line {
	      SrcBlock		      "Demux4"
	      SrcPort		      9
	      DstBlock		      "Matrix\nConcatenation5"
	      DstPort		      9
	    }
	    Line {
	      SrcBlock		      "Demux4"
	      SrcPort		      10
	      DstBlock		      "Matrix\nConcatenation5"
	      DstPort		      10
	    }
	    Line {
	      SrcBlock		      "Demux5"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation6"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux5"
	      SrcPort		      2
	      DstBlock		      "Matrix\nConcatenation6"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Demux5"
	      SrcPort		      3
	      DstBlock		      "Matrix\nConcatenation6"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "Demux5"
	      SrcPort		      4
	      DstBlock		      "Matrix\nConcatenation6"
	      DstPort		      4
	    }
	    Line {
	      SrcBlock		      "Demux5"
	      SrcPort		      5
	      DstBlock		      "Matrix\nConcatenation6"
	      DstPort		      5
	    }
	    Line {
	      SrcBlock		      "Demux5"
	      SrcPort		      6
	      DstBlock		      "Matrix\nConcatenation6"
	      DstPort		      6
	    }
	    Line {
	      SrcBlock		      "Demux5"
	      SrcPort		      7
	      DstBlock		      "Matrix\nConcatenation6"
	      DstPort		      7
	    }
	    Line {
	      SrcBlock		      "Demux5"
	      SrcPort		      8
	      DstBlock		      "Matrix\nConcatenation6"
	      DstPort		      8
	    }
	    Line {
	      SrcBlock		      "Demux5"
	      SrcPort		      9
	      DstBlock		      "Matrix\nConcatenation6"
	      DstPort		      9
	    }
	    Line {
	      SrcBlock		      "Demux5"
	      SrcPort		      10
	      DstBlock		      "Matrix\nConcatenation6"
	      DstPort		      10
	    }
	    Line {
	      SrcBlock		      "saber_k_cb"
	      SrcPort		      1
	      DstBlock		      "Demux6"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux6"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation7"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux6"
	      SrcPort		      2
	      DstBlock		      "Matrix\nConcatenation7"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Demux6"
	      SrcPort		      3
	      DstBlock		      "Matrix\nConcatenation7"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "Demux6"
	      SrcPort		      4
	      DstBlock		      "Matrix\nConcatenation7"
	      DstPort		      4
	    }
	    Line {
	      SrcBlock		      "Demux6"
	      SrcPort		      5
	      DstBlock		      "Matrix\nConcatenation7"
	      DstPort		      5
	    }
	    Line {
	      SrcBlock		      "Demux6"
	      SrcPort		      6
	      DstBlock		      "Matrix\nConcatenation7"
	      DstPort		      6
	    }
	    Line {
	      SrcBlock		      "Demux6"
	      SrcPort		      7
	      DstBlock		      "Matrix\nConcatenation7"
	      DstPort		      7
	    }
	    Line {
	      SrcBlock		      "Demux6"
	      SrcPort		      8
	      DstBlock		      "Matrix\nConcatenation7"
	      DstPort		      8
	    }
	    Line {
	      SrcBlock		      "Demux6"
	      SrcPort		      9
	      DstBlock		      "Matrix\nConcatenation7"
	      DstPort		      9
	    }
	    Line {
	      SrcBlock		      "Demux6"
	      SrcPort		      10
	      DstBlock		      "Matrix\nConcatenation7"
	      DstPort		      10
	    }
	    Line {
	      SrcBlock		      "saber_k_rt"
	      SrcPort		      1
	      DstBlock		      "Demux5"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Matrix\nConcatenation2"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation1"
	      DstPort		      6
	    }
	    Line {
	      SrcBlock		      "saber_init_voc"
	      SrcPort		      1
	      DstBlock		      "Demux1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Matrix\nConcatenation3"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation1"
	      DstPort		      7
	    }
	    Line {
	      SrcBlock		      "Matrix\nConcatenation4"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation1"
	      DstPort		      8
	    }
	    Line {
	      SrcBlock		      "Matrix\nConcatenation6"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation1"
	      DstPort		      10
	    }
	    Line {
	      SrcBlock		      "Matrix\nConcatenation7"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation1"
	      DstPort		      11
	    }
	    Line {
	      SrcBlock		      "Matrix\nConcatenation5"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation1"
	      DstPort		      9
	    }
	    Line {
	      SrcBlock		      "saber_k_cc"
	      SrcPort		      1
	      DstBlock		      "Demux8"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux8"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation9"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux8"
	      SrcPort		      2
	      DstBlock		      "Matrix\nConcatenation9"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Demux8"
	      SrcPort		      3
	      DstBlock		      "Matrix\nConcatenation9"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "Demux8"
	      SrcPort		      4
	      DstBlock		      "Matrix\nConcatenation9"
	      DstPort		      4
	    }
	    Line {
	      SrcBlock		      "Demux8"
	      SrcPort		      5
	      DstBlock		      "Matrix\nConcatenation9"
	      DstPort		      5
	    }
	    Line {
	      SrcBlock		      "Demux8"
	      SrcPort		      6
	      DstBlock		      "Matrix\nConcatenation9"
	      DstPort		      6
	    }
	    Line {
	      SrcBlock		      "Demux8"
	      SrcPort		      7
	      DstBlock		      "Matrix\nConcatenation9"
	      DstPort		      7
	    }
	    Line {
	      SrcBlock		      "Demux8"
	      SrcPort		      8
	      DstBlock		      "Matrix\nConcatenation9"
	      DstPort		      8
	    }
	    Line {
	      SrcBlock		      "Demux8"
	      SrcPort		      9
	      DstBlock		      "Matrix\nConcatenation9"
	      DstPort		      9
	    }
	    Line {
	      SrcBlock		      "Demux8"
	      SrcPort		      10
	      DstBlock		      "Matrix\nConcatenation9"
	      DstPort		      10
	    }
	    Line {
	      SrcBlock		      "saber_init_temp"
	      SrcPort		      1
	      DstBlock		      "Demux9"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux9"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation10"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux9"
	      SrcPort		      2
	      DstBlock		      "Matrix\nConcatenation10"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Demux9"
	      SrcPort		      3
	      DstBlock		      "Matrix\nConcatenation10"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "Demux9"
	      SrcPort		      4
	      DstBlock		      "Matrix\nConcatenation10"
	      DstPort		      4
	    }
	    Line {
	      SrcBlock		      "Demux9"
	      SrcPort		      5
	      DstBlock		      "Matrix\nConcatenation10"
	      DstPort		      5
	    }
	    Line {
	      SrcBlock		      "Demux9"
	      SrcPort		      6
	      DstBlock		      "Matrix\nConcatenation10"
	      DstPort		      6
	    }
	    Line {
	      SrcBlock		      "Demux9"
	      SrcPort		      7
	      DstBlock		      "Matrix\nConcatenation10"
	      DstPort		      7
	    }
	    Line {
	      SrcBlock		      "Demux9"
	      SrcPort		      8
	      DstBlock		      "Matrix\nConcatenation10"
	      DstPort		      8
	    }
	    Line {
	      SrcBlock		      "Demux9"
	      SrcPort		      9
	      DstBlock		      "Matrix\nConcatenation10"
	      DstPort		      9
	    }
	    Line {
	      SrcBlock		      "Demux9"
	      SrcPort		      10
	      DstBlock		      "Matrix\nConcatenation10"
	      DstPort		      10
	    }
	    Line {
	      SrcBlock		      "ess_th_res"
	      SrcPort		      1
	      DstBlock		      "Demux10"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux10"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation11"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux10"
	      SrcPort		      2
	      DstBlock		      "Matrix\nConcatenation11"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Demux10"
	      SrcPort		      3
	      DstBlock		      "Matrix\nConcatenation11"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "Demux10"
	      SrcPort		      4
	      DstBlock		      "Matrix\nConcatenation11"
	      DstPort		      4
	    }
	    Line {
	      SrcBlock		      "Demux10"
	      SrcPort		      5
	      DstBlock		      "Matrix\nConcatenation11"
	      DstPort		      5
	    }
	    Line {
	      SrcBlock		      "Demux10"
	      SrcPort		      6
	      DstBlock		      "Matrix\nConcatenation11"
	      DstPort		      6
	    }
	    Line {
	      SrcBlock		      "Demux10"
	      SrcPort		      7
	      DstBlock		      "Matrix\nConcatenation11"
	      DstPort		      7
	    }
	    Line {
	      SrcBlock		      "Demux10"
	      SrcPort		      8
	      DstBlock		      "Matrix\nConcatenation11"
	      DstPort		      8
	    }
	    Line {
	      SrcBlock		      "Demux10"
	      SrcPort		      9
	      DstBlock		      "Matrix\nConcatenation11"
	      DstPort		      9
	    }
	    Line {
	      SrcBlock		      "Demux10"
	      SrcPort		      10
	      DstBlock		      "Matrix\nConcatenation11"
	      DstPort		      10
	    }
	    Line {
	      SrcBlock		      "saber_k_soc"
	      SrcPort		      1
	      DstBlock		      "Demux11"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux11"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation12"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux11"
	      SrcPort		      2
	      DstBlock		      "Matrix\nConcatenation12"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Demux11"
	      SrcPort		      3
	      DstBlock		      "Matrix\nConcatenation12"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "Demux11"
	      SrcPort		      4
	      DstBlock		      "Matrix\nConcatenation12"
	      DstPort		      4
	    }
	    Line {
	      SrcBlock		      "Demux11"
	      SrcPort		      5
	      DstBlock		      "Matrix\nConcatenation12"
	      DstPort		      5
	    }
	    Line {
	      SrcBlock		      "Demux11"
	      SrcPort		      6
	      DstBlock		      "Matrix\nConcatenation12"
	      DstPort		      6
	    }
	    Line {
	      SrcBlock		      "Demux11"
	      SrcPort		      7
	      DstBlock		      "Matrix\nConcatenation12"
	      DstPort		      7
	    }
	    Line {
	      SrcBlock		      "Demux11"
	      SrcPort		      8
	      DstBlock		      "Matrix\nConcatenation12"
	      DstPort		      8
	    }
	    Line {
	      SrcBlock		      "Demux11"
	      SrcPort		      9
	      DstBlock		      "Matrix\nConcatenation12"
	      DstPort		      9
	    }
	    Line {
	      SrcBlock		      "Demux11"
	      SrcPort		      10
	      DstBlock		      "Matrix\nConcatenation12"
	      DstPort		      10
	    }
	    Line {
	      SrcBlock		      "Matrix\nConcatenation12"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation1"
	      DstPort		      13
	    }
	    Line {
	      SrcBlock		      "saber_air_temp"
	      SrcPort		      1
	      DstBlock		      "Demux12"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux12"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation13"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux12"
	      SrcPort		      2
	      DstBlock		      "Matrix\nConcatenation13"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Demux12"
	      SrcPort		      3
	      DstBlock		      "Matrix\nConcatenation13"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "Demux12"
	      SrcPort		      4
	      DstBlock		      "Matrix\nConcatenation13"
	      DstPort		      4
	    }
	    Line {
	      SrcBlock		      "Demux12"
	      SrcPort		      5
	      DstBlock		      "Matrix\nConcatenation13"
	      DstPort		      5
	    }
	    Line {
	      SrcBlock		      "Demux12"
	      SrcPort		      6
	      DstBlock		      "Matrix\nConcatenation13"
	      DstPort		      6
	    }
	    Line {
	      SrcBlock		      "Demux12"
	      SrcPort		      7
	      DstBlock		      "Matrix\nConcatenation13"
	      DstPort		      7
	    }
	    Line {
	      SrcBlock		      "Demux12"
	      SrcPort		      8
	      DstBlock		      "Matrix\nConcatenation13"
	      DstPort		      8
	    }
	    Line {
	      SrcBlock		      "Demux12"
	      SrcPort		      9
	      DstBlock		      "Matrix\nConcatenation13"
	      DstPort		      9
	    }
	    Line {
	      SrcBlock		      "Demux12"
	      SrcPort		      10
	      DstBlock		      "Matrix\nConcatenation13"
	      DstPort		      10
	    }
	    Line {
	      SrcBlock		      "Matrix\nConcatenation13"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation1"
	      DstPort		      15
	    }
	    Line {
	      SrcBlock		      "ess_mod_cpm"
	      SrcPort		      1
	      DstBlock		      "Demux13"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux13"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation14"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux13"
	      SrcPort		      2
	      DstBlock		      "Matrix\nConcatenation14"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Demux13"
	      SrcPort		      3
	      DstBlock		      "Matrix\nConcatenation14"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "Demux13"
	      SrcPort		      4
	      DstBlock		      "Matrix\nConcatenation14"
	      DstPort		      4
	    }
	    Line {
	      SrcBlock		      "Demux13"
	      SrcPort		      5
	      DstBlock		      "Matrix\nConcatenation14"
	      DstPort		      5
	    }
	    Line {
	      SrcBlock		      "Demux13"
	      SrcPort		      6
	      DstBlock		      "Matrix\nConcatenation14"
	      DstPort		      6
	    }
	    Line {
	      SrcBlock		      "Matrix\nConcatenation14"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation1"
	      DstPort		      17
	    }
	    Line {
	      SrcBlock		      "Matrix\nConcatenation9"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation1"
	      DstPort		      12
	    }
	    Line {
	      SrcBlock		      "Matrix\nConcatenation10"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation1"
	      DstPort		      14
	    }
	    Line {
	      SrcBlock		      "Matrix\nConcatenation11"
	      SrcPort		      1
	      DstBlock		      "Matrix\nConcatenation1"
	      DstPort		      16
	    }
	    Line {
	      SrcBlock		      "Demux13"
	      SrcPort		      7
	      DstBlock		      "Matrix\nConcatenation14"
	      DstPort		      7
	    }
	    Line {
	      SrcBlock		      "Demux13"
	      SrcPort		      9
	      DstBlock		      "Matrix\nConcatenation14"
	      DstPort		      9
	    }
	    Line {
	      SrcBlock		      "Demux13"
	      SrcPort		      8
	      DstBlock		      "Matrix\nConcatenation14"
	      DstPort		      8
	    }
	    Line {
	      SrcBlock		      "Demux13"
	      SrcPort		      10
	      DstBlock		      "Matrix\nConcatenation14"
	      DstPort		      10
	    }
	    Line {
	      SrcBlock		      "Power request"
	      SrcPort		      1
	      DstBlock		      "Time Dependent Power Request"
	      DstPort		      1
	    }
	  }
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "energy storage <ess>\nfundamental model"
	  Ports			  [1, 1]
	  Position		  [95, 348, 160, 392]
	  ForegroundColor	  "magenta"
	  ShowPortLabels	  off
	  TreatAsAtomicUnit	  off
	  RTWSystemCode		  "Auto"
	  RTWFcnNameOpts	  "Auto"
	  RTWFileNameOpts	  "Auto"
	  MaskDisplay		  "image(imread('bdi_ess.jpg'))"
	  MaskIconFrame		  on
	  MaskIconOpaque	  on
	  MaskIconRotate	  "none"
	  MaskIconUnits		  "autoscale"
	  System {
	    Name		    "energy storage <ess>\nfundamental model"
	    Location		    [85, 421, 1075, 924]
	    Open		    off
	    ModelBrowserVisibility  off
	    ModelBrowserWidth	    200
	    ScreenColor		    "white"
	    PaperOrientation	    "landscape"
	    PaperPositionMode	    "auto"
	    PaperType		    "usletter"
	    PaperUnits		    "inches"
	    ZoomFactor		    "100"
	    Block {
	      BlockType		      Inport
	      Name		      "power req'd\ninto bus (W)"
	      Position		      [35, 130, 55, 150]
	      FontName		      "Arial"
	      Port		      "1"
	      LatchInput	      off
	      Interpolate	      on
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "# batteries"
	      Position		      [570, 85, 620, 105]
	      Gain		      "ess_module_num"
	      Multiplication	      "Element-wise(K.*u)"
	      SaturateOnIntegerOverflow	on
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "# batteries1"
	      Position		      [625, 126, 675, 144]
	      Gain		      "ess_module_num"
	      Multiplication	      "Element-wise(K.*u)"
	      SaturateOnIntegerOverflow	on
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "1/# batteries"
	      Position		      [175, 125, 225, 155]
	      Gain		      "1/ess_module_num"
	      Multiplication	      "Element-wise(K.*u)"
	      SaturateOnIntegerOverflow	on
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Block NOTES"
	      Ports		      []
	      Position		      [860, 420, 916, 460]
	      BackgroundColor	      "green"
	      ShowName		      off
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      MaskDisplay	      "disp('Block\\nNOTES')"
	      MaskIconFrame	      on
	      MaskIconOpaque	      on
	      MaskIconRotate	      "none"
	      MaskIconUnits	      "autoscale"
	      System {
		Name			"Block NOTES"
		Location		[211, 187, 723, 361]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Annotation {
		  Position		  [256, 77]
		  Text			  "Fundamentally based SOC model devel"
"oped at BYU\nFiles needed:\ninput1.dat\ninput2.dat\ninput3.dat\nnrel13cs.dll"
		}
	      }
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "C->K"
	      Position		      [375, 331, 405, 349]
	      Value		      "273"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Clock
	      Name		      "Clock"
	      Position		      [300, 90, 320, 110]
	      DisplayTime	      off
	      Decimation	      "10"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Const"
	      Position		      [850, 215, 920, 235]
	      Orientation	      "down"
	      ShowName		      off
	      FontName		      "Arial"
	      Value		      "enable_stop"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Demux
	      Name		      "Demux"
	      Ports		      [1, 6]
	      Position		      [500, 105, 520, 175]
	      ShowName		      off
	      Outputs		      "6"
	      BusSelectionMode	      off
	    }
	    Block {
	      BlockType		      MATLABFcn
	      Name		      "Discharge Model\nOutputs:\nPreq(W)\nPav"
"ail (W)\nVoltage (V)\nCurrent (A)\nSOC\nHeat Gen (W)"
	      Position		      [415, 125, 475, 155]
	      MATLABFcn		      "fund_byu(u(2),u(1)+t_soc,1,u(3))"
	      OutputDimensions	      "-1"
	      OutputSignalType	      "auto"
	      Output1D		      on
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <cs>1"
	      Position		      [700, 290, 780, 310]
	      GotoTag		      "ess_max_pwr"
	      TagVisibility	      "global"
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <mc>, <gc>, <sdo>"
	      Position		      [750, 170, 830, 190]
	      GotoTag		      "bus_voltage"
	      TagVisibility	      "global"
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <sdo>, <cs>"
	      Position		      [645, 229, 690, 251]
	      GotoTag		      "SOC"
	      TagVisibility	      "global"
	    }
	    Block {
	      BlockType		      Memory
	      Name		      "Memory"
	      Position		      [695, 120, 725, 150]
	      ShowName		      off
	      X0		      "12*ess_module_num"
	      InheritSampleTime	      off
	      RTWStateStorageClass    "Auto"
	    }
	    Block {
	      BlockType		      Memory
	      Name		      "Memory1"
	      Position		      [560, 220, 585, 250]
	      ShowName		      off
	      X0		      "ess_init_soc"
	      InheritSampleTime	      off
	      RTWStateStorageClass    "Auto"
	    }
	    Block {
	      BlockType		      Mux
	      Name		      "Mux"
	      Ports		      [3, 1]
	      Position		      [385, 112, 400, 168]
	      ShowName		      off
	      Inputs		      "3"
	      DisplayOption	      "none"
	    }
	    Block {
	      BlockType		      RelationalOperator
	      Name		      "Relational\nOperator"
	      Position		      [235, 167, 265, 198]
	      ShowName		      off
	      Operator		      ">"
	    }
	    Block {
	      BlockType		      Sum
	      Name		      "Sum1"
	      Ports		      [2, 1]
	      Position		      [375, 282, 405, 313]
	      Orientation	      "left"
	      IconShape		      "rectangular"
	      Inputs		      "++"
	      SaturateOnIntegerOverflow	on
	    }
	    Block {
	      BlockType		      Switch
	      Name		      "Switch"
	      Position		      [290, 150, 320, 180]
	      ShowName		      off
	      Threshold		      "eps"
	    }
	    Block {
	      BlockType		      Memory
	      Name		      "Temp (in C)"
	      Position		      [445, 275, 470, 305]
	      Orientation	      "left"
	      X0		      "amb_tmp"
	      InheritSampleTime	      off
	      RTWStateStorageClass    "Auto"
	    }
	    Block {
	      BlockType		      Terminator
	      Name		      "Terminator1"
	      Position		      [545, 60, 565, 80]
	      ShowName		      off
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS1"
	      Position		      [574, 460, 656, 475]
	      Orientation	      "down"
	      NamePlacement	      "alternate"
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_pwr_loss_a"
	      MaxDataPoints	      "50000"
	      Decimation	      "1"
	      SampleTime	      "0"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS2"
	      Position		      [750, 403, 820, 417]
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_mod_tmp"
	      MaxDataPoints	      "50000"
	      Decimation	      "1"
	      SampleTime	      "0"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS3"
	      Position		      [750, 423, 820, 437]
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_air_tmp"
	      MaxDataPoints	      "50000"
	      Decimation	      "1"
	      SampleTime	      "0"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS4"
	      Position		      [750, 444, 825, 456]
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_air_th_pwr"
	      MaxDataPoints	      "50000"
	      Decimation	      "1"
	      SampleTime	      "0"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To Workspace10"
	      Position		      [575, 177, 640, 203]
	      ShowName		      off
	      VariableName	      "ess_current"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "-1"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To Workspace11"
	      Position		      [755, 124, 830, 146]
	      VariableName	      "ess_voltage"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "-1"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To Workspace8"
	      Position		      [70, 185, 140, 205]
	      Orientation	      "left"
	      VariableName	      "ess_pwr_out_r"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "-1"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To Workspace9"
	      Position		      [685, 49, 760, 71]
	      ShowName		      off
	      VariableName	      "ess_pwr_out_a"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "-1"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "do ess calcs?"
	      Position		      [655, 375, 715, 390]
	      Orientation	      "down"
	      ShowName		      off
	      Value		      "ess_th_calc"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "ess tmp"
	      Ports		      [1, 3, 1]
	      Position		      [640, 403, 730, 457]
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      on
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"ess tmp"
		Location		[431, 254, 962, 524]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "Qess_gen"
		  Position		  [25, 205, 45, 225]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  EnablePort
		  Name			  "Enable"
		  Ports			  []
		  Position		  [390, 217, 420, 243]
		  StatesWhenEnabling	  "reset"
		  ShowOutputPort	  off
		}
		Block {
		  BlockType		  Gain
		  Name			  "#of mods"
		  Position		  [390, 88, 415, 112]
		  Gain			  "ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Gain
		  Name			  "1/#of mods"
		  Position		  [95, 203, 120, 227]
		  Gain			  "1/ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Gain
		  Name			  "1/mcp"
		  Position		  [380, 153, 405, 177]
		  Gain			  "1/(ess_module_mass*ess_mod_cp)"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Block NOTES"
		  Ports			  []
		  Position		  [445, 220, 501, 260]
		  BackgroundColor	  "green"
		  ShowName		  off
		  ShowPortLabels	  on
		  TreatAsAtomicUnit	  off
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  MaskDisplay		  "disp('Block\\nNOTES')"
		  MaskIconFrame		  on
		  MaskIconOpaque	  on
		  MaskIconRotate	  "none"
		  MaskIconUnits		  "autoscale"
		  System {
		    Name		    "Block NOTES"
		    Location		    [505, 510, 924, 573]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Annotation {
		    Position		    [207, 33]
		    Text		    "This block models the thermal beh"
"avior of a battery module with active air cooling.\nThe module is modeled as "
"a single lumped thermal mass.  \nThe fan is on whenever the battery temp is >"
" the set temp."
		    }
		  }
		}
		Block {
		  BlockType		  Memory
		  Name			  "Memory"
		  Position		  [250, 165, 285, 185]
		  Orientation		  "left"
		  FontName		  "Arial"
		  X0			  "cyc_mph(1,2)*.447"
		  InheritSampleTime	  off
		  RTWStateStorageClass	  "Auto"
		}
		Block {
		  BlockType		  Memory
		  Name			  "Memory1"
		  Position		  [100, 30, 135, 50]
		  Orientation		  "left"
		  FontName		  "Arial"
		  X0			  "cyc_mph(1,2)*.447"
		  InheritSampleTime	  off
		  RTWStateStorageClass	  "Auto"
		}
		Block {
		  BlockType		  Mux
		  Name			  "Mux20"
		  Ports			  [3, 1]
		  Position		  [195, 84, 200, 156]
		  NamePlacement		  "alternate"
		  ShowName		  off
		  Inputs		  "3"
		  DisplayOption		  "none"
		}
		Block {
		  BlockType		  Sum
		  Name			  "Qc"
		  Ports			  [2, 1]
		  Position		  [350, 114, 360, 221]
		  ShowName		  off
		  IconShape		  "rectangular"
		  Inputs		  "++"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Fcn
		  Name			  "Qess_case"
		  Position		  [235, 108, 315, 132]
		  NamePlacement		  "alternate"
		  FontName		  "Arial"
		  Expr			  "(u(2) - u(1))/u(3)"
		}
		Block {
		  BlockType		  Saturate
		  Name			  "Saturation3"
		  Position		  [190, 29, 200, 51]
		  Orientation		  "left"
		  ShowName		  off
		  UpperLimit		  "1"
		  LowerLimit		  "0"
		  LinearizeAsGain	  on
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Tair,ave"
		  Ports			  [1, 2, 1]
		  Position		  [30, 107, 140, 158]
		  ShowPortLabels	  on
		  TreatAsAtomicUnit	  on
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  System {
		    Name		    "Tair,ave"
		    Location		    [467, 91, 867, 319]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "Qess_case"
		    Position		    [45, 35, 65, 55]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    EnablePort
		    Name		    "Enable"
		    Ports		    []
		    Position		    [265, 167, 295, 193]
		    StatesWhenEnabling	    "reset"
		    ShowOutputPort	    off
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "Block NOTES"
		    Ports		    []
		    Position		    [325, 165, 381, 205]
		    BackgroundColor	    "green"
		    ShowName		    off
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    MaskDisplay		    "disp('Block\\nNOTES')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "autoscale"
		    System {
		    Name		    "Block NOTES"
		    Location		    [505, 510, 924, 573]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Annotation {
		    Position		    [207, 33]
		    Text		    "This block determins the average "
"temperature of the cooling air over the module."
		    }
		    }
		    }
		    Block {
		    BlockType		    Fcn
		    Name		    "Tamb-(Q/mcp)/2"
		    Position		    [90, 34, 330, 56]
		    Expr		    "amb_tmp - (u(1)/(ess_mod_airflow*"
"air_cp))/2 "
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "do ex calcs?1"
		    Position		    [35, 105, 115, 125]
		    ShowName		    off
		    Value		    "ess_th_res_on"
		    VectorParams1D	    on
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "Tair_ave"
		    Position		    [355, 35, 375, 55]
		    Port		    "1"
		    OutputWhenDisabled	    "reset"
		    InitialOutput	    "amb_tmp"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "Th Res"
		    Position		    [355, 105, 375, 125]
		    Port		    "2"
		    OutputWhenDisabled	    "reset"
		    InitialOutput	    "ess_th_res_off"
		    }
		    Line {
		    SrcBlock		    "do ex calcs?1"
		    SrcPort		    1
		    DstBlock		    "Th Res"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Qess_case"
		    SrcPort		    1
		    DstBlock		    "Tamb-(Q/mcp)/2"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Tamb-(Q/mcp)/2"
		    SrcPort		    1
		    DstBlock		    "Tair_ave"
		    DstPort		    1
		    }
		  }
		}
		Block {
		  BlockType		  Integrator
		  Name			  "Tess2"
		  Ports			  [1, 1]
		  Position		  [420, 155, 440, 175]
		  ExternalReset		  "none"
		  InitialConditionSource  "internal"
		  InitialCondition	  "ess_mod_init_tmp"
		  LimitOutput		  off
		  UpperSaturationLimit	  "inf"
		  LowerSaturationLimit	  "-inf"
		  ShowSaturationPort	  off
		  ShowStatePort		  off
		  AbsoluteTolerance	  "auto"
		}
		Block {
		  BlockType		  Fcn
		  Name			  "thermostat"
		  Position		  [235, 29, 340, 51]
		  Orientation		  "left"
		  NamePlacement		  "alternate"
		  FontName		  "Arial"
		  Expr			  "u(1) - ess_set_tmp"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Tess"
		  Position		  [470, 155, 490, 175]
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Tair"
		  Position		  [470, 60, 490, 80]
		  NamePlacement		  "alternate"
		  Port			  "2"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "[]"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Qair"
		  Position		  [470, 90, 490, 110]
		  Port			  "3"
		  OutputWhenDisabled	  "reset"
		  InitialOutput		  "0"
		}
		Line {
		  SrcBlock		  "Tair,ave"
		  SrcPort		  1
		  Points		  [10, 0]
		  Branch {
		    Points		    [0, -50]
		    DstBlock		    "Tair"
		    DstPort		    1
		  }
		  Branch {
		    DstBlock		    "Mux20"
		    DstPort		    2
		  }
		}
		Line {
		  SrcBlock		  "Tair,ave"
		  SrcPort		  2
		  DstBlock		  "Mux20"
		  DstPort		  3
		}
		Line {
		  SrcBlock		  "Mux20"
		  SrcPort		  1
		  DstBlock		  "Qess_case"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "#of mods"
		  SrcPort		  1
		  DstBlock		  "Qair"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Memory"
		  SrcPort		  1
		  Points		  [-230, 0]
		  DstBlock		  "Tair,ave"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Memory1"
		  SrcPort		  1
		  Points		  [-10, 0]
		  DstBlock		  "Tair,ave"
		  DstPort		  enable
		}
		Line {
		  SrcBlock		  "Saturation3"
		  SrcPort		  1
		  DstBlock		  "Memory1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "thermostat"
		  SrcPort		  1
		  DstBlock		  "Saturation3"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "1/#of mods"
		  SrcPort		  1
		  Points		  [210, 0]
		  DstBlock		  "Qc"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Qess_gen"
		  SrcPort		  1
		  DstBlock		  "1/#of mods"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Tess2"
		  SrcPort		  1
		  Points		  [0, 0]
		  Branch {
		    Points		    [0, -85; -80, 0]
		    Branch {
		    Points		    [0, -40]
		    DstBlock		    "thermostat"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [-185, 0]
		    DstBlock		    "Mux20"
		    DstPort		    1
		    }
		  }
		  Branch {
		    DstBlock		    "Tess"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "1/mcp"
		  SrcPort		  1
		  DstBlock		  "Tess2"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Qess_case"
		  SrcPort		  1
		  Points		  [5, 0]
		  Branch {
		    Points		    [0, -20]
		    DstBlock		    "#of mods"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, 55]
		    DstBlock		    "Memory"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [10, 0]
		    DstBlock		    "Qc"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "Qc"
		  SrcPort		  1
		  DstBlock		  "1/mcp"
		  DstPort		  1
		}
	      }
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "max pack\npwr (W)"
	      Ports		      [1, 1]
	      Position		      [635, 285, 665, 315]
	      ShowPortLabels	      off
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"max pack\npwr (W)"
		Location		[498, 540, 953, 677]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "SOC"
		  Position		  [35, 43, 65, 57]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Gain
		  Name			  "# batteries"
		  Position		  [245, 35, 295, 65]
		  Gain			  "ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Lookup
		  Name			  "max power"
		  Position		  [165, 35, 195, 65]
		  InputValues		  "ess_max_p_soc"
		  OutputValues		  "ess_max_p"
		}
		Block {
		  BlockType		  Outport
		  Name			  "ess\ndischarge\npwr"
		  Position		  [355, 40, 375, 60]
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Line {
		  SrcBlock		  "# batteries"
		  SrcPort		  1
		  DstBlock		  "ess\ndischarge\npwr"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "max power"
		  SrcPort		  1
		  DstBlock		  "# batteries"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "SOC"
		  SrcPort		  1
		  DstBlock		  "max power"
		  DstPort		  1
		}
	      }
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "pzero"
	      Position		      [240, 206, 270, 224]
	      Value		      "0"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "soc"
	      Position		      [185, 182, 220, 198]
	      Value		      ".01"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "stop sim"
	      Ports		      [1, 0, 1]
	      Position		      [855, 249, 915, 281]
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      on
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"stop sim"
		Location		[425, 256, 821, 466]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "SOC"
		  Position		  [75, 85, 95, 105]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  EnablePort
		  Name			  "Enable"
		  Ports			  []
		  Position		  [170, 25, 190, 45]
		  StatesWhenEnabling	  "held"
		  ShowOutputPort	  off
		}
		Block {
		  BlockType		  Constant
		  Name			  "Const"
		  Position		  [95, 145, 165, 165]
		  Orientation		  "up"
		  ShowName		  off
		  FontName		  "Arial"
		  Value			  "0.1"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  RelationalOperator
		  Name			  "Relational\nOperator"
		  Position		  [185, 88, 215, 112]
		  Operator		  "<"
		}
		Block {
		  BlockType		  Stop
		  Name			  "Stop Simulation"
		  Position		  [255, 83, 295, 117]
		}
		Line {
		  SrcBlock		  "Relational\nOperator"
		  SrcPort		  1
		  DstBlock		  "Stop Simulation"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "SOC"
		  SrcPort		  1
		  DstBlock		  "Relational\nOperator"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Const"
		  SrcPort		  1
		  Points		  [0, -35]
		  DstBlock		  "Relational\nOperator"
		  DstPort		  2
		}
	      }
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "power available\nto bus (W)"
	      Position		      [870, 85, 890, 105]
	      FontName		      "Arial"
	      Port		      "1"
	      OutputWhenDisabled      "held"
	      InitialOutput	      "0"
	    }
	    Line {
	      SrcBlock		      "ess tmp"
	      SrcPort		      1
	      Points		      [0, 0]
	      Branch {
		Points			[0, -45; -250, 0]
		DstBlock		"Temp (in C)"
		DstPort			1
	      }
	      Branch {
		DstBlock		"To WS2"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "ess tmp"
	      SrcPort		      3
	      DstBlock		      "To WS4"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "ess tmp"
	      SrcPort		      2
	      DstBlock		      "To WS3"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "do ess calcs?"
	      SrcPort		      1
	      DstBlock		      "ess tmp"
	      DstPort		      enable
	    }
	    Line {
	      SrcBlock		      "Demux"
	      SrcPort		      6
	      Points		      [0, 265; 90, 0]
	      Branch {
		DstBlock		"To WS1"
		DstPort			1
	      }
	      Branch {
		DstBlock		"ess tmp"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "max pack\npwr (W)"
	      SrcPort		      1
	      DstBlock		      "Goto <cs>1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Const"
	      SrcPort		      1
	      DstBlock		      "stop sim"
	      DstPort		      enable
	    }
	    Line {
	      SrcBlock		      "Sum1"
	      SrcPort		      1
	      DstBlock		      "Mux"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "C->K"
	      SrcPort		      1
	      Points		      [10, 0]
	      DstBlock		      "Sum1"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Temp (in C)"
	      SrcPort		      1
	      DstBlock		      "Sum1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Memory1"
	      SrcPort		      1
	      Points		      [15, 0; 0, 5]
	      Branch {
		DstBlock		"Goto <sdo>, <cs>"
		DstPort			1
	      }
	      Branch {
		Points			[0, 25]
		Branch {
		  Points		  [10, 0]
		  Branch {
		    Points		    [0, 35]
		    DstBlock		    "max pack\npwr (W)"
		    DstPort		    1
		  }
		  Branch {
		    DstBlock		    "stop sim"
		    DstPort		    1
		  }
		}
		Branch {
		  Points		  [-425, 0; 0, -90]
		  DstBlock		  "Relational\nOperator"
		  DstPort		  1
		}
	      }
	    }
	    Line {
	      SrcBlock		      "Memory"
	      SrcPort		      1
	      Points		      [5, 0]
	      Branch {
		DstBlock		"Goto <mc>, <gc>, <sdo>"
		DstPort			1
	      }
	      Branch {
		DstBlock		"To Workspace11"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Demux"
	      SrcPort		      3
	      DstBlock		      "# batteries1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "# batteries1"
	      SrcPort		      1
	      DstBlock		      "Memory"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "# batteries"
	      SrcPort		      1
	      Points		      [45, 0]
	      Branch {
		DstBlock		"power available\nto bus (W)"
		DstPort			1
	      }
	      Branch {
		DstBlock		"To Workspace9"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Demux"
	      SrcPort		      1
	      Points		      [0, -45]
	      DstBlock		      "Terminator1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Switch"
	      SrcPort		      1
	      Points		      [35, 0; 0, -25]
	      DstBlock		      "Mux"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "1/# batteries"
	      SrcPort		      1
	      Points		      [45, 0]
	      DstBlock		      "Switch"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "soc"
	      SrcPort		      1
	      DstBlock		      "Relational\nOperator"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Relational\nOperator"
	      SrcPort		      1
	      Points		      [0, -20]
	      DstBlock		      "Switch"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "pzero"
	      SrcPort		      1
	      DstBlock		      "Switch"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "power req'd\ninto bus (W)"
	      SrcPort		      1
	      Points		      [95, 0]
	      Branch {
		DstBlock		"1/# batteries"
		DstPort			1
	      }
	      Branch {
		DstBlock		"To Workspace8"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Clock"
	      SrcPort		      1
	      Points		      [45, 0]
	      DstBlock		      "Mux"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux"
	      SrcPort		      2
	      Points		      [30, 0]
	      DstBlock		      "# batteries"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux"
	      SrcPort		      4
	      Points		      [35, 0]
	      DstBlock		      "To Workspace10"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux"
	      SrcPort		      5
	      Points		      [20, 0]
	      DstBlock		      "Memory1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Discharge Model\nOutputs:\nPreq(W)\nPav"
"ail (W)\nVoltage (V)\nCurrent (A)\nSOC\nHeat Gen (W)"
	      SrcPort		      1
	      DstBlock		      "Demux"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Mux"
	      SrcPort		      1
	      DstBlock		      "Discharge Model\nOutputs:\nPreq(W)\nPav"
"ail (W)\nVoltage (V)\nCurrent (A)\nSOC\nHeat Gen (W)"
	      DstPort		      1
	    }
	  }
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "energy storage <ess>\noptima\nfundamental m"
"odel"
	  Ports			  [1, 1]
	  Position		  [265, 348, 330, 392]
	  ForegroundColor	  "magenta"
	  ShowPortLabels	  off
	  TreatAsAtomicUnit	  off
	  RTWSystemCode		  "Auto"
	  RTWFcnNameOpts	  "Auto"
	  RTWFileNameOpts	  "Auto"
	  MaskDisplay		  "image(imread('bdi_ess.jpg'))"
	  MaskIconFrame		  on
	  MaskIconOpaque	  on
	  MaskIconRotate	  "none"
	  MaskIconUnits		  "autoscale"
	  System {
	    Name		    "energy storage <ess>\noptima\nfundamental"
" model"
	    Location		    [32, 173, 1022, 676]
	    Open		    off
	    ModelBrowserVisibility  off
	    ModelBrowserWidth	    200
	    ScreenColor		    "white"
	    PaperOrientation	    "landscape"
	    PaperPositionMode	    "auto"
	    PaperType		    "usletter"
	    PaperUnits		    "inches"
	    ZoomFactor		    "100"
	    Block {
	      BlockType		      Inport
	      Name		      "power req'd\ninto bus (W)"
	      Position		      [35, 130, 55, 150]
	      FontName		      "Arial"
	      Port		      "1"
	      LatchInput	      off
	      Interpolate	      on
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "# batteries"
	      Position		      [570, 85, 620, 105]
	      Gain		      "ess_module_num"
	      Multiplication	      "Element-wise(K.*u)"
	      SaturateOnIntegerOverflow	on
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "# batteries1"
	      Position		      [625, 126, 675, 144]
	      Gain		      "ess_module_num"
	      Multiplication	      "Element-wise(K.*u)"
	      SaturateOnIntegerOverflow	on
	    }
	    Block {
	      BlockType		      Gain
	      Name		      "1/# batteries"
	      Position		      [175, 125, 225, 155]
	      Gain		      "1/ess_module_num"
	      Multiplication	      "Element-wise(K.*u)"
	      SaturateOnIntegerOverflow	on
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "Block NOTES"
	      Ports		      []
	      Position		      [860, 420, 916, 460]
	      BackgroundColor	      "green"
	      ShowName		      off
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      MaskDisplay	      "disp('Block\\nNOTES')"
	      MaskIconFrame	      on
	      MaskIconOpaque	      on
	      MaskIconRotate	      "none"
	      MaskIconUnits	      "autoscale"
	      System {
		Name			"Block NOTES"
		Location		[211, 187, 723, 361]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Annotation {
		  Position		  [256, 77]
		  Text			  "Fundamentally based SOC model devel"
"oped at BYU\nFiles needed:\ninput1.dat\ninput2.dat\ninput3.dat\nnrel13cs.dll"
		}
	      }
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "C->K"
	      Position		      [375, 331, 405, 349]
	      Value		      "273"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Clock
	      Name		      "Clock"
	      Position		      [300, 90, 320, 110]
	      DisplayTime	      off
	      Decimation	      "10"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "Const"
	      Position		      [850, 215, 920, 235]
	      Orientation	      "down"
	      ShowName		      off
	      FontName		      "Arial"
	      Value		      "enable_stop"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Demux
	      Name		      "Demux"
	      Ports		      [1, 6]
	      Position		      [500, 105, 520, 175]
	      ShowName		      off
	      Outputs		      "6"
	      BusSelectionMode	      off
	    }
	    Block {
	      BlockType		      MATLABFcn
	      Name		      "Discharge Model\nOutputs:\nPreq(W)\nPav"
"ail (W)\nVoltage (V)\nCurrent (A)\nSOC\nHeat Gen (W)"
	      Position		      [415, 125, 475, 155]
	      MATLABFcn		      "fund_byuop(u(2),u(1)+t_soc,1,u(3))"
	      OutputDimensions	      "-1"
	      OutputSignalType	      "auto"
	      Output1D		      on
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <cs>1"
	      Position		      [700, 290, 780, 310]
	      GotoTag		      "ess_max_pwr"
	      TagVisibility	      "global"
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <mc>, <gc>, <sdo>"
	      Position		      [750, 170, 830, 190]
	      GotoTag		      "bus_voltage"
	      TagVisibility	      "global"
	    }
	    Block {
	      BlockType		      Goto
	      Name		      "Goto <sdo>, <cs>"
	      Position		      [645, 229, 690, 251]
	      GotoTag		      "SOC"
	      TagVisibility	      "global"
	    }
	    Block {
	      BlockType		      Memory
	      Name		      "Memory"
	      Position		      [695, 120, 725, 150]
	      ShowName		      off
	      X0		      "12*ess_module_num"
	      InheritSampleTime	      off
	      RTWStateStorageClass    "Auto"
	    }
	    Block {
	      BlockType		      Memory
	      Name		      "Memory1"
	      Position		      [560, 220, 585, 250]
	      ShowName		      off
	      X0		      "ess_init_soc"
	      InheritSampleTime	      off
	      RTWStateStorageClass    "Auto"
	    }
	    Block {
	      BlockType		      Mux
	      Name		      "Mux"
	      Ports		      [3, 1]
	      Position		      [385, 112, 400, 168]
	      ShowName		      off
	      Inputs		      "3"
	      DisplayOption	      "none"
	    }
	    Block {
	      BlockType		      RelationalOperator
	      Name		      "Relational\nOperator"
	      Position		      [235, 167, 265, 198]
	      ShowName		      off
	      Operator		      ">"
	    }
	    Block {
	      BlockType		      Sum
	      Name		      "Sum1"
	      Ports		      [2, 1]
	      Position		      [375, 282, 405, 313]
	      Orientation	      "left"
	      IconShape		      "rectangular"
	      Inputs		      "++"
	      SaturateOnIntegerOverflow	on
	    }
	    Block {
	      BlockType		      Switch
	      Name		      "Switch"
	      Position		      [290, 150, 320, 180]
	      ShowName		      off
	      Threshold		      "eps"
	    }
	    Block {
	      BlockType		      Memory
	      Name		      "Temp (in C)"
	      Position		      [445, 275, 470, 305]
	      Orientation	      "left"
	      X0		      "amb_tmp"
	      InheritSampleTime	      off
	      RTWStateStorageClass    "Auto"
	    }
	    Block {
	      BlockType		      Terminator
	      Name		      "Terminator1"
	      Position		      [545, 60, 565, 80]
	      ShowName		      off
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS1"
	      Position		      [574, 460, 656, 475]
	      Orientation	      "down"
	      NamePlacement	      "alternate"
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_pwr_loss_a"
	      MaxDataPoints	      "50000"
	      Decimation	      "1"
	      SampleTime	      "0"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS2"
	      Position		      [750, 403, 820, 417]
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_mod_tmp"
	      MaxDataPoints	      "50000"
	      Decimation	      "1"
	      SampleTime	      "0"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS3"
	      Position		      [750, 423, 820, 437]
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_air_tmp"
	      MaxDataPoints	      "50000"
	      Decimation	      "1"
	      SampleTime	      "0"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To WS4"
	      Position		      [750, 444, 825, 456]
	      ShowName		      off
	      FontName		      "Arial"
	      VariableName	      "ess_air_th_pwr"
	      MaxDataPoints	      "50000"
	      Decimation	      "1"
	      SampleTime	      "0"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To Workspace10"
	      Position		      [575, 177, 640, 203]
	      ShowName		      off
	      VariableName	      "ess_current"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "-1"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To Workspace11"
	      Position		      [755, 124, 830, 146]
	      VariableName	      "ess_voltage"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "-1"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To Workspace8"
	      Position		      [70, 185, 140, 205]
	      Orientation	      "left"
	      VariableName	      "ess_pwr_out_r"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "-1"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      ToWorkspace
	      Name		      "To Workspace9"
	      Position		      [685, 49, 760, 71]
	      ShowName		      off
	      VariableName	      "ess_pwr_out_a"
	      MaxDataPoints	      "inf"
	      Decimation	      "1"
	      SampleTime	      "-1"
	      SaveFormat	      "Array"
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "do ess calcs?"
	      Position		      [655, 375, 715, 390]
	      Orientation	      "down"
	      ShowName		      off
	      Value		      "ess_th_calc"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "ess tmp"
	      Ports		      [1, 3, 1]
	      Position		      [640, 403, 730, 457]
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      on
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"ess tmp"
		Location		[431, 254, 962, 524]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "Qess_gen"
		  Position		  [25, 205, 45, 225]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  EnablePort
		  Name			  "Enable"
		  Ports			  []
		  Position		  [390, 217, 420, 243]
		  StatesWhenEnabling	  "reset"
		  ShowOutputPort	  off
		}
		Block {
		  BlockType		  Gain
		  Name			  "#of mods"
		  Position		  [390, 88, 415, 112]
		  Gain			  "ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Gain
		  Name			  "1/#of mods"
		  Position		  [95, 203, 120, 227]
		  Gain			  "1/ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Gain
		  Name			  "1/mcp"
		  Position		  [380, 153, 405, 177]
		  Gain			  "1/(ess_module_mass*ess_mod_cp)"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Block NOTES"
		  Ports			  []
		  Position		  [445, 220, 501, 260]
		  BackgroundColor	  "green"
		  ShowName		  off
		  ShowPortLabels	  on
		  TreatAsAtomicUnit	  off
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  MaskDisplay		  "disp('Block\\nNOTES')"
		  MaskIconFrame		  on
		  MaskIconOpaque	  on
		  MaskIconRotate	  "none"
		  MaskIconUnits		  "autoscale"
		  System {
		    Name		    "Block NOTES"
		    Location		    [505, 510, 924, 573]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Annotation {
		    Position		    [207, 33]
		    Text		    "This block models the thermal beh"
"avior of a battery module with active air cooling.\nThe module is modeled as "
"a single lumped thermal mass.  \nThe fan is on whenever the battery temp is >"
" the set temp."
		    }
		  }
		}
		Block {
		  BlockType		  Memory
		  Name			  "Memory"
		  Position		  [250, 165, 285, 185]
		  Orientation		  "left"
		  FontName		  "Arial"
		  X0			  "cyc_mph(1,2)*.447"
		  InheritSampleTime	  off
		  RTWStateStorageClass	  "Auto"
		}
		Block {
		  BlockType		  Memory
		  Name			  "Memory1"
		  Position		  [100, 30, 135, 50]
		  Orientation		  "left"
		  FontName		  "Arial"
		  X0			  "cyc_mph(1,2)*.447"
		  InheritSampleTime	  off
		  RTWStateStorageClass	  "Auto"
		}
		Block {
		  BlockType		  Mux
		  Name			  "Mux20"
		  Ports			  [3, 1]
		  Position		  [195, 84, 200, 156]
		  NamePlacement		  "alternate"
		  ShowName		  off
		  Inputs		  "3"
		  DisplayOption		  "none"
		}
		Block {
		  BlockType		  Sum
		  Name			  "Qc"
		  Ports			  [2, 1]
		  Position		  [350, 114, 360, 221]
		  ShowName		  off
		  IconShape		  "rectangular"
		  Inputs		  "++"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Fcn
		  Name			  "Qess_case"
		  Position		  [235, 108, 315, 132]
		  NamePlacement		  "alternate"
		  FontName		  "Arial"
		  Expr			  "(u(2) - u(1))/u(3)"
		}
		Block {
		  BlockType		  Saturate
		  Name			  "Saturation3"
		  Position		  [190, 29, 200, 51]
		  Orientation		  "left"
		  ShowName		  off
		  UpperLimit		  "1"
		  LowerLimit		  "0"
		  LinearizeAsGain	  on
		}
		Block {
		  BlockType		  SubSystem
		  Name			  "Tair,ave"
		  Ports			  [1, 2, 1]
		  Position		  [30, 107, 140, 158]
		  ShowPortLabels	  on
		  TreatAsAtomicUnit	  on
		  RTWSystemCode		  "Auto"
		  RTWFcnNameOpts	  "Auto"
		  RTWFileNameOpts	  "Auto"
		  System {
		    Name		    "Tair,ave"
		    Location		    [467, 91, 867, 319]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Block {
		    BlockType		    Inport
		    Name		    "Qess_case"
		    Position		    [45, 35, 65, 55]
		    Port		    "1"
		    LatchInput		    off
		    Interpolate		    on
		    }
		    Block {
		    BlockType		    EnablePort
		    Name		    "Enable"
		    Ports		    []
		    Position		    [265, 167, 295, 193]
		    StatesWhenEnabling	    "reset"
		    ShowOutputPort	    off
		    }
		    Block {
		    BlockType		    SubSystem
		    Name		    "Block NOTES"
		    Ports		    []
		    Position		    [325, 165, 381, 205]
		    BackgroundColor	    "green"
		    ShowName		    off
		    ShowPortLabels	    on
		    TreatAsAtomicUnit	    off
		    RTWSystemCode	    "Auto"
		    RTWFcnNameOpts	    "Auto"
		    RTWFileNameOpts	    "Auto"
		    MaskDisplay		    "disp('Block\\nNOTES')"
		    MaskIconFrame	    on
		    MaskIconOpaque	    on
		    MaskIconRotate	    "none"
		    MaskIconUnits	    "autoscale"
		    System {
		    Name		    "Block NOTES"
		    Location		    [505, 510, 924, 573]
		    Open		    off
		    ModelBrowserVisibility  off
		    ModelBrowserWidth	    200
		    ScreenColor		    "white"
		    PaperOrientation	    "landscape"
		    PaperPositionMode	    "auto"
		    PaperType		    "usletter"
		    PaperUnits		    "inches"
		    ZoomFactor		    "100"
		    Annotation {
		    Position		    [207, 33]
		    Text		    "This block determins the average "
"temperature of the cooling air over the module."
		    }
		    }
		    }
		    Block {
		    BlockType		    Fcn
		    Name		    "Tamb-(Q/mcp)/2"
		    Position		    [90, 34, 330, 56]
		    Expr		    "amb_tmp - (u(1)/(ess_mod_airflow*"
"air_cp))/2 "
		    }
		    Block {
		    BlockType		    Constant
		    Name		    "do ex calcs?1"
		    Position		    [35, 105, 115, 125]
		    ShowName		    off
		    Value		    "ess_th_res_on"
		    VectorParams1D	    on
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "Tair_ave"
		    Position		    [355, 35, 375, 55]
		    Port		    "1"
		    OutputWhenDisabled	    "reset"
		    InitialOutput	    "amb_tmp"
		    }
		    Block {
		    BlockType		    Outport
		    Name		    "Th Res"
		    Position		    [355, 105, 375, 125]
		    Port		    "2"
		    OutputWhenDisabled	    "reset"
		    InitialOutput	    "ess_th_res_off"
		    }
		    Line {
		    SrcBlock		    "do ex calcs?1"
		    SrcPort		    1
		    DstBlock		    "Th Res"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Qess_case"
		    SrcPort		    1
		    DstBlock		    "Tamb-(Q/mcp)/2"
		    DstPort		    1
		    }
		    Line {
		    SrcBlock		    "Tamb-(Q/mcp)/2"
		    SrcPort		    1
		    DstBlock		    "Tair_ave"
		    DstPort		    1
		    }
		  }
		}
		Block {
		  BlockType		  Integrator
		  Name			  "Tess2"
		  Ports			  [1, 1]
		  Position		  [420, 155, 440, 175]
		  ExternalReset		  "none"
		  InitialConditionSource  "internal"
		  InitialCondition	  "ess_mod_init_tmp"
		  LimitOutput		  off
		  UpperSaturationLimit	  "inf"
		  LowerSaturationLimit	  "-inf"
		  ShowSaturationPort	  off
		  ShowStatePort		  off
		  AbsoluteTolerance	  "auto"
		}
		Block {
		  BlockType		  Fcn
		  Name			  "thermostat"
		  Position		  [235, 29, 340, 51]
		  Orientation		  "left"
		  NamePlacement		  "alternate"
		  FontName		  "Arial"
		  Expr			  "u(1) - ess_set_tmp"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Tess"
		  Position		  [470, 155, 490, 175]
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Tair"
		  Position		  [470, 60, 490, 80]
		  NamePlacement		  "alternate"
		  Port			  "2"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "[]"
		}
		Block {
		  BlockType		  Outport
		  Name			  "Qair"
		  Position		  [470, 90, 490, 110]
		  Port			  "3"
		  OutputWhenDisabled	  "reset"
		  InitialOutput		  "0"
		}
		Line {
		  SrcBlock		  "Tair,ave"
		  SrcPort		  1
		  Points		  [10, 0]
		  Branch {
		    Points		    [0, -50]
		    DstBlock		    "Tair"
		    DstPort		    1
		  }
		  Branch {
		    DstBlock		    "Mux20"
		    DstPort		    2
		  }
		}
		Line {
		  SrcBlock		  "Tair,ave"
		  SrcPort		  2
		  DstBlock		  "Mux20"
		  DstPort		  3
		}
		Line {
		  SrcBlock		  "Mux20"
		  SrcPort		  1
		  DstBlock		  "Qess_case"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "#of mods"
		  SrcPort		  1
		  DstBlock		  "Qair"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Memory"
		  SrcPort		  1
		  Points		  [-230, 0]
		  DstBlock		  "Tair,ave"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Memory1"
		  SrcPort		  1
		  Points		  [-10, 0]
		  DstBlock		  "Tair,ave"
		  DstPort		  enable
		}
		Line {
		  SrcBlock		  "Saturation3"
		  SrcPort		  1
		  DstBlock		  "Memory1"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "thermostat"
		  SrcPort		  1
		  DstBlock		  "Saturation3"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "1/#of mods"
		  SrcPort		  1
		  Points		  [210, 0]
		  DstBlock		  "Qc"
		  DstPort		  2
		}
		Line {
		  SrcBlock		  "Qess_gen"
		  SrcPort		  1
		  DstBlock		  "1/#of mods"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Tess2"
		  SrcPort		  1
		  Points		  [0, 0]
		  Branch {
		    Points		    [0, -85; -80, 0]
		    Branch {
		    Points		    [0, -40]
		    DstBlock		    "thermostat"
		    DstPort		    1
		    }
		    Branch {
		    Points		    [-185, 0]
		    DstBlock		    "Mux20"
		    DstPort		    1
		    }
		  }
		  Branch {
		    DstBlock		    "Tess"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "1/mcp"
		  SrcPort		  1
		  DstBlock		  "Tess2"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Qess_case"
		  SrcPort		  1
		  Points		  [5, 0]
		  Branch {
		    Points		    [0, -20]
		    DstBlock		    "#of mods"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [0, 55]
		    DstBlock		    "Memory"
		    DstPort		    1
		  }
		  Branch {
		    Points		    [10, 0]
		    DstBlock		    "Qc"
		    DstPort		    1
		  }
		}
		Line {
		  SrcBlock		  "Qc"
		  SrcPort		  1
		  DstBlock		  "1/mcp"
		  DstPort		  1
		}
	      }
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "max pack\npwr (W)"
	      Ports		      [1, 1]
	      Position		      [635, 285, 665, 315]
	      ShowPortLabels	      off
	      TreatAsAtomicUnit	      off
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"max pack\npwr (W)"
		Location		[498, 540, 953, 677]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "SOC"
		  Position		  [35, 43, 65, 57]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  Gain
		  Name			  "# batteries"
		  Position		  [245, 35, 295, 65]
		  Gain			  "ess_module_num"
		  Multiplication	  "Element-wise(K.*u)"
		  SaturateOnIntegerOverflow on
		}
		Block {
		  BlockType		  Lookup
		  Name			  "max power"
		  Position		  [165, 35, 195, 65]
		  InputValues		  "ess_max_p_soc"
		  OutputValues		  "ess_max_p"
		}
		Block {
		  BlockType		  Outport
		  Name			  "ess\ndischarge\npwr"
		  Position		  [355, 40, 375, 60]
		  Port			  "1"
		  OutputWhenDisabled	  "held"
		  InitialOutput		  "0"
		}
		Line {
		  SrcBlock		  "# batteries"
		  SrcPort		  1
		  DstBlock		  "ess\ndischarge\npwr"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "max power"
		  SrcPort		  1
		  DstBlock		  "# batteries"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "SOC"
		  SrcPort		  1
		  DstBlock		  "max power"
		  DstPort		  1
		}
	      }
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "pzero"
	      Position		      [240, 206, 270, 224]
	      Value		      "0"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      Constant
	      Name		      "soc"
	      Position		      [185, 182, 220, 198]
	      Value		      ".01"
	      VectorParams1D	      on
	    }
	    Block {
	      BlockType		      SubSystem
	      Name		      "stop sim"
	      Ports		      [1, 0, 1]
	      Position		      [855, 249, 915, 281]
	      ShowPortLabels	      on
	      TreatAsAtomicUnit	      on
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	      System {
		Name			"stop sim"
		Location		[423, 258, 819, 468]
		Open			off
		ModelBrowserVisibility	off
		ModelBrowserWidth	200
		ScreenColor		"white"
		PaperOrientation	"landscape"
		PaperPositionMode	"auto"
		PaperType		"usletter"
		PaperUnits		"inches"
		ZoomFactor		"100"
		Block {
		  BlockType		  Inport
		  Name			  "SOC"
		  Position		  [75, 85, 95, 105]
		  Port			  "1"
		  LatchInput		  off
		  Interpolate		  on
		}
		Block {
		  BlockType		  EnablePort
		  Name			  "Enable"
		  Ports			  []
		  Position		  [170, 25, 190, 45]
		  StatesWhenEnabling	  "held"
		  ShowOutputPort	  off
		}
		Block {
		  BlockType		  Constant
		  Name			  "Const"
		  Position		  [95, 145, 165, 165]
		  Orientation		  "up"
		  ShowName		  off
		  FontName		  "Arial"
		  Value			  ".001"
		  VectorParams1D	  on
		}
		Block {
		  BlockType		  RelationalOperator
		  Name			  "Relational\nOperator"
		  Position		  [185, 88, 215, 112]
		  Operator		  "<"
		}
		Block {
		  BlockType		  Stop
		  Name			  "Stop Simulation"
		  Position		  [255, 83, 295, 117]
		}
		Line {
		  SrcBlock		  "Relational\nOperator"
		  SrcPort		  1
		  DstBlock		  "Stop Simulation"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "SOC"
		  SrcPort		  1
		  DstBlock		  "Relational\nOperator"
		  DstPort		  1
		}
		Line {
		  SrcBlock		  "Const"
		  SrcPort		  1
		  Points		  [0, -35]
		  DstBlock		  "Relational\nOperator"
		  DstPort		  2
		}
	      }
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "power available\nto bus (W)"
	      Position		      [870, 85, 890, 105]
	      FontName		      "Arial"
	      Port		      "1"
	      OutputWhenDisabled      "held"
	      InitialOutput	      "0"
	    }
	    Line {
	      SrcBlock		      "ess tmp"
	      SrcPort		      1
	      Points		      [0, 0]
	      Branch {
		Points			[0, -45; -250, 0]
		DstBlock		"Temp (in C)"
		DstPort			1
	      }
	      Branch {
		DstBlock		"To WS2"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "ess tmp"
	      SrcPort		      3
	      DstBlock		      "To WS4"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "ess tmp"
	      SrcPort		      2
	      DstBlock		      "To WS3"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "do ess calcs?"
	      SrcPort		      1
	      DstBlock		      "ess tmp"
	      DstPort		      enable
	    }
	    Line {
	      SrcBlock		      "Demux"
	      SrcPort		      6
	      Points		      [0, 265; 90, 0]
	      Branch {
		DstBlock		"To WS1"
		DstPort			1
	      }
	      Branch {
		DstBlock		"ess tmp"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "max pack\npwr (W)"
	      SrcPort		      1
	      DstBlock		      "Goto <cs>1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Const"
	      SrcPort		      1
	      DstBlock		      "stop sim"
	      DstPort		      enable
	    }
	    Line {
	      SrcBlock		      "Sum1"
	      SrcPort		      1
	      DstBlock		      "Mux"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "C->K"
	      SrcPort		      1
	      Points		      [10, 0]
	      DstBlock		      "Sum1"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Temp (in C)"
	      SrcPort		      1
	      DstBlock		      "Sum1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Memory1"
	      SrcPort		      1
	      Points		      [15, 0; 0, 5]
	      Branch {
		DstBlock		"Goto <sdo>, <cs>"
		DstPort			1
	      }
	      Branch {
		Points			[0, 25]
		Branch {
		  Points		  [10, 0]
		  Branch {
		    Points		    [0, 35]
		    DstBlock		    "max pack\npwr (W)"
		    DstPort		    1
		  }
		  Branch {
		    DstBlock		    "stop sim"
		    DstPort		    1
		  }
		}
		Branch {
		  Points		  [-425, 0; 0, -90]
		  DstBlock		  "Relational\nOperator"
		  DstPort		  1
		}
	      }
	    }
	    Line {
	      SrcBlock		      "Memory"
	      SrcPort		      1
	      Points		      [5, 0]
	      Branch {
		DstBlock		"Goto <mc>, <gc>, <sdo>"
		DstPort			1
	      }
	      Branch {
		DstBlock		"To Workspace11"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Demux"
	      SrcPort		      3
	      DstBlock		      "# batteries1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "# batteries1"
	      SrcPort		      1
	      DstBlock		      "Memory"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "# batteries"
	      SrcPort		      1
	      Points		      [45, 0]
	      Branch {
		DstBlock		"power available\nto bus (W)"
		DstPort			1
	      }
	      Branch {
		DstBlock		"To Workspace9"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Demux"
	      SrcPort		      1
	      Points		      [0, -45]
	      DstBlock		      "Terminator1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Switch"
	      SrcPort		      1
	      Points		      [35, 0; 0, -25]
	      DstBlock		      "Mux"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "1/# batteries"
	      SrcPort		      1
	      Points		      [45, 0]
	      DstBlock		      "Switch"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "soc"
	      SrcPort		      1
	      DstBlock		      "Relational\nOperator"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "Relational\nOperator"
	      SrcPort		      1
	      Points		      [0, -20]
	      DstBlock		      "Switch"
	      DstPort		      2
	    }
	    Line {
	      SrcBlock		      "pzero"
	      SrcPort		      1
	      DstBlock		      "Switch"
	      DstPort		      3
	    }
	    Line {
	      SrcBlock		      "power req'd\ninto bus (W)"
	      SrcPort		      1
	      Points		      [95, 0]
	      Branch {
		DstBlock		"1/# batteries"
		DstPort			1
	      }
	      Branch {
		DstBlock		"To Workspace8"
		DstPort			1
	      }
	    }
	    Line {
	      SrcBlock		      "Clock"
	      SrcPort		      1
	      Points		      [45, 0]
	      DstBlock		      "Mux"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux"
	      SrcPort		      2
	      Points		      [30, 0]
	      DstBlock		      "# batteries"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux"
	      SrcPort		      4
	      Points		      [35, 0]
	      DstBlock		      "To Workspace10"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Demux"
	      SrcPort		      5
	      Points		      [20, 0]
	      DstBlock		      "Memory1"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Discharge Model\nOutputs:\nPreq(W)\nPav"
"ail (W)\nVoltage (V)\nCurrent (A)\nSOC\nHeat Gen (W)"
	      SrcPort		      1
	      DstBlock		      "Demux"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Mux"
	      SrcPort		      1
	      DstBlock		      "Discharge Model\nOutputs:\nPreq(W)\nPav"
"ail (W)\nVoltage (V)\nCurrent (A)\nSOC\nHeat Gen (W)"
	      DstPort		      1
	    }
	  }
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "ess config"
	  Ports			  [1, 1]
	  Position		  [45, 21, 125, 69]
	  ShowName		  off
	  ShowPortLabels	  off
	  BlockChoice		  "Ultracapacitor  System"
	  TemplateBlock		  "self"
	  MemberBlocks		  "Ultracapacitor  System,energy storage <ess>"
",energy storage <ess> RC,energy storage <ess> nnet,energy storage <ess> Saber"
",energy storage <ess> fundamental model,energy storage <ess> optima fundament"
"al model"
	  TreatAsAtomicUnit	  off
	  RTWSystemCode		  "Auto"
	  RTWFcnNameOpts	  "Auto"
	  RTWFileNameOpts	  "Auto"
	  System {
	    Name		    "ess config"
	    Location		    [148, 182, 646, 482]
	    Open		    off
	    ModelBrowserVisibility  off
	    ModelBrowserWidth	    200
	    ScreenColor		    "white"
	    PaperOrientation	    "landscape"
	    PaperPositionMode	    "auto"
	    PaperType		    "usletter"
	    PaperUnits		    "inches"
	    ZoomFactor		    "100"
	    Block {
	      BlockType		      Inport
	      Name		      "power req'd\ninto bus (W)"
	      Position		      [20, 40, 40, 60]
	      Port		      "1"
	      LatchInput	      off
	      Interpolate	      on
	    }
	    Block {
	      BlockType		      Reference
	      Name		      "Ultracapacitor\n System"
	      Ports		      [1, 1]
	      Position		      [100, 40, 140, 80]
	      SourceBlock	      "lib_energy_storage/Subsystem/Ultracapac"
"itor\n System"
	      SourceType	      "SubSystem"
	      ShowPortLabels	      "off"
	      TreatAsAtomicUnit	      "off"
	      RTWSystemCode	      "Auto"
	      RTWFcnNameOpts	      "Auto"
	      RTWFileNameOpts	      "Auto"
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "power available\nto bus (W)"
	      Position		      [200, 40, 220, 60]
	      Port		      "1"
	      OutputWhenDisabled      "held"
	      InitialOutput	      "[]"
	    }
	    Line {
	      SrcBlock		      "power req'd\ninto bus (W)"
	      SrcPort		      1
	      Points		      [20, 0; 0, 10]
	      DstBlock		      "Ultracapacitor\n System"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Ultracapacitor\n System"
	      SrcPort		      1
	      Points		      [20, 0; 0, -10]
	      DstBlock		      "power available\nto bus (W)"
	      DstPort		      1
	    }
	  }
	}
	Annotation {
	  Position		  [56, 197]
	  Text			  "Nnet"
	}
	Annotation {
	  Position		  [76, 321]
	  Text			  "Fundamental"
	}
	Annotation {
	  Position		  [91, 461]
	  Text			  "Saber Cosim"
	}
      }
    }
    Block {
      BlockType		      SubSystem
      Name		      "energy\nstorage <ess>"
      Ports		      [1, 1]
      Position		      [65, 83, 130, 127]
      BackgroundColor	      "yellow"
      AncestorBlock	      "lib_energy_storage/Subsystem/energy\nstorage <e"
"ss>"
      ShowPortLabels	      off
      TreatAsAtomicUnit	      off
      RTWSystemCode	      "Auto"
      RTWFcnNameOpts	      "Auto"
      RTWFileNameOpts	      "Auto"
      MaskDisplay	      "image(imread('bdi_ess.jpg'))"
      MaskIconFrame	      on
      MaskIconOpaque	      on
      MaskIconRotate	      "none"
      MaskIconUnits	      "autoscale"
      System {
	Name			"energy\nstorage <ess>"
	Location		[755, 365, 1221, 942]
	Open			off
	ModelBrowserVisibility	on
	ModelBrowserWidth	212
	ScreenColor		"white"
	PaperOrientation	"landscape"
	PaperPositionMode	"auto"
	PaperType		"usletter"
	PaperUnits		"inches"
	ZoomFactor		"100"
	Block {
	  BlockType		  Inport
	  Name			  "power req'd\ninto bus (W)"
	  Position		  [35, 20, 55, 40]
	  FontName		  "Arial"
	  Port			  "1"
	  LatchInput		  off
	  Interpolate		  on
	}
	Block {
	  BlockType		  SubSystem
	  Name			  "ess config"
	  Ports			  [1, 1]
	  Position		  [115, 17, 190, 73]
	  ShowName		  off
	  AttributesFormatString  "%<BlockChoice>"
	  ShowPortLabels	  off
	  BlockChoice		  "Ultracapacitor  System"
	  TemplateBlock		  "lib_energy_storage/Ess Choices/ess config"
	  MemberBlocks		  "Ultracapacitor  System,energy storage <ess>"
",energy storage <ess> RC,energy storage <ess> nnet,energy storage <ess> Saber"
",energy storage <ess> fundamental model,energy storage <ess> optima fundament"
"al model"
	  TreatAsAtomicUnit	  off
	  RTWSystemCode		  "Auto"
	  RTWFcnNameOpts	  "Auto"
	  RTWFileNameOpts	  "Auto"
	  System {
	    Name		    "ess config"
	    Location		    [148, 182, 646, 482]
	    Open		    off
	    ModelBrowserVisibility  off
	    ModelBrowserWidth	    200
	    ScreenColor		    "white"
	    PaperOrientation	    "landscape"
	    PaperPositionMode	    "auto"
	    PaperType		    "usletter"
	    PaperUnits		    "inches"
	    ZoomFactor		    "100"
	    Block {
	      BlockType		      Inport
	      Name		      "power req'd\ninto bus (W)"
	      Position		      [20, 40, 40, 60]
	      Port		      "1"
	      LatchInput	      off
	      Interpolate	      on
	    }
	    Block {
	      BlockType		      Reference
	      Name		      "Ultracapacitor\n System"
	      Ports		      [1, 1]
	      Position		      [100, 40, 140, 80]
	      SourceBlock	      "lib_energy_storage/Ess Choices/Ultracap"
"acitor\n System"
	      SourceType	      ""
	    }
	    Block {
	      BlockType		      Outport
	      Name		      "power available\nto bus (W)"
	      Position		      [200, 40, 220, 60]
	      Port		      "1"
	      OutputWhenDisabled      "held"
	      InitialOutput	      "[]"
	    }
	    Line {
	      SrcBlock		      "power req'd\ninto bus (W)"
	      SrcPort		      1
	      Points		      [20, 0; 0, 10]
	      DstBlock		      "Ultracapacitor\n System"
	      DstPort		      1
	    }
	    Line {
	      SrcBlock		      "Ultracapacitor\n System"
	      SrcPort		      1
	      Points		      [20, 0; 0, -10]
	      DstBlock		      "power available\nto bus (W)"
	      DstPort		      1
	    }
	  }
	}
	Block {
	  BlockType		  Outport
	  Name			  "power available\nto bus (W)"
	  Position		  [250, 20, 270, 40]
	  FontName		  "Arial"
	  Port			  "1"
	  OutputWhenDisabled	  "held"
	  InitialOutput		  "0"
	}
	Line {
	  SrcBlock		  "ess config"
	  SrcPort		  1
	  Points		  [5, 0; 0, -15]
	  DstBlock		  "power available\nto bus (W)"
	  DstPort		  1
	}
	Line {
	  SrcBlock		  "power req'd\ninto bus (W)"
	  SrcPort		  1
	  Points		  [35, 0; 0, 15]
	  DstBlock		  "ess config"
	  DstPort		  1
	}
      }
    }
    Annotation {
      Position		      [96, 36]
      ForegroundColor	      "blue"
      BackgroundColor	      "yellow"
      Text		      "Energy Storage:"
      DropShadow	      on
      FontName		      "Arial"
      FontSize		      14
    }
  }
}
